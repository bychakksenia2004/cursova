{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/app/api/cloudinary/delete/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { v2 as cloudinary } from \"cloudinary\";\r\n\r\ncloudinary.config({\r\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n  api_key: process.env.CLOUDINARY_API_KEY,\r\n  api_secret: process.env.CLOUDINARY_API_SECRET,\r\n});\r\n\r\nfunction extractPublicId(url: string) {\r\n  if (!url) return null;\r\n  try {\r\n    const u = new URL(url);\r\n    const parts = u.pathname.split('/');\r\n    const uploadIndex = parts.findIndex((p) => p === 'upload');\r\n    if (uploadIndex === -1) return null;\r\n    // take everything after 'upload'\r\n    let after = parts.slice(uploadIndex + 1).join('/');\r\n    // remove version prefix if present (v123456)\r\n    after = after.replace(/^v\\d+\\//, '');\r\n    // remove file extension if present\r\n    const dot = after.lastIndexOf('.');\r\n    if (dot !== -1) after = after.substring(0, dot);\r\n    // decode and return\r\n    return decodeURIComponent(after);\r\n  } catch (e) {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n    const imageUrl = body?.imageUrl;\r\n    if (!imageUrl) return NextResponse.json({ error: \"imageUrl required\" }, { status: 400 });\r\n    if (!process.env.CLOUDINARY_CLOUD_NAME || !process.env.CLOUDINARY_API_KEY || !process.env.CLOUDINARY_API_SECRET) {\r\n      return NextResponse.json({ error: \"Cloudinary not configured on server\" }, { status: 500 });\r\n    }\r\n    const publicId = extractPublicId(imageUrl);\r\n    if (!publicId) {\r\n      return NextResponse.json({ error: \"Could not extract public_id from URL\" }, { status: 400 });\r\n    }\r\n    const res = await cloudinary.uploader.destroy(publicId, { resource_type: \"image\" });\r\n    return NextResponse.json({ ok: true, result: res }, { status: 200 });\r\n  } catch (err: any) {\r\n    console.error(\"/api/cloudinary/delete error:\", err);\r\n    return NextResponse.json({ error: err?.message || String(err) }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,gJAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;AAC/C;AAEA,SAAS,gBAAgB,GAAW;IAClC,IAAI,CAAC,KAAK,OAAO;IACjB,IAAI;QACF,MAAM,IAAI,IAAI,IAAI;QAClB,MAAM,QAAQ,EAAE,QAAQ,CAAC,KAAK,CAAC;QAC/B,MAAM,cAAc,MAAM,SAAS,CAAC,CAAC,IAAM,MAAM;QACjD,IAAI,gBAAgB,CAAC,GAAG,OAAO;QAC/B,iCAAiC;QACjC,IAAI,QAAQ,MAAM,KAAK,CAAC,cAAc,GAAG,IAAI,CAAC;QAC9C,6CAA6C;QAC7C,QAAQ,MAAM,OAAO,CAAC,WAAW;QACjC,mCAAmC;QACnC,MAAM,MAAM,MAAM,WAAW,CAAC;QAC9B,IAAI,QAAQ,CAAC,GAAG,QAAQ,MAAM,SAAS,CAAC,GAAG;QAC3C,oBAAoB;QACpB,OAAO,mBAAmB;IAC5B,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,WAAW,MAAM;QACvB,IAAI,CAAC,UAAU,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;QACtF,IAAI,CAAC,QAAQ,GAAG,CAAC,qBAAqB,IAAI,CAAC,QAAQ,GAAG,CAAC,kBAAkB,IAAI,CAAC,QAAQ,GAAG,CAAC,qBAAqB,EAAE;YAC/G,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsC,GAAG;gBAAE,QAAQ;YAAI;QAC3F;QACA,MAAM,WAAW,gBAAgB;QACjC,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuC,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QACA,MAAM,MAAM,MAAM,gJAAU,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU;YAAE,eAAe;QAAQ;QACjF,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,QAAQ;QAAI,GAAG;YAAE,QAAQ;QAAI;IACpE,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,KAAK,WAAW,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF"}}]
}