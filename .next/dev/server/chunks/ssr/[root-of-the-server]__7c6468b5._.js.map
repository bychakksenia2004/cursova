{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/app/history/%5BattemptId%5D/page.tsx"],"sourcesContent":["import React from \"react\";\r\nimport Link from \"next/link\";\r\nimport { notFound } from \"next/navigation\";\r\nimport { getUserFromCookieServer } from \"../../lib/auth\";\r\nimport { connectToDB } from \"../../lib/mongodb\";\r\nimport Attempt from \"../../lib/models/Attempt\";\r\nimport Test from \"../../lib/models/Test\";\r\n\r\ntype Props = { params: { attemptId: string } };\r\n\r\nexport default async function AttemptDetailPage({ params }: Props) {\r\n  const { attemptId } = params;\r\n  await connectToDB();\r\n  const viewer = await getUserFromCookieServer();\r\n  if (!viewer) {\r\n    return (\r\n      <div className=\"container min-vh-100 d-flex flex-column align-items-center\">\r\n        <h2 className=\"mb-3\">Потрібно увійти</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-warning\">Щоб переглянути свої відповіді, будь ласка, увійдіть.</div>\r\n          <div className=\"mt-2\"><Link href=\"/login\"><button className=\"btn btn-primary\">Увійти</button></Link></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const attempt = await Attempt.findById(attemptId).lean();\r\n  if (!attempt) return notFound();\r\n\r\n  // Ensure the viewer owns the attempt\r\n  if (!attempt.userId || String(attempt.userId) !== String(viewer._id)) {\r\n    return (\r\n      <div className=\"container min-vh-100 d-flex flex-column align-items-center\">\r\n        <h2 className=\"mb-3\">Доступ заборонено</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-danger\">Ви можете переглядати лише власні спроби.</div>\r\n          <div className=\"mt-2\"><Link href=\"/history\"><button className=\"btn btn-outline-secondary\">Назад</button></Link></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const test = await Test.findById(attempt.testId).lean();\r\n  if (!test) {\r\n    return (\r\n      <div className=\"container min-vh-100 d-flex flex-column align-items-center\">\r\n        <h2 className=\"mb-3\">Тест видалено</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-warning\">Цей тест було видалено, але спроба все ще збережена.</div>\r\n          <div className=\"mt-2\"><Link href=\"/history\"><button className=\"btn btn-outline-secondary\">Назад</button></Link></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const answers = attempt.answers || {};\r\n  const perQuestion = attempt.perQuestion || [];\r\n\r\n  function findPQ(qid: any) {\r\n    return (perQuestion || []).find((p: any) => String(p.id) === String(qid));\r\n  }\r\n\r\n  // Prepare questions for display (no shuffling — show canonical order)\r\n  const qs = Array.isArray(test.questions) ? test.questions.map((q: any) => {\r\n    const copy: any = { ...q };\r\n    if (q.type === \"matching\") {\r\n      const lefts = (q.pairs || []).map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.left }));\r\n      const rights = (q.pairs || []).map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.right }));\r\n      copy._displayLeft = lefts;\r\n      copy._displayRight = rights;\r\n    }\r\n    if (q.type === \"sequence\" || q.type === \"single_choice\" || q.type === \"multi_choice\") {\r\n      copy._displayOptions = q.options || q.data?.options || [];\r\n    }\r\n    return copy;\r\n  }) : [];\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n      <h2 className=\"mb-3\">{test.title}</h2>\r\n      <div className=\"text-muted mb-3\">Проходження: {new Date(attempt.createdAt).toLocaleString()}</div>\r\n\r\n      <div className=\"menu-box w-100\">\r\n        {qs.map((q: any, idx: number) => {\r\n          const userAns = answers[q.id];\r\n          const pq = findPQ(q.id);\r\n          return (\r\n            <div key={q.id} className=\"mb-4\">\r\n              <div className=\"d-flex justify-content-between mb-1\">\r\n                <div className=\"fw-semibold\">{idx + 1}. {q.text}</div>\r\n                <div className=\"text-muted small\">{pq ? `бали: ${pq.score} / ${pq.points}` : \"\"}</div>\r\n              </div>\r\n              {q.imageUrl ? <div className=\"mb-2\"><img src={q.imageUrl} alt=\"qimg\" style={{ maxWidth: \"40%\" }} /></div> : null}\r\n\r\n              {q.type === \"single_choice\" ? (\r\n                <div>{(q._displayOptions || []).map((opt: any) => (\r\n                  <label key={opt.id} className=\"d-block mb-1\">\r\n                    <input type=\"radio\" name={`q-${q.id}`} disabled checked={String(userAns) === String(opt.id)} /> {opt.text}\r\n                  </label>\r\n                ))}</div>\r\n              ) : q.type === \"multi_choice\" ? (\r\n                <div>{(q._displayOptions || []).map((opt: any) => (\r\n                  <label key={opt.id} className=\"d-block mb-1\">\r\n                    <input type=\"checkbox\" disabled checked={Array.isArray(userAns) && userAns.map(String).includes(String(opt.id))} /> {opt.text}\r\n                  </label>\r\n                ))}</div>\r\n              ) : q.type === \"sequence\" ? (\r\n                <div className=\"list-group\">\r\n                  {(q._displayOptions || []).map((it: any) => (\r\n                    <div key={it.id} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                      <div className=\"flex-fill\">{it.text}</div>\r\n                      <div className=\"w-50\"><input className=\"form-control\" value={(userAns && userAns[it.id]) || \"\"} disabled /></div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"matching\" ? (\r\n                <div className=\"list-group\">\r\n                  {(q._displayLeft || []).map((l: any) => (\r\n                    <div key={l.pairId} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                      <div className=\"flex-fill\">{l.text}</div>\r\n                      <div className=\"w-50\">\r\n                        <select className=\"form-select\" value={(userAns && (userAns[l.pairId] ?? \"\"))} disabled>\r\n                          <option value=\"\">-- Відповідність --</option>\r\n                          {(q._displayRight || []).map((r: any) => (\r\n                            <option key={r.pairId} value={r.pairId}>{r.text}</option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"open\" ? (\r\n                <div><textarea className=\"form-control\" rows={3} value={userAns || \"\"} disabled /></div>\r\n              ) : null}\r\n            </div>\r\n          );\r\n        })}\r\n\r\n        <div className=\"d-flex gap-2\">\r\n          <Link href=\"/history\"><button className=\"btn btn-outline-secondary\">Назад до історії</button></Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}