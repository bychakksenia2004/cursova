{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/lib/mongodb.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\nimport dns from \"dns/promises\";\r\n\r\n// Додаємо константу з fallback на MONGODB_URI\r\nconst MONGODB_URL = process.env.MONGODB_URL || process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URL) {\r\n  throw new Error(\"❌ Вкажи змінну MONGODB_URL або MONGODB_URI у .env.local\");\r\n}\r\n\r\nlet cached = (global as any).mongoose;\r\n\r\nif (!cached) {\r\n  cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectToDB(): Promise<typeof mongoose> {\r\n  if (cached.conn) return cached.conn;\r\n\r\n  if (!cached.promise) {\r\n    // Більші таймаути для більш стабільної діагностики\r\n    cached.promise = mongoose\r\n      .connect(MONGODB_URL as string, {\r\n        // сучасні mongoose/driver опції за замовчуванням працюють добре,\r\n        // але додаємо час очікування на вибір сервера для швидшої діагностики\r\n        serverSelectionTimeoutMS: 10000,\r\n        connectTimeoutMS: 10000,\r\n        socketTimeoutMS: 45000\r\n      })\r\n      .then((mongoose) => mongoose)\r\n      .catch(async (err) => {\r\n        // Лог оригінальної помилки на сервері (щоб бачити стек)\r\n        console.error(\"MongoDB connection error (original):\", err);\r\n\r\n        // Базове дружнє повідомлення\r\n        let diag = [\r\n          \"Не вдалося підключитися до MongoDB.\",\r\n          \"Перевірте MONGODB_URL у d:\\\\magistrature\\\\Dockerwork\\\\kursova\\\\.env.local,\",\r\n          \"переконайтесь, що кластер працює, та що ваш IP добавлений в Network Access (whitelist) в Atlas.\",\r\n          `Оригінальна помилка: ${err?.message ?? String(err)}`\r\n        ].join(\" \");\r\n\r\n        // Додаткова діагностика для mongodb+srv (DNS SRV)\r\n        try {\r\n          if (typeof MONGODB_URL === \"string\" && MONGODB_URL.startsWith(\"mongodb+srv://\")) {\r\n            try {\r\n              const parsed = new URL(MONGODB_URL);\r\n              const host = parsed.hostname;\r\n              diag += ` SRV host: ${host}.`;\r\n\r\n              try {\r\n                const srv = await dns.resolveSrv(`_mongodb._tcp.${host}`);\r\n                diag += ` DNS SRV records: ${JSON.stringify(srv)}.`;\r\n              } catch (srvErr) {\r\n                diag += ` DNS SRV lookup failed: ${srvErr?.message ?? String(srvErr)}.`;\r\n              }\r\n\r\n              try {\r\n                const lookup = await dns.lookup(host);\r\n                diag += ` DNS lookup: ${JSON.stringify(lookup)}.`;\r\n              } catch (lookupErr) {\r\n                diag += ` DNS lookup failed: ${lookupErr?.message ?? String(lookupErr)}.`;\r\n              }\r\n            } catch (parseErr) {\r\n              diag += ` Failed to parse URL for additional diagnostics: ${parseErr?.message ?? String(parseErr)}.`;\r\n            }\r\n          } else {\r\n            // Для звичайних mongodb:// хостів також можна зробити dns.lookup\r\n            try {\r\n              const parsed = new URL(MONGODB_URL as string);\r\n              const host = parsed.hostname;\r\n              try {\r\n                const lookup = await dns.lookup(host);\r\n                diag += ` DNS lookup: ${JSON.stringify(lookup)}.`;\r\n              } catch (lookupErr) {\r\n                diag += ` DNS lookup failed: ${lookupErr?.message ?? String(lookupErr)}.`;\r\n              }\r\n            } catch {\r\n              // нічого\r\n            }\r\n          }\r\n        } catch (diagErr) {\r\n          diag += ` (diagnostics failed: ${diagErr?.message ?? String(diagErr)})`;\r\n        }\r\n\r\n        // Кидаємо нову помилку з детальною діагностикою\r\n        throw new Error(diag);\r\n      });\r\n  }\r\n\r\n  cached.conn = await cached.promise;\r\n  return cached.conn;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,8CAA8C;AAC9C,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI,QAAQ,GAAG,CAAC,WAAW;AAEtE,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IAEnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mDAAmD;QACnD,OAAO,OAAO,GAAG,oHAAQ,CACtB,OAAO,CAAC,aAAuB;YAC9B,iEAAiE;YACjE,sEAAsE;YACtE,0BAA0B;YAC1B,kBAAkB;YAClB,iBAAiB;QACnB,GACC,IAAI,CAAC,CAAC,WAAa,UACnB,KAAK,CAAC,OAAO;YACZ,wDAAwD;YACxD,QAAQ,KAAK,CAAC,wCAAwC;YAEtD,6BAA6B;YAC7B,IAAI,OAAO;gBACT;gBACA;gBACA;gBACA,CAAC,qBAAqB,EAAE,KAAK,WAAW,OAAO,MAAM;aACtD,CAAC,IAAI,CAAC;YAEP,kDAAkD;YAClD,IAAI;gBACF,IAAI,OAAO,gBAAgB,YAAY,YAAY,UAAU,CAAC,mBAAmB;oBAC/E,IAAI;wBACF,MAAM,SAAS,IAAI,IAAI;wBACvB,MAAM,OAAO,OAAO,QAAQ;wBAC5B,QAAQ,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;wBAE7B,IAAI;4BACF,MAAM,MAAM,MAAM,kIAAG,CAAC,UAAU,CAAC,CAAC,cAAc,EAAE,MAAM;4BACxD,QAAQ,CAAC,kBAAkB,EAAE,KAAK,SAAS,CAAC,KAAK,CAAC,CAAC;wBACrD,EAAE,OAAO,QAAQ;4BACf,QAAQ,CAAC,wBAAwB,EAAE,QAAQ,WAAW,OAAO,QAAQ,CAAC,CAAC;wBACzE;wBAEA,IAAI;4BACF,MAAM,SAAS,MAAM,kIAAG,CAAC,MAAM,CAAC;4BAChC,QAAQ,CAAC,aAAa,EAAE,KAAK,SAAS,CAAC,QAAQ,CAAC,CAAC;wBACnD,EAAE,OAAO,WAAW;4BAClB,QAAQ,CAAC,oBAAoB,EAAE,WAAW,WAAW,OAAO,WAAW,CAAC,CAAC;wBAC3E;oBACF,EAAE,OAAO,UAAU;wBACjB,QAAQ,CAAC,iDAAiD,EAAE,UAAU,WAAW,OAAO,UAAU,CAAC,CAAC;oBACtG;gBACF,OAAO;oBACL,iEAAiE;oBACjE,IAAI;wBACF,MAAM,SAAS,IAAI,IAAI;wBACvB,MAAM,OAAO,OAAO,QAAQ;wBAC5B,IAAI;4BACF,MAAM,SAAS,MAAM,kIAAG,CAAC,MAAM,CAAC;4BAChC,QAAQ,CAAC,aAAa,EAAE,KAAK,SAAS,CAAC,QAAQ,CAAC,CAAC;wBACnD,EAAE,OAAO,WAAW;4BAClB,QAAQ,CAAC,oBAAoB,EAAE,WAAW,WAAW,OAAO,WAAW,CAAC,CAAC;wBAC3E;oBACF,EAAE,OAAM;oBACN,SAAS;oBACX;gBACF;YACF,EAAE,OAAO,SAAS;gBAChB,QAAQ,CAAC,sBAAsB,EAAE,SAAS,WAAW,OAAO,SAAS,CAAC,CAAC;YACzE;YAEA,gDAAgD;YAChD,MAAM,IAAI,MAAM;QAClB;IACJ;IAEA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/lib/models/User.ts"],"sourcesContent":["import mongoose, { Document, Model } from \"mongoose\";\r\n\r\nexport interface IUser extends Document {\r\n  username: string;\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nconst UserSchema = new mongoose.Schema<IUser>(\r\n  {\r\n    email: { type: String, required: true, unique: true },\r\n    username: { type: String, required: true },\r\n    password: { type: String, required: true }\r\n  }\r\n);\r\n\r\nconst User: Model<IUser> = mongoose.models.User || mongoose.model<IUser>(\"User\", UserSchema);\r\nexport default User;\r\n"],"names":[],"mappings":";;;;AAAA;;AAQA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CACpC;IACE,OAAO;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACpD,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;AAC3C;AAGF,MAAM,OAAqB,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAClE"}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/lib/auth.ts"],"sourcesContent":["import crypto from \"crypto\";\r\nimport { cookies } from \"next/headers\";\r\nimport { connectToDB } from \"./mongodb\";\r\nimport User from \"./models/User\";\r\n\r\nfunction base64url(input: Buffer | string) {\r\n  const b = typeof input === \"string\" ? Buffer.from(input) : input;\r\n  return b.toString(\"base64\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\r\n}\r\n\r\nexport function verifyToken(token: string, secret: string) {\r\n  try {\r\n    const [headerB, payloadB, sigB] = token.split(\".\");\r\n    if (!headerB || !payloadB || !sigB) return null;\r\n    const toSign = `${headerB}.${payloadB}`;\r\n    const expectedSig = base64url(crypto.createHmac(\"sha256\", secret).update(toSign).digest());\r\n    if (expectedSig !== sigB) return null;\r\n    const payload = JSON.parse(Buffer.from(payloadB, \"base64\").toString(\"utf8\"));\r\n    if (payload.exp && Math.floor(Date.now() / 1000) > payload.exp) return null;\r\n    return payload;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n// Серверна утиліта: читає cookie 'token', верифікує і повертає користувача або null\r\nexport async function getUserFromCookieServer() {\r\n  try {\r\n    // cookies() в різних версіях може бути sync або async — підтримуємо обидва випадки\r\n    let cookieStore: any = cookies();\r\n    if (cookieStore && typeof cookieStore.then === \"function\") {\r\n      cookieStore = await cookieStore;\r\n    }\r\n\r\n    if (!cookieStore || typeof cookieStore.get !== \"function\") {\r\n      console.error(\"getUserFromCookieServer error: cookieStore missing or has no get()\");\r\n      return null;\r\n    }\r\n\r\n    const tokenCookie = cookieStore.get(\"token\");\r\n    if (!tokenCookie?.value) return null;\r\n    const token = tokenCookie.value;\r\n\r\n    const JWT_SECRET = process.env.JWT_SECRET;\r\n    if (!JWT_SECRET) {\r\n      // no secret configured -> cannot verify token\r\n      return null;\r\n    }\r\n\r\n    const payload = verifyToken(token, JWT_SECRET);\r\n    if (!payload?.sub) return null;\r\n\r\n    await connectToDB();\r\n    const user = await User.findById(payload.sub).lean();\r\n    if (!user) return null;\r\n\r\n    return { _id: String((user as any)._id), username: (user as any).username, email: (user as any).email };\r\n  } catch (err) {\r\n    console.error(\"getUserFromCookieServer error:\", err);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,SAAS,UAAU,KAAsB;IACvC,MAAM,IAAI,OAAO,UAAU,WAAW,OAAO,IAAI,CAAC,SAAS;IAC3D,OAAO,EAAE,QAAQ,CAAC,UAAU,OAAO,CAAC,OAAO,KAAK,OAAO,CAAC,OAAO,KAAK,OAAO,CAAC,OAAO;AACrF;AAEO,SAAS,YAAY,KAAa,EAAE,MAAc;IACvD,IAAI;QACF,MAAM,CAAC,SAAS,UAAU,KAAK,GAAG,MAAM,KAAK,CAAC;QAC9C,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,MAAM,OAAO;QAC3C,MAAM,SAAS,GAAG,QAAQ,CAAC,EAAE,UAAU;QACvC,MAAM,cAAc,UAAU,gHAAM,CAAC,UAAU,CAAC,UAAU,QAAQ,MAAM,CAAC,QAAQ,MAAM;QACvF,IAAI,gBAAgB,MAAM,OAAO;QACjC,MAAM,UAAU,KAAK,KAAK,CAAC,OAAO,IAAI,CAAC,UAAU,UAAU,QAAQ,CAAC;QACpE,IAAI,QAAQ,GAAG,IAAI,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,QAAQ,QAAQ,GAAG,EAAE,OAAO;QACvE,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAGO,eAAe;IACpB,IAAI;QACF,mFAAmF;QACnF,IAAI,cAAmB,IAAA,0IAAO;QAC9B,IAAI,eAAe,OAAO,YAAY,IAAI,KAAK,YAAY;YACzD,cAAc,MAAM;QACtB;QAEA,IAAI,CAAC,eAAe,OAAO,YAAY,GAAG,KAAK,YAAY;YACzD,QAAQ,KAAK,CAAC;YACd,OAAO;QACT;QAEA,MAAM,cAAc,YAAY,GAAG,CAAC;QACpC,IAAI,CAAC,aAAa,OAAO,OAAO;QAChC,MAAM,QAAQ,YAAY,KAAK;QAE/B,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU;QACzC,IAAI,CAAC,YAAY;YACf,8CAA8C;YAC9C,OAAO;QACT;QAEA,MAAM,UAAU,YAAY,OAAO;QACnC,IAAI,CAAC,SAAS,KAAK,OAAO;QAE1B,MAAM,IAAA,6HAAW;QACjB,MAAM,OAAO,MAAM,gIAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,EAAE,IAAI;QAClD,IAAI,CAAC,MAAM,OAAO;QAElB,OAAO;YAAE,KAAK,OAAO,AAAC,KAAa,GAAG;YAAG,UAAU,AAAC,KAAa,QAAQ;YAAE,OAAO,AAAC,KAAa,KAAK;QAAC;IACxG,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO;IACT;AACF"}},
    {"offset": {"line": 224, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/lib/models/Attempt.ts"],"sourcesContent":["import mongoose, { Document, Model } from \"mongoose\";\r\n\r\nexport interface IAttempt extends Document {\r\n  userId: mongoose.Types.ObjectId | string | null;\r\n  testId: mongoose.Types.ObjectId | string;\r\n  answers: any;\r\n  totalScore: number;\r\n  totalPossible: number;\r\n  perQuestion: any[];\r\n  createdAt: Date;\r\n}\r\n\r\nconst AttemptSchema = new mongoose.Schema<IAttempt>(\r\n  {\r\n    userId: { type: mongoose.Schema.Types.ObjectId, required: false, ref: \"User\" },\r\n    testId: { type: mongoose.Schema.Types.ObjectId, required: true, ref: \"Test\" },\r\n    answers: { type: mongoose.Schema.Types.Mixed, required: false },\r\n    totalScore: { type: Number, required: true },\r\n    totalPossible: { type: Number, required: true },\r\n    perQuestion: { type: Array, required: true },\r\n    createdAt: { type: Date, default: () => new Date() },\r\n  },\r\n  { timestamps: false }\r\n);\r\n\r\nconst Attempt: Model<IAttempt> = mongoose.models.Attempt || mongoose.model<IAttempt>(\"Attempt\", AttemptSchema);\r\nexport default Attempt;\r\n"],"names":[],"mappings":";;;;AAAA;;AAYA,MAAM,gBAAgB,IAAI,oHAAQ,CAAC,MAAM,CACvC;IACE,QAAQ;QAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,UAAU;QAAO,KAAK;IAAO;IAC7E,QAAQ;QAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,UAAU;QAAM,KAAK;IAAO;IAC5E,SAAS;QAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK;QAAE,UAAU;IAAM;IAC9D,YAAY;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC3C,eAAe;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC9C,aAAa;QAAE,MAAM;QAAO,UAAU;IAAK;IAC3C,WAAW;QAAE,MAAM;QAAM,SAAS,IAAM,IAAI;IAAO;AACrD,GACA;IAAE,YAAY;AAAM;AAGtB,MAAM,UAA2B,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAW,WAAW;uCACjF"}},
    {"offset": {"line": 270, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/lib/models/Test.ts"],"sourcesContent":["import mongoose, { Document, Model } from \"mongoose\";\r\n\r\n// TypeScript interfaces for question variants\r\ntype QBase = {\r\n  id: number;\r\n  type: \"single_choice\" | \"multi_choice\" | \"sequence\" | \"matching\" | \"open\";\r\n  text: string;\r\n  imageUrl?: string;\r\n  points?: number;\r\n};\r\n\r\ntype SingleOption = { id: number; text: string; correct: boolean };\r\ntype SequenceItem = { id: number; text: string; order: number };\r\ntype PairItem = { id: number; left: string; right: string };\r\n\r\nexport type SingleQuestion = QBase & { type: \"single_choice\"; options: SingleOption[] };\r\nexport type MultiQuestion = QBase & { type: \"multi_choice\"; options: SingleOption[] };\r\nexport type SequenceQuestion = QBase & { type: \"sequence\"; options: SequenceItem[] };\r\nexport type MatchingQuestion = QBase & { type: \"matching\"; pairs: PairItem[] };\r\nexport type OpenQuestion = QBase & { type: \"open\"; answers: string[] };\r\n\r\nexport interface ITest extends Document {\r\n  title: string;\r\n  description: string | null;\r\n  authorId: mongoose.Types.ObjectId;\r\n  visibility: \"private\" | \"public\";\r\n  storeResponses: boolean;\r\n  ownResultView: \"full\" | \"score_only\" | \"nothing\";\r\n  timed?: boolean;\r\n  timeLimitMinutes?: number | null;\r\n  dateWindowEnabled?: boolean;\r\n  openFrom?: Date | null;\r\n  openTo?: Date | null;\r\n  questions: Array<SingleQuestion | MultiQuestion | SequenceQuestion | MatchingQuestion | OpenQuestion>;\r\n}\r\n\r\n// Mongoose sub-schemas\r\nconst questionOpts = { discriminatorKey: \"type\", _id: false } as const;\r\n\r\nconst BaseQuestionSchema = new mongoose.Schema(\r\n  {\r\n    id: { type: Number, required: true },\r\n    points: { type: Number, required: false, default: 1 },\r\n    type: { type: String, required: true },\r\n    text: { type: String, required: true },\r\n    imageUrl: { type: String, required: false },\r\n  },\r\n  questionOpts\r\n);\r\n\r\nconst SingleQuestionSchema = new mongoose.Schema(\r\n  {\r\n    options: [\r\n      {\r\n        id: { type: Number, required: true },\r\n        text: { type: String, required: true },\r\n        correct: { type: Boolean, required: true },\r\n      },\r\n    ],\r\n  },\r\n  { _id: false }\r\n);\r\n\r\nconst MultiQuestionSchema = new mongoose.Schema(\r\n  {\r\n    options: [\r\n      {\r\n        id: { type: Number, required: true },\r\n        text: { type: String, required: true },\r\n        correct: { type: Boolean, required: true },\r\n      },\r\n    ],\r\n  },\r\n  { _id: false }\r\n);\r\n\r\nconst SequenceQuestionSchema = new mongoose.Schema(\r\n  {\r\n    options: [\r\n      {\r\n        id: { type: Number, required: true },\r\n        text: { type: String, required: true },\r\n        order: { type: Number, required: true },\r\n      },\r\n    ],\r\n  },\r\n  { _id: false }\r\n);\r\n\r\nconst MatchingQuestionSchema = new mongoose.Schema(\r\n  {\r\n    pairs: [\r\n      {\r\n        id: { type: Number, required: true },\r\n        left: { type: String, required: true },\r\n        right: { type: String, required: true },\r\n      },\r\n    ],\r\n  },\r\n  { _id: false }\r\n);\r\n\r\nconst OpenQuestionSchema = new mongoose.Schema(\r\n  {\r\n    answers: [\r\n      {\r\n        type: String,\r\n      },\r\n    ],\r\n  },\r\n  { _id: false }\r\n);\r\n\r\n// Main Test schema — questions array uses base schema and will be discriminated\r\nconst TestSchema = new mongoose.Schema<ITest>(\r\n  {\r\n    title: { type: String, required: true },\r\n    description: { type: String, required: false },\r\n    authorId: { type: mongoose.Schema.Types.ObjectId, required: true, ref: \"User\" },\r\n    visibility: { type: String, enum: [\"private\", \"public\"], default: \"private\" },\r\n    storeResponses: { type: Boolean, default: false },\r\n    ownResultView: { type: String, enum: [\"full\", \"score_only\", \"nothing\"], default: \"full\" },\r\n    timed: { type: Boolean, default: false },\r\n    timeLimitMinutes: { type: Number, required: false },\r\n    dateWindowEnabled: { type: Boolean, default: false },\r\n    openFrom: { type: Date, required: false },\r\n    openTo: { type: Date, required: false },\r\n    questions: [BaseQuestionSchema],\r\n  }\r\n);\r\n\r\n// Apply discriminators for the question array\r\n// Note: for array discriminators use TestSchema.path('questions').discriminator(...)\r\n;(TestSchema.path(\"questions\") as any).discriminator(\"single_choice\", SingleQuestionSchema as any);\r\n;(TestSchema.path(\"questions\") as any).discriminator(\"multi_choice\", MultiQuestionSchema as any);\r\n;(TestSchema.path(\"questions\") as any).discriminator(\"sequence\", SequenceQuestionSchema as any);\r\n;(TestSchema.path(\"questions\") as any).discriminator(\"matching\", MatchingQuestionSchema as any);\r\n;(TestSchema.path(\"questions\") as any).discriminator(\"open\", OpenQuestionSchema as any);\r\n\r\nconst Test: Model<ITest> = mongoose.models.Test || mongoose.model<ITest>(\"Test\", TestSchema);\r\nexport default Test;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 464, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/app/history/%5BattemptId%5D/page.tsx"],"sourcesContent":["import React from \"react\";\r\nimport Link from \"next/link\";\r\nimport { getUserFromCookieServer } from \"../../../lib/auth\";\r\nimport { connectToDB } from \"../../../lib/mongodb\";\r\nimport Attempt from \"../../../lib/models/Attempt\";\r\nimport mongoose from \"mongoose\";\r\nimport Test from \"../../../lib/models/Test\";\r\n\r\ntype Props = { params: any };\r\n\r\nexport default async function AttemptDetailPage({ params }: Props) {\r\n  const { attemptId } = await params;\r\n  await connectToDB();\r\n  const viewer = await getUserFromCookieServer();\r\n  if (!viewer) {\r\n    return (\r\n      <div className=\"container min-vh-100 d-flex flex-column align-items-center\">\r\n        <h2 className=\"mb-3\">Потрібно увійти</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-warning\">Щоб переглянути свої відповіді, будь ласка, увійдіть.</div>\r\n          <div className=\"mt-2\"><Link href=\"/login\"><button className=\"btn btn-primary\">Увійти</button></Link></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  let attempt: any = null;\r\n  try {\r\n    console.log(\"[AttemptDetailPage] looking up attemptId:\", attemptId);\r\n\r\n    // Try several lookup strategies so we handle string vs ObjectId shapes\r\n    const triedIds = new Set<string>();\r\n    const candidates = [attemptId, String(attemptId).replace(/^\"|\"$/g, \"\"), String(attemptId).trim()];\r\n    for (const cand of candidates) {\r\n      if (!cand || triedIds.has(cand)) continue;\r\n      triedIds.add(cand);\r\n      try {\r\n        attempt = await Attempt.findById(cand).lean();\r\n        if (attempt) {\r\n          console.log(\"[AttemptDetailPage] found by findById with candidate:\", cand);\r\n          break;\r\n        }\r\n      } catch (e) {\r\n        const err = e as any;\r\n        console.warn(\"[AttemptDetailPage] findById failed for candidate:\", cand, { message: err?.message ?? String(err), stack: err?.stack });\r\n      }\r\n\r\n      try {\r\n        attempt = await Attempt.findOne({ _id: cand }).lean();\r\n        if (attempt) {\r\n          console.log(\"[AttemptDetailPage] found by findOne with candidate:\", cand);\r\n          break;\r\n        }\r\n      } catch (e) {\r\n        const err = e as any;\r\n        console.warn(\"[AttemptDetailPage] findOne failed for candidate:\", cand, { message: err?.message ?? String(err), stack: err?.stack });\r\n      }\r\n\r\n      // try ObjectId conversion if possible\r\n      try {\r\n        if (mongoose.isValidObjectId(cand)) {\r\n          attempt = await Attempt.findById(new mongoose.Types.ObjectId(cand)).lean();\r\n          if (attempt) {\r\n            console.log(\"[AttemptDetailPage] found by ObjectId conversion for:\", cand);\r\n            break;\r\n          }\r\n        }\r\n      } catch (e) {\r\n        const err = e as any;\r\n        console.warn(\"[AttemptDetailPage] ObjectId lookup failed for:\", cand, { message: err?.message ?? String(err), stack: err?.stack });\r\n      }\r\n    }\r\n\r\n    console.log(\"[AttemptDetailPage] attempt found:\", !!attempt);\r\n  } catch (err) {\r\n    console.error(\"[AttemptDetailPage] unexpected error during lookup:\", err);\r\n  }\r\n\r\n  if (!attempt) {\r\n    // Render a helpful debug page in dev to show the attempted id instead of a generic 404\r\n    return (\r\n      <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n        <h2 className=\"mb-3\">Спроба не знайдена (Debug)</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-warning\">Спроба з id <strong>{attemptId}</strong> не знайдена в базі даних.</div>\r\n          <div className=\"mb-2 text-muted\">Перевірте, що записи збережуються при проходженні тесту та що id правильно передається.</div>\r\n          <div className=\"mt-2\"><Link href=\"/history\"><button className=\"btn btn-outline-secondary\">Назад</button></Link></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const test = await Test.findById(attempt.testId).lean();\r\n  // Allow viewing if viewer is the attempt owner OR the author of the test\r\n  const isAttemptOwner = attempt.userId && String(attempt.userId) === String(viewer._id);\r\n  const isTestAuthor = test && test.authorId && String(test.authorId) === String(viewer._id);\r\n  const isTestAuthorWithStorage = !!test && !!test.storeResponses && isTestAuthor;\r\n  if (!isAttemptOwner && !isTestAuthorWithStorage) {\r\n    return (\r\n      <div className=\"container min-vh-100 d-flex flex-column align-items-center\">\r\n        <h2 className=\"mb-3\">Доступ заборонено</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-danger\">Ви можете переглядати лише власні спроби або як автор тесту.</div>\r\n          <div className=\"mt-2\"><Link href=\"/history\"><button className=\"btn btn-outline-secondary\">Назад</button></Link></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  if (!test) {\r\n    return (\r\n      <div className=\"container min-vh-100 d-flex flex-column align-items-center\">\r\n        <h2 className=\"mb-3\">Тест видалено</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-warning\">Цей тест було видалено, але спроба все ще збережена.</div>\r\n          <div className=\"mt-2\"><Link href=\"/history\"><button className=\"btn btn-outline-secondary\">Назад</button></Link></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Enforce ownResultView restrictions: authors always see everything; attempt owners see according to ownResultView.\r\n  const ownView = test.ownResultView || \"full\";\r\n  const canViewDetails = isTestAuthorWithStorage || (isAttemptOwner && ownView === \"full\");\r\n  const canViewTotals = isTestAuthorWithStorage || (isAttemptOwner && (ownView === \"full\" || ownView === \"score_only\"));\r\n\r\n  if (!canViewTotals && !canViewDetails) {\r\n    return (\r\n      <div className=\"container min-vh-100 d-flex flex-column align-items-center\">\r\n        <h2 className=\"mb-3\">Доступ заборонено</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-danger\">Власник тесту заборонив перегляд результатів цього тесту.</div>\r\n          <div className=\"mt-2\"><Link href=\"/history\"><button className=\"btn btn-outline-secondary\">Назад</button></Link></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const answers = attempt.answers || {};\r\n  const perQuestion = attempt.perQuestion || [];\r\n\r\n  function findPQ(qid: any) {\r\n    return (perQuestion || []).find((p: any) => String(p.id) === String(qid));\r\n  }\r\n\r\n  // Prepare questions for display (no shuffling — show canonical order)\r\n  // Accept some type aliases used in client (`single`, `multi`) so rendering matches take page\r\n  const qs = Array.isArray(test.questions) ? test.questions.map((q: any) => {\r\n    const copy: any = { ...q };\r\n    const qtype = (q.type || \"\").toString();\r\n    if (qtype === \"matching\") {\r\n      const lefts = (q.pairs || []).map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.left }));\r\n      const rights = (q.pairs || []).map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.right }));\r\n      copy._displayLeft = lefts;\r\n      copy._displayRight = rights;\r\n    }\r\n    if (qtype === \"sequence\" || qtype === \"single_choice\" || qtype === \"multi_choice\" || qtype === \"single\" || qtype === \"multi\") {\r\n      copy._displayOptions = q.options || q.data?.options || [];\r\n      // normalize common aliases so rendering checks match\r\n      if (qtype === \"single\") copy.type = \"single_choice\";\r\n      if (qtype === \"multi\") copy.type = \"multi_choice\";\r\n    }\r\n    return copy;\r\n  }) : [];\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n      <h2 className=\"mb-3\">{test.title}</h2>\r\n      <div className=\"text-muted mb-3\">Проходження: {new Date(attempt.createdAt).toLocaleString()}</div>\r\n      {typeof attempt.totalScore === \"number\" && typeof attempt.totalPossible === \"number\" ? (\r\n        <div className=\"mb-3\"><strong>Результат:</strong> {attempt.totalScore} / {attempt.totalPossible}</div>\r\n      ) : null}\r\n\r\n      <div className=\"menu-box w-100\">\r\n        {qs.map((q: any, idx: number) => {\r\n          // answers keys in DB may be strings (\"123\") or numbers (123)\r\n          const userAns = answers[q.id] ?? answers[String(q.id)];\r\n          const pq = findPQ(q.id);\r\n          return (\r\n            <div key={q.id} className=\"mb-4\">\r\n              <div className=\"d-flex justify-content-between mb-1\">\r\n                <div className=\"fw-semibold\">{idx + 1}. {q.text}</div>\r\n                <div className=\"text-muted small\">\r\n                  {pq ? `бали: ${pq.score} / ${pq.points}` : (typeof attempt.totalScore === \"number\" ? `бали: — / ${q.points ?? (pq && pq.points) ?? \"?\"}` : \"\")}\r\n                </div>\r\n              </div>\r\n              {q.imageUrl ? <div className=\"mb-2\"><img src={q.imageUrl} alt=\"qimg\" style={{ maxWidth: \"40%\" }} /></div> : null}\r\n\r\n              {q.type === \"single_choice\" ? (\r\n                <div>{(q._displayOptions || []).map((opt: any) => (\r\n                  <label key={opt.id} className=\"d-block mb-1\">\r\n                    <input type=\"radio\" name={`q-${q.id}`} disabled checked={String(userAns) === String(opt.id)} /> {opt.text}\r\n                  </label>\r\n                ))}</div>\r\n              ) : q.type === \"multi_choice\" ? (\r\n                <div>{(q._displayOptions || []).map((opt: any) => (\r\n                  <label key={opt.id} className=\"d-block mb-1\">\r\n                    <input type=\"checkbox\" disabled checked={Array.isArray(userAns) && userAns.map(String).includes(String(opt.id))} /> {opt.text}\r\n                  </label>\r\n                ))}</div>\r\n              ) : q.type === \"sequence\" ? (\r\n                <div className=\"list-group\">\r\n                  {(q._displayOptions || []).map((it: any) => (\r\n                    <div key={it.id} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                      <div className=\"flex-fill\">{it.text}</div>\r\n                      <div className=\"w-50\"><input className=\"form-control\" value={(userAns && (userAns[it.id] ?? userAns[String(it.id)])) || \"\"} disabled /></div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"matching\" ? (\r\n                <div className=\"list-group\">\r\n                  {(q._displayLeft || []).map((l: any) => (\r\n                    <div key={l.pairId} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                      <div className=\"flex-fill\">{l.text}</div>\r\n                      <div className=\"w-50\">\r\n                        <select className=\"form-select\" value={(userAns && (userAns[l.pairId] ?? userAns[String(l.pairId)] ?? \"\"))} disabled>\r\n                          <option value=\"\">-- Відповідність --</option>\r\n                          {(q._displayRight || []).map((r: any) => (\r\n                            <option key={r.pairId} value={r.pairId}>{r.text}</option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"open\" ? (\r\n                <div><textarea className=\"form-control\" rows={3} value={userAns || \"\"} disabled /></div>\r\n              ) : null}\r\n            </div>\r\n          );\r\n        })}\r\n\r\n        <div className=\"d-flex gap-2\">\r\n          <Link href=\"/history\"><button className=\"btn btn-outline-secondary\">Назад до історії</button></Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}