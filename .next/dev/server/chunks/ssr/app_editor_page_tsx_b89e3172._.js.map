{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///usr/src/app/app/editor/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function Editor() {\r\n  // Note: draft auto-save/restore remains in the editor/new page via localStorage.\r\n  const [tests, setTests] = useState<Array<{ _id: string; title: string; description?: string | null; storeResponses?: boolean }>>([]);\r\n  const [query, setQuery] = useState<string>(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [deletingId, setDeletingId] = useState<string | null>(null);\r\n  const [copiedId, setCopiedId] = useState<string | null>(null);\r\n  const [page, setPage] = useState<number>(1);\r\n  const [totalPages, setTotalPages] = useState<number>(1);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      try {\r\n        const res = await fetch(`/api/tests?page=${page}&limit=10`, { credentials: \"include\" });\r\n        if (!res.ok) return;\r\n        const data = await res.json();\r\n        if (mounted && data?.ok && Array.isArray(data.tests)) {\r\n          setTests(data.tests.map((t: any) => ({ _id: t._id || t.id || t._id, title: t.title, description: t.description, storeResponses: !!t.storeResponses })));\r\n          setTotalPages(data.totalPages || 1);\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"Failed to load tests:\", err);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      document.title = \"TestHub | Редактор тестів\";\r\n    } catch {}\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center justify-content-center min-vh-100\">\r\n      <h2 className=\"mb-4 text-center\">Редактор тестів</h2>\r\n      <div className=\"menu-box d-flex flex-column gap-2\">\r\n        <Link href=\"/editor/new\" className=\"btn btn-primary w-100\">Додати новий тест</Link>\r\n        <div className=\"mt-2\">\r\n          <input className=\"form-control\" placeholder=\"Пошук за назвою тесту...\" value={query} onChange={(e) => { setQuery(e.target.value); setPage(1); }} />\r\n        </div>\r\n        <div className=\"mt-3\">\r\n          <h3 className=\"h6\">Мої тести</h3>\r\n          {loading ? (\r\n            <div className=\"text-muted\">Завантаження...</div>\r\n          ) : tests.length === 0 ? (\r\n            <div className=\"text-muted\">У вас ще немає створених тестів.</div>\r\n          ) : (\r\n            <div className=\"list-group transparent-list\">\r\n              {tests.filter((t) => t.title.toLowerCase().includes(query.toLowerCase())).map((t) => (\r\n                <div key={t._id} className=\"list-group-item d-flex justify-content-between align-items-start\">\r\n                  <div>\r\n                    <div className=\"fw-semibold\">{t.title}</div>\r\n                    {t.description ? <div className=\"text-muted small\">{t.description}</div> : null}\r\n                  </div>\r\n                  <div>\r\n                    <Link href={`/editor/new?edit=${t._id}`} className=\"btn btn-sm btn-outline-primary\">Редагувати</Link>\r\n                    {t.storeResponses ? (\r\n                      <Link href={`/editor/attempts/${t._id}`} className=\"btn btn-sm btn-outline-secondary ms-2\">Проходження</Link>\r\n                    ) : null}\r\n                    <button\r\n                      className=\"btn btn-sm btn-outline-danger ms-2\"\r\n                      onClick={async () => {\r\n                        try {\r\n                          const ok = confirm(\"Видалити тест? Цю дію не можна відмінити.\");\r\n                          if (!ok) return;\r\n                          setDeletingId(t._id);\r\n                          const res = await fetch(`/api/tests/${t._id}`, { method: \"DELETE\", credentials: \"include\" });\r\n                          if (!res.ok) {\r\n                            const txt = await res.text();\r\n                            throw new Error(txt || `HTTP ${res.status}`);\r\n                          }\r\n                          setTests((s) => s.filter((x) => x._id !== t._id));\r\n                        } catch (err) {\r\n                          console.warn(\"Failed to delete test:\", err);\r\n                          alert(\"Не вдалося видалити тест\");\r\n                        } finally {\r\n                          setDeletingId(null);\r\n                        }\r\n                      }}\r\n                      disabled={deletingId === t._id}\r\n                    >\r\n                      {deletingId === t._id ? \"Видаляю...\" : \"Видалити\"}\r\n                    </button>\r\n                    <button\r\n                      className=\"btn btn-sm btn-outline-success ms-2\"\r\n                        onClick={async () => {\r\n                          try {\r\n                            // copy only the test id (code)\r\n                            const code = t._id;\r\n                            if (navigator.clipboard && navigator.clipboard.writeText) {\r\n                              await navigator.clipboard.writeText(code);\r\n                            } else {\r\n                              // fallback for older browsers\r\n                              const tmp = document.createElement(\"input\");\r\n                              document.body.appendChild(tmp);\r\n                              tmp.value = code;\r\n                              tmp.select();\r\n                              document.execCommand(\"copy\");\r\n                              document.body.removeChild(tmp);\r\n                            }\r\n                            setCopiedId(t._id);\r\n                            setTimeout(() => setCopiedId(null), 2500);\r\n                          } catch (err) {\r\n                            console.warn(\"Failed to copy id:\", err);\r\n                            alert(\"Не вдалося скопіювати код тесту\");\r\n                          }\r\n                        }}\r\n                    >\r\n                      {copiedId === t._id ? \"Скопійовано!\" : \"Поділитись\"}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <div className=\"d-flex justify-content-between align-items-center mt-3\">\r\n            <button className=\"btn btn-outline-secondary\" disabled={page <= 1} onClick={() => setPage((p) => Math.max(1, p - 1))}>Назад</button>\r\n            <div>Сторінка {page} / {totalPages}</div>\r\n            <button className=\"btn btn-outline-secondary\" disabled={page >= totalPages} onClick={() => setPage((p) => Math.min(totalPages, p + 1))}>Далі</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}