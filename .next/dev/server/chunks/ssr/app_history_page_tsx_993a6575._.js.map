{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/app/history/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function HistoryPage() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [attempts, setAttempts] = useState<any[]>([]);\r\n  const [query, setQuery] = useState(\"\");\r\n  const [fromDate, setFromDate] = useState(\"\");\r\n  const [toDate, setToDate] = useState(\"\");\r\n  const [author, setAuthor] = useState(\"\");\r\n  const [page, setPage] = useState<number>(1);\r\n  const [totalPages, setTotalPages] = useState<number>(1);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      setLoading(true);\r\n      try {\r\n        let url = `/api/attempts/me`;\r\n        const params: string[] = [];\r\n        if (query) params.push(`test=${encodeURIComponent(query)}`);\r\n        if (author) params.push(`author=${encodeURIComponent(author)}`);\r\n        if (fromDate) params.push(`from=${encodeURIComponent(fromDate)}`);\r\n        if (toDate) params.push(`to=${encodeURIComponent(toDate)}`);\r\n        params.push(`page=${page}`);\r\n        params.push(`limit=10`);\r\n        if (params.length) url += `?${params.join(\"&\")}`;\r\n        const res = await fetch(url, { credentials: \"include\" });\r\n        if (!res.ok) {\r\n          const txt = await res.text().catch(() => undefined);\r\n          setError(txt || `HTTP ${res.status}`);\r\n          return;\r\n        }\r\n        const data = await res.json();\r\n        if (mounted && data?.ok) {\r\n          setAttempts(data.attempts || []);\r\n          setTotalPages(data.totalPages || 1);\r\n        }\r\n      } catch (err) {\r\n        console.warn(err);\r\n        setError(\"Не вдалося завантажити історію проходжень\");\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, [query, fromDate, toDate, page]);\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n      <h2 className=\"mb-3\">Історія тестувань</h2>\r\n      <div className=\"menu-box w-100\">\r\n        <div className=\"d-flex gap-2 mb-3\">\r\n          <input className=\"form-control\" placeholder=\"Пошук за назвою тесту\" value={query} onChange={(e) => { setQuery(e.target.value); setPage(1); }} />\r\n          <input className=\"form-control\" placeholder=\"Пошук за автором\" value={author} onChange={(e) => { setAuthor(e.target.value); setPage(1); }} />\r\n          <input className=\"form-control\" type=\"date\" value={fromDate} onChange={(e) => { setFromDate(e.target.value); setPage(1); }} placeholder=\"Від\" />\r\n          <input className=\"form-control\" type=\"date\" value={toDate} onChange={(e) => { setToDate(e.target.value); setPage(1); }} placeholder=\"До\" />\r\n          <Link href=\"/\"><button className=\"btn btn-outline-secondary\">Назад</button></Link>\r\n        </div>\r\n        {loading ? (\r\n          <div className=\"text-muted\">Завантаження...</div>\r\n        ) : error ? (\r\n          <div className=\"text-danger\">{error}</div>\r\n        ) : attempts.length === 0 ? (\r\n          <div className=\"text-muted\">Ви ще нічого не проходили.</div>\r\n        ) : (\r\n          <div className=\"list-group\">\r\n            {attempts.map((a) => (\r\n              // Only make the item a link if per-question details are available\r\n              a.details && a.details.perQuestion ? (\r\n                <Link key={a.id} href={`/history/${a.id}`} className=\"list-group-item list-group-item-action text-decoration-none\">\r\n                  <div className=\"d-flex justify-content-between align-items-start\">\r\n                    <div>\r\n                      <div className=\"fw-semibold\">{a.title}</div>\r\n                      <div className=\"text-muted small\">{new Date(a.createdAt).toLocaleString()}</div>\r\n                    </div>\r\n                    <div className=\"text-end\">\r\n                      <div className=\"fw-semibold\">{typeof a.details.totalScore !== 'undefined' ? `${a.details.totalScore} / ${a.details.totalPossible}` : \"\"}</div>\r\n                    </div>\r\n                  </div>\r\n                </Link>\r\n              ) : (\r\n                <div key={a.id} className=\"list-group-item\">\r\n                  <div className=\"d-flex justify-content-between align-items-start\">\r\n                    <div>\r\n                      <div className=\"fw-semibold\">{a.title}</div>\r\n                      <div className=\"text-muted small\">{new Date(a.createdAt).toLocaleString()}</div>\r\n                    </div>\r\n                    <div className=\"text-end\">\r\n                      {a.details && typeof a.details.totalScore !== 'undefined' ? (\r\n                        <div className=\"fw-semibold\">{a.details.totalScore} / {a.details.totalPossible}</div>\r\n                      ) : (\r\n                        <div className=\"text-muted\">Деталі заборонено</div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )\r\n            ))}\r\n          </div>\r\n        )}\r\n        <div className=\"d-flex justify-content-between align-items-center mt-3\">\r\n          <button className=\"btn btn-outline-secondary\" disabled={page <= 1} onClick={() => setPage((p) => Math.max(1, p - 1))}>Назад</button>\r\n          <div>Сторінка {page} / {totalPages}</div>\r\n          <button className=\"btn btn-outline-secondary\" disabled={page >= totalPages} onClick={() => setPage((p) => Math.min(totalPages, p + 1))}>Далі</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}