{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/app/page.tsx"],"sourcesContent":["\"use client\";\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\nexport default function Home() {\n  const [user, setUser] = useState<{ username: string } | null>(null);\n  const [loading, setLoading] = useState(true);\n  const router = useRouter();\n  const [hasDraft, setHasDraft] = useState(false);\n\n  async function loadUser() {\n    try {\n      const res = await fetch(\"/api/me\", { credentials: \"include\" });\n      if (!res.ok) {\n        setUser(null);\n      } else {\n        const data = await res.json();\n        setUser(data?.user ?? null);\n      }\n    } catch (err) {\n      console.error(\"Home /api/me error:\", err);\n      setUser(null);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    loadUser();\n\n    // Also listen for explicit refresh trigger (we can set localStorage key after login)\n    const onStorage = (e: StorageEvent) => {\n      if (e.key === \"auth-refresh\") {\n        loadUser();\n      }\n    };\n    window.addEventListener?.(\"storage\", onStorage);\n    const onAuth = () => loadUser();\n    window.addEventListener?.(\"auth-refresh\", onAuth);\n    return () => {\n      window.removeEventListener?.(\"storage\", onStorage);\n      window.removeEventListener?.(\"auth-refresh\", onAuth);\n    };\n  }, []);\n\n  // check for saved draft\n  useEffect(() => {\n    try {\n      const raw = typeof window !== \"undefined\" ? window.localStorage.getItem(\"test_draft_v1\") : null;\n      setHasDraft(!!raw);\n    } catch {\n      setHasDraft(false);\n    }\n    const onStorage = (e: StorageEvent) => {\n      if (e.key === \"test_draft_v1\") {\n        try { setHasDraft(!!e.newValue); } catch { setHasDraft(false); }\n      }\n    };\n    window.addEventListener?.(\"storage\", onStorage);\n    return () => { window.removeEventListener?.(\"storage\", onStorage); };\n  }, []);\n\n  useEffect(() => {\n    try {\n      document.title = \"TestHub | Головна сторінка\";\n    } catch {}\n  }, []);\n\n  const isAuth = !!user;\n  const username = user?.username ?? null;\n\n  async function handleLogout() {\n    try {\n      const res = await fetch(\"/api/logout\", { method: \"POST\", credentials: \"include\" });\n      // update clients locally\n      setUser(null);\n      try { localStorage.setItem(\"auth-refresh\", String(Date.now())); } catch {}\n      try { window.dispatchEvent(new Event(\"auth-refresh\")); } catch {}\n      try { router.refresh(); } catch {}\n      if (!res.ok) {\n        console.warn(\"Logout failed\", await res.text());\n      }\n    } catch (err) {\n      console.error(\"Logout error:\", err);\n    }\n  }\n\n  return (\n    <div className=\"container d-flex flex-column align-items-center justify-content-center min-vh-100 home-menu\">\n      <div className=\"mb-4 text-center\">\n        <h1 className=\"display-5 fw-semibold\">TestHub</h1>\n      </div>\n\n      <div className=\"card p-4 shadow-sm text-center app-card menu-box\">\n        <Link href=\"/tests\">\n          <button className=\"btn btn-outline-dark w-100 mb-2\">Список публічних тестів</button>\n        </Link>\n        <Link href=\"/run\">\n          <button className=\"btn btn-outline-dark w-100 mb-2\">Пройти тест за кодом</button>\n        </Link>\n\n        {isAuth && (\n          <>\n            <Link href=\"/profile\">\n              <button className=\"btn btn-outline-dark w-100 mb-2\">Історія тестувань</button>\n            </Link>\n            <Link href=\"/editor\">\n              <button className=\"btn btn-outline-dark w-100 mb-2\">Створити тест</button>\n            </Link>\n          </>\n        )}\n\n        {!isAuth && (\n          <p className=\"text-muted mt-3 mb-0\">Увійди, щоб отримати більше можливостей</p>\n        )}\n      </div>\n\n      <div className=\"d-flex gap-2 mt-3\">\n        {!isAuth ? (\n          <>\n            <Link href=\"/login\">\n              <button className=\"btn btn-primary\">Увійти</button>\n            </Link>\n            <Link href=\"/register\">\n              <button className=\"btn btn-outline-primary\">Зареєструватись</button>\n            </Link>\n          </>\n        ) : (\n          <>\n            {/* logout button under the panel */}\n            <button onClick={handleLogout} className=\"btn btn-danger\">Вийти</button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}