{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/app/tests/%5Bid%5D/take/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\n\r\ntype Q = any;\r\n\r\nexport default function TakePageClient() {\r\n  const params = useParams();\r\n  const id = params?.id;\r\n  const router = useRouter();\r\n  const [test, setTest] = useState<any | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [answers, setAnswers] = useState<Record<string, any>>({});\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      if (!id) return;\r\n      try {\r\n        const res = await fetch(`/api/public-tests/${id}`);\r\n        if (!res.ok) {\r\n          console.warn(await res.text());\r\n          if (mounted) setLoading(false);\r\n          return;\r\n        }\r\n        const data = await res.json();\r\n        if (mounted) {\r\n          // create shuffled display order for options/pairs per question\r\n          function shuffleArray<T>(arr: T[]) {\r\n            const a = Array.isArray(arr) ? [...arr] : [];\r\n            for (let i = a.length - 1; i > 0; i--) {\r\n              const j = Math.floor(Math.random() * (i + 1));\r\n              const tmp = a[i];\r\n              a[i] = a[j];\r\n              a[j] = tmp;\r\n            }\r\n            return a;\r\n          }\r\n          const t = data.test;\r\n          const mapped = Array.isArray(t.questions) ? t.questions.map((q: any) => {\r\n            const copy: any = { ...q };\r\n            const opts = q.options || q.data?.options || [];\r\n            const pairs = q.pairs || q.data?.pairs || [];\r\n            if (q.type === \"single_choice\" || q.type === \"single\" || q.type === \"multi_choice\" || q.type === \"multi\" || q.type === \"sequence\") {\r\n              copy._displayOptions = shuffleArray(opts.map((o: any) => ({ ...o })));\r\n            }\r\n            if (q.type === \"matching\") {\r\n              // For matching, shuffle left and right sides independently so taker must match.\r\n              // Use a robust pairId (p.id || p._id || index) to work with varying DB shapes.\r\n              const lefts = pairs.map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.left }));\r\n              const rights = pairs.map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.right }));\r\n              copy._displayLeft = shuffleArray(lefts);\r\n              copy._displayRight = shuffleArray(rights);\r\n            }\r\n            return copy;\r\n          }) : [];\r\n          setTest({ ...t, questions: mapped });\r\n        }\r\n      } catch (err) {\r\n        console.warn(err);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, [id]);\r\n\r\n  function onSingle(q: Q, optionId: number) {\r\n    setAnswers((s) => ({ ...s, [q.id]: optionId }));\r\n  }\r\n\r\n  function onMulti(q: Q, optionId: number) {\r\n    setAnswers((s) => {\r\n      const cur: number[] = s[q.id] || [];\r\n      const next = cur.includes(optionId) ? cur.filter((x) => x !== optionId) : [...cur, optionId];\r\n      return { ...s, [q.id]: next };\r\n    });\r\n  }\r\n\r\n  function onOpen(q: Q, text: string) {\r\n    setAnswers((s) => ({ ...s, [q.id]: text }));\r\n  }\r\n\r\n  function onSequenceChange(q: Q, itemId: string | number, pos: number | \"\") {\r\n    setAnswers((s) => {\r\n      const cur = typeof s[q.id] === \"object\" && s[q.id] !== null ? { ...s[q.id] } : {};\r\n      if (pos === \"\" || pos === null) {\r\n        delete cur[itemId];\r\n      } else {\r\n        cur[itemId] = Number(pos);\r\n      }\r\n      return { ...s, [q.id]: cur };\r\n    });\r\n  }\r\n\r\n  function onMatchSelect(q: Q, leftPairId: string | number, rightPairId: string | number) {\r\n    setAnswers((s) => {\r\n      const cur = typeof s[q.id] === \"object\" && s[q.id] !== null ? { ...s[q.id] } : {};\r\n      cur[leftPairId] = rightPairId;\r\n      return { ...s, [q.id]: cur };\r\n    });\r\n  }\r\n\r\n  function onStart() {\r\n    // placeholder: scroll to questions\r\n    const el = document.querySelector(\".questions-section\");\r\n    if (el) el.scrollIntoView({ behavior: \"smooth\" });\r\n  }\r\n\r\n  function submitLocal() {\r\n    console.log(\"User answers:\", answers);\r\n    alert(\"Відповіді збережено локально (консоль).\");\r\n    router.push(\"/tests\");\r\n  }\r\n\r\n  if (loading) return <div className=\"container min-vh-100\">Завантаження...</div>;\r\n  if (!test) return <div className=\"container min-vh-100\">Тест не знайдено або недоступний.</div>;\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n      <h2 className=\"mb-3\">{test.title}</h2>\r\n      <div className=\"text-muted mb-3\">Автор: {test.authorId?.username || \"(невідомо)\"}</div>\r\n\r\n      <div className=\"menu-box w-100 questions-section\">\r\n        {Array.isArray(test.questions) && test.questions.map((q: any, idx: number) => (\r\n          <div key={q.id} className=\"mb-4\">\r\n            <div className=\"fw-semibold\">{idx + 1}. {q.text}</div>\r\n            <div className=\"mt-2\">\r\n              {q.type === \"single_choice\" || q.type === \"single\" ? (\r\n                <div>\r\n                  {(q._displayOptions || q.options || q.data?.options || []).map((opt: any) => (\r\n                    <label key={opt.id} className=\"d-block mb-1\">\r\n                      <input type=\"radio\" name={`q-${q.id}`} checked={answers[q.id] === opt.id} onChange={() => onSingle(q, opt.id)} /> {opt.text}\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"multi_choice\" || q.type === \"multi\" ? (\r\n                <div>\r\n                  {(q._displayOptions || q.options || q.data?.options || []).map((opt: any) => (\r\n                    <label key={opt.id} className=\"d-block mb-1\">\r\n                      <input type=\"checkbox\" checked={(answers[q.id] || []).includes(opt.id)} onChange={() => onMulti(q, opt.id)} /> {opt.text}\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"sequence\" ? (\r\n                <div>\r\n                  <div className=\"list-group\">\r\n                      {((q._displayOptions || q.options || q.data?.options || []) as any[]).map((it: any, i: number) => (\r\n                      <div key={it.id} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                        <div className=\"flex-fill\">{it.text}</div>\r\n                        <div className=\"w-50\">\r\n                          <input\r\n                            className=\"form-control bg-white\"\r\n                            type=\"number\"\r\n                            min={1}\r\n                            max={(q._displayOptions || q.options || q.data?.options || []).length}\r\n                            value={(answers[q.id] && answers[q.id][it.id]) || \"\"}\r\n                            onChange={(e) => onSequenceChange(q, it.id, e.target.value === \"\" ? \"\" : Number(e.target.value))}\r\n                            placeholder=\"№ в послідовності\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              ) : q.type === \"matching\" ? (\r\n                    <div className=\"list-group\">\r\n                      {(q._displayLeft || []).map((l: any) => (\r\n                        <div key={l.pairId} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                          <div className=\"flex-fill\">{l.text}</div>\r\n                          <div className=\"w-50\">\r\n                            <select\r\n                              className=\"form-select\"\r\n                              value={(answers[q.id] && (answers[q.id][l.pairId] ?? \"\"))}\r\n                              onChange={(e) => onMatchSelect(q, l.pairId, e.target.value)}\r\n                            >\r\n                              <option value=\"\">-- Виберіть відповідність --</option>\r\n                              {(q._displayRight || []).map((r: any) => (\r\n                                <option key={r.pairId} value={r.pairId}>{r.text}</option>\r\n                              ))}\r\n                            </select>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n              ) : q.type === \"open\" ? (\r\n                <div>\r\n                  <textarea className=\"form-control\" rows={3} value={answers[q.id] || \"\"} onChange={(e) => onOpen(q, e.target.value)} />\r\n                </div>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n        <div className=\"d-flex gap-2\">\r\n          <button className=\"btn btn-primary\" onClick={submitLocal}>Завершити та надіслати</button>\r\n          <Link href=\"/tests\"><button className=\"btn btn-outline-secondary\">Відмінити</button></Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}