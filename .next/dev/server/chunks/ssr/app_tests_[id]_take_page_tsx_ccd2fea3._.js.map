{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///usr/src/app/app/tests/%5Bid%5D/take/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\n\r\ntype Q = any;\r\n\r\nexport default function TakePageClient() {\r\n  const params = useParams();\r\n  const id = params?.id;\r\n  const router = useRouter();\r\n  const [test, setTest] = useState<any | null>(null);\r\n  const [viewer, setViewer] = useState<any | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [lightboxUrl, setLightboxUrl] = useState<string | null>(null);\r\n  const [answers, setAnswers] = useState<Record<string, any>>({});\r\n  const [started, setStarted] = useState<boolean>(false);\r\n  const [submitting, setSubmitting] = useState<boolean>(false);\r\n  const [resultPreview, setResultPreview] = useState<any | null>(null);\r\n  const [remainingSeconds, setRemainingSeconds] = useState<number | null>(null);\r\n  const timerRef = (typeof window !== \"undefined\") ? { current: null as any } : { current: null as any };\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      if (!id) return;\r\n      try {\r\n        const res = await fetch(`/api/public-tests/${id}`);\r\n        if (!res.ok) {\r\n          console.warn(await res.text());\r\n          if (mounted) setLoading(false);\r\n          return;\r\n        }\r\n        const data = await res.json();\r\n        if (mounted) {\r\n          // create shuffled display order for options/pairs per question\r\n          function shuffleArray<T>(arr: T[]) {\r\n            const a = Array.isArray(arr) ? [...arr] : [];\r\n            for (let i = a.length - 1; i > 0; i--) {\r\n              const j = Math.floor(Math.random() * (i + 1));\r\n              const tmp = a[i];\r\n              a[i] = a[j];\r\n              a[j] = tmp;\r\n            }\r\n            return a;\r\n          }\r\n          const t = data.test;\r\n          // determine availability window on client\r\n          const now = new Date();\r\n          const windowEnabled = !!t.dateWindowEnabled;\r\n          const openFrom = t.openFrom ? new Date(t.openFrom) : null;\r\n          const openTo = t.openTo ? new Date(t.openTo) : null;\r\n          const inWindow = !windowEnabled || ((openFrom ? now >= openFrom : true) && (openTo ? now <= openTo : true));\r\n\r\n          const mapped = Array.isArray(t.questions) ? t.questions.map((q: any) => {\r\n            const copy: any = { ...q };\r\n            const opts = q.options || q.data?.options || [];\r\n            const pairs = q.pairs || q.data?.pairs || [];\r\n            if (q.type === \"single_choice\" || q.type === \"single\" || q.type === \"multi_choice\" || q.type === \"multi\" || q.type === \"sequence\") {\r\n              copy._displayOptions = shuffleArray(opts.map((o: any) => ({ ...o })));\r\n            }\r\n            if (q.type === \"matching\") {\r\n              // For matching, shuffle left and right sides independently so taker must match.\r\n              // Use a robust pairId (p.id || p._id || index) to work with varying DB shapes.\r\n              const lefts = pairs.map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.left }));\r\n              const rights = pairs.map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.right }));\r\n              copy._displayLeft = shuffleArray(lefts);\r\n              copy._displayRight = shuffleArray(rights);\r\n            }\r\n            return copy;\r\n          }) : [];\r\n          setTest({ ...t, questions: mapped, __inWindow: inWindow });\r\n          // if server provided viewer info, set it\r\n          if (t._viewer) setViewer(t._viewer);\r\n        }\r\n      } catch (err) {\r\n        console.warn(err);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, [id]);\r\n\r\n  useEffect(() => {\r\n    if (!test) return;\r\n    try {\r\n      const key = `test_start_${id}`;\r\n      if (typeof window !== \"undefined\" && localStorage.getItem(key)) {\r\n        localStorage.removeItem(key);\r\n        onStart();\r\n      }\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }, [test]);\r\n\r\n  useEffect(() => {\r\n    if (!lightboxUrl) return;\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") setLightboxUrl(null);\r\n    }\r\n    window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [lightboxUrl]);\r\n\r\n  function onSingle(q: Q, optionId: number) {\r\n    setAnswers((s) => ({ ...s, [q.id]: optionId }));\r\n  }\r\n\r\n  function onMulti(q: Q, optionId: number) {\r\n    setAnswers((s) => {\r\n      const cur: number[] = s[q.id] || [];\r\n      const next = cur.includes(optionId) ? cur.filter((x) => x !== optionId) : [...cur, optionId];\r\n      return { ...s, [q.id]: next };\r\n    });\r\n  }\r\n\r\n  function onOpen(q: Q, text: string) {\r\n    setAnswers((s) => ({ ...s, [q.id]: text }));\r\n  }\r\n\r\n  function onSequenceChange(q: Q, itemId: string | number, pos: number | \"\") {\r\n    setAnswers((s) => {\r\n      const cur = typeof s[q.id] === \"object\" && s[q.id] !== null ? { ...s[q.id] } : {};\r\n      if (pos === \"\" || pos === null) {\r\n        delete cur[itemId];\r\n      } else {\r\n        cur[itemId] = Number(pos);\r\n      }\r\n      return { ...s, [q.id]: cur };\r\n    });\r\n  }\r\n\r\n  function onMatchSelect(q: Q, leftPairId: string | number, rightPairId: string | number) {\r\n    setAnswers((s) => {\r\n      const cur = typeof s[q.id] === \"object\" && s[q.id] !== null ? { ...s[q.id] } : {};\r\n      cur[leftPairId] = rightPairId;\r\n      return { ...s, [q.id]: cur };\r\n    });\r\n  }\r\n\r\n  function onStart() {\r\n    // placeholder: scroll to questions\r\n    const el = document.querySelector(\".questions-section\");\r\n    if (el) el.scrollIntoView({ behavior: \"smooth\" });\r\n    // start timer if test is timed\r\n    if (test?.timed && !started) {\r\n      const secs = Number(test.timeLimitMinutes) ? Math.max(1, Math.floor(Number(test.timeLimitMinutes) * 60)) : 0;\r\n      setRemainingSeconds(secs);\r\n      setStarted(true);\r\n      if (timerRef.current) clearInterval(timerRef.current);\r\n      timerRef.current = setInterval(() => {\r\n        setRemainingSeconds((s) => {\r\n          if (s === null) return s;\r\n          if (s <= 1) {\r\n            // time's up\r\n            clearInterval(timerRef.current);\r\n            submitLocal();\r\n            return 0;\r\n          }\r\n          return s - 1;\r\n        });\r\n      }, 1000);\r\n    }\r\n  }\r\n\r\n  function submitLocal() {\r\n    try { if (timerRef.current) clearInterval(timerRef.current); } catch {}\r\n    if (submitting) return; // prevent duplicate submits\r\n    setSubmitting(true);\r\n    (async () => {\r\n      let didRedirect = false;\r\n      try {\r\n        const res = await fetch(`/api/public-tests/${id}/submit`, {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ answers }),\r\n        });\r\n        if (!res.ok) {\r\n          const txt = await res.text();\r\n          console.warn(\"Submit error:\", txt);\r\n          alert(\"Помилка надсилання відповіді\");\r\n          router.push(\"/tests\");\r\n          return;\r\n        }\r\n        const data = await res.json();\r\n        if (data && data.ok) {\r\n          // If server returned an attemptId, it was saved — behave as before.\r\n          if (data.attemptId) {\r\n            try { if (typeof window !== \"undefined\") alert(\"Відповіді збережено\"); } catch {}\r\n            didRedirect = true;\r\n            router.push(\"/\");\r\n            return;\r\n          }\r\n          // Anonymous taker and server did not persist: show immediate results according to returned payload\r\n          setResultPreview(data);\r\n          return;\r\n        } else {\r\n          alert(\"Невідома відповідь від сервера.\");\r\n        }\r\n      } catch (err) {\r\n        console.warn(err);\r\n        alert(\"Помилка надсилання відповіді\");\r\n      } finally {\r\n        // if we didn't already redirect to the saved attempt, go back to tests\r\n        setSubmitting(false);\r\n        if (!didRedirect) {\r\n          try {\r\n            if (typeof window !== \"undefined\" && window.location.pathname && window.location.pathname.startsWith(\"/history\")) {\r\n              // already on a history page — do nothing\r\n            } else {\r\n              router.push(\"/tests\");\r\n            }\r\n          } catch {\r\n            router.push(\"/tests\");\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  if (loading) return <div className=\"container min-vh-100\">Завантаження...</div>;\r\n  if (!test) return <div className=\"container min-vh-100\">Тест не знайдено або недоступний.</div>;\r\n  // if test is outside allowed window, show message\r\n  if (test.__inWindow === false) {\r\n    return (\r\n      <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n        <h2 className=\"mb-3\">{test.title}</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-warning\">Тест наразі недоступний за часовим вікном.</div>\r\n          <div className=\"mb-3\">\r\n            <Link href=\"/tests\" className=\"btn btn-outline-secondary\">Назад до списку</Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  function formatTime(secs: number | null) {\r\n    if (secs === null) return \"\";\r\n    const m = Math.floor(secs / 60);\r\n    const s = secs % 60;\r\n    return `${String(m).padStart(2, \"0\")}:${String(s).padStart(2, \"0\")}`;\r\n  }\r\n\r\n  const requiresLogin = !!test.storeResponses || !!test.requiresLogin;\r\n  const isAuthenticated = !!viewer;\r\n\r\n  if (requiresLogin && !isAuthenticated) {\r\n    return (\r\n      <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n        <h2 className=\"mb-3\">{test.title}</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-warning\">Цей тест вимагає реєстрації для проходження. Будь ласка, <a href=\"/login\">увійдіть</a> або <a href=\"/register\">зареєструйтесь</a>.</div>\r\n          <div className=\"mb-3\">\r\n            <Link href=\"/tests\" className=\"btn btn-outline-secondary\">Назад до списку</Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n      <h2 className=\"mb-3\">{test.title}</h2>\r\n      <div className=\"w-100 mb-2 d-flex justify-content-between align-items-center\">\r\n        <div>\r\n          {started ? (\r\n            <div className=\"badge bg-danger\">Час: {formatTime(remainingSeconds)}</div>\r\n          ) : null}\r\n        </div>\r\n        {test.timed ? <div className=\"text-muted\">Час на тест: {test.timeLimitMinutes} хв</div> : null}\r\n      </div>\r\n\r\n      <div className=\"menu-box w-100 questions-section\">\r\n        {Array.isArray(test.questions) && test.questions.map((q: any, idx: number) => (\r\n          <div key={q.id} className=\"mb-4\">\r\n            <div className=\"fw-semibold\">{idx + 1}. {q.text}</div>\r\n              <div className=\"mt-2\">\r\n                {q.imageUrl ? (\r\n                  <div className=\"mb-3\">\r\n                    <img\r\n                      src={q.imageUrl}\r\n                      alt={`Question ${idx + 1} image`}\r\n                      style={{\r\n                        cursor: \"pointer\",\r\n                        objectFit: \"contain\",\r\n                        maxWidth: \"33%\",\r\n                        maxHeight: \"33vh\",\r\n                        width: \"auto\",\r\n                        height: \"auto\",\r\n                        borderRadius: 8,\r\n                      }}\r\n                      onClick={() => setLightboxUrl(q.imageUrl)}\r\n                    />\r\n                  </div>\r\n                ) : null}\r\n              {q.type === \"single_choice\" || q.type === \"single\" ? (\r\n                <div>\r\n                  {(q._displayOptions || q.options || q.data?.options || []).map((opt: any) => (\r\n                    <label key={opt.id} className=\"d-block mb-1\">\r\n                      <input type=\"radio\" name={`q-${q.id}`} checked={answers[q.id] === opt.id} onChange={() => onSingle(q, opt.id)} /> {opt.text}\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"multi_choice\" || q.type === \"multi\" ? (\r\n                <div>\r\n                  {(q._displayOptions || q.options || q.data?.options || []).map((opt: any) => (\r\n                    <label key={opt.id} className=\"d-block mb-1\">\r\n                      <input type=\"checkbox\" checked={(answers[q.id] || []).includes(opt.id)} onChange={() => onMulti(q, opt.id)} /> {opt.text}\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"sequence\" ? (\r\n                <div>\r\n                  <div className=\"list-group\">\r\n                      {((q._displayOptions || q.options || q.data?.options || []) as any[]).map((it: any, i: number) => (\r\n                      <div key={it.id} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                        <div className=\"flex-fill\">{it.text}</div>\r\n                        <div className=\"w-50\">\r\n                          <input\r\n                            className=\"form-control bg-white\"\r\n                            type=\"number\"\r\n                            min={1}\r\n                            max={(q._displayOptions || q.options || q.data?.options || []).length}\r\n                            value={(answers[q.id] && answers[q.id][it.id]) || \"\"}\r\n                            onChange={(e) => onSequenceChange(q, it.id, e.target.value === \"\" ? \"\" : Number(e.target.value))}\r\n                            placeholder=\"№ в послідовності\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              ) : q.type === \"matching\" ? (\r\n                    <div className=\"list-group\">\r\n                      {(q._displayLeft || []).map((l: any) => (\r\n                        <div key={l.pairId} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                          <div className=\"flex-fill\">{l.text}</div>\r\n                          <div className=\"w-50\">\r\n                            <select\r\n                              className=\"form-select\"\r\n                              value={(answers[q.id] && (answers[q.id][l.pairId] ?? \"\"))}\r\n                              onChange={(e) => onMatchSelect(q, l.pairId, e.target.value)}\r\n                            >\r\n                              <option value=\"\">-- Виберіть відповідність --</option>\r\n                              {(q._displayRight || []).map((r: any) => (\r\n                                <option key={r.pairId} value={r.pairId}>{r.text}</option>\r\n                              ))}\r\n                            </select>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n              ) : q.type === \"open\" ? (\r\n                <div>\r\n                  <textarea className=\"form-control\" rows={3} value={answers[q.id] || \"\"} onChange={(e) => onOpen(q, e.target.value)} />\r\n                </div>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n        <div className=\"d-flex gap-2\">\r\n          <button className=\"btn btn-primary\" onClick={submitLocal} disabled={submitting}>{submitting ? \"Надсилаю...\" : \"Завершити та надіслати\"}</button>\r\n          <Link href=\"/tests\" className=\"btn btn-outline-secondary\">Відмінити</Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <Lightbox url={lightboxUrl} onClose={() => setLightboxUrl(null)} />\r\n    {resultPreview ? (\r\n      <div\r\n        onClick={() => setResultPreview(null)}\r\n        style={{ position: \"fixed\", inset: 0, background: \"rgba(0,0,0,0.6)\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", zIndex: 10000 }}\r\n      >\r\n        <div className=\"menu-box p-4\" style={{ maxWidth: 800, width: \"95%\" }} onClick={(e) => e.stopPropagation()}>\r\n          <h4>Результат</h4>\r\n          {typeof resultPreview.totalScore !== 'undefined' ? (\r\n            <div className=\"mb-2\"><strong>Бали:</strong> {resultPreview.totalScore} / {resultPreview.totalPossible}</div>\r\n          ) : null}\r\n          {Array.isArray(resultPreview.perQuestion) ? (\r\n            <div>\r\n              <h5>Деталі питань</h5>\r\n              <div className=\"list-group\">\r\n                {resultPreview.perQuestion.map((p: any, i: number) => (\r\n                  <div key={p.id || i} className=\"list-group-item\">\r\n                    <div className=\"d-flex justify-content-between\">\r\n                      <div>{i + 1}. {p.type}</div>\r\n                      <div>{p.score} / {p.points}</div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            !resultPreview.totalScore ? <div className=\"text-muted\">Результати не доступні.</div> : null\r\n          )}\r\n          <div className=\"mt-3 d-flex justify-content-end\">\r\n            <button className=\"btn btn-primary\" onClick={() => setResultPreview(null)}>Закрити</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    ) : null}\r\n    </>\r\n  );\r\n}\r\n\r\n// Lightbox overlay rendered at root of module so it's inside same component render\r\nfunction Lightbox({ url, onClose }: { url: string | null; onClose: () => void }) {\r\n  if (!url) return null;\r\n  return (\r\n    <div\r\n      onClick={onClose}\r\n      style={{\r\n        position: \"fixed\",\r\n        inset: 0,\r\n        background: \"rgba(0,0,0,0.75)\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        zIndex: 9999,\r\n        padding: 20,\r\n      }}\r\n    >\r\n      <img src={url} alt=\"preview\" style={{ maxWidth: \"90vw\", maxHeight: \"90vh\", borderRadius: 8 }} />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}