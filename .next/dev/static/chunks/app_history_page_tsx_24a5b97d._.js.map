{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/magistrature/Dockerwork/kursova/app/history/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function HistoryPage() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [attempts, setAttempts] = useState<any[]>([]);\r\n  const [query, setQuery] = useState(\"\");\r\n  const [fromDate, setFromDate] = useState(\"\");\r\n  const [toDate, setToDate] = useState(\"\");\r\n  const [author, setAuthor] = useState(\"\");\r\n  const [page, setPage] = useState<number>(1);\r\n  const [totalPages, setTotalPages] = useState<number>(1);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      setLoading(true);\r\n      try {\r\n        let url = `/api/attempts/me`;\r\n        const params: string[] = [];\r\n        if (query) params.push(`test=${encodeURIComponent(query)}`);\r\n        if (author) params.push(`author=${encodeURIComponent(author)}`);\r\n        if (fromDate) params.push(`from=${encodeURIComponent(fromDate)}`);\r\n        if (toDate) params.push(`to=${encodeURIComponent(toDate)}`);\r\n        params.push(`page=${page}`);\r\n        params.push(`limit=10`);\r\n        if (params.length) url += `?${params.join(\"&\")}`;\r\n        const res = await fetch(url, { credentials: \"include\" });\r\n        if (!res.ok) {\r\n          const txt = await res.text().catch(() => undefined);\r\n          setError(txt || `HTTP ${res.status}`);\r\n          return;\r\n        }\r\n        const data = await res.json();\r\n        if (mounted && data?.ok) {\r\n          setAttempts(data.attempts || []);\r\n          setTotalPages(data.totalPages || 1);\r\n        }\r\n      } catch (err) {\r\n        console.warn(err);\r\n        setError(\"Не вдалося завантажити історію проходжень\");\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, [query, fromDate, toDate, page]);\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n      <h2 className=\"mb-3\">Історія тестувань</h2>\r\n      <div className=\"menu-box w-100\">\r\n        <div className=\"d-flex gap-2 mb-3\">\r\n          <input className=\"form-control\" placeholder=\"Пошук за назвою тесту\" value={query} onChange={(e) => { setQuery(e.target.value); setPage(1); }} />\r\n          <input className=\"form-control\" placeholder=\"Пошук за автором\" value={author} onChange={(e) => { setAuthor(e.target.value); setPage(1); }} />\r\n          <input className=\"form-control\" type=\"date\" value={fromDate} onChange={(e) => { setFromDate(e.target.value); setPage(1); }} placeholder=\"Від\" />\r\n          <input className=\"form-control\" type=\"date\" value={toDate} onChange={(e) => { setToDate(e.target.value); setPage(1); }} placeholder=\"До\" />\r\n          <Link href=\"/\"><button className=\"btn btn-outline-secondary\">Назад</button></Link>\r\n        </div>\r\n        {loading ? (\r\n          <div className=\"text-muted\">Завантаження...</div>\r\n        ) : error ? (\r\n          <div className=\"text-danger\">{error}</div>\r\n        ) : attempts.length === 0 ? (\r\n          <div className=\"text-muted\">Ви ще нічого не проходили.</div>\r\n        ) : (\r\n          <div className=\"list-group\">\r\n            {attempts.map((a) => (\r\n              // Only make the item a link if per-question details are available\r\n              a.details && a.details.perQuestion ? (\r\n                <Link key={a.id} href={`/history/${a.id}`} className=\"list-group-item list-group-item-action text-decoration-none\">\r\n                  <div className=\"d-flex justify-content-between align-items-start\">\r\n                    <div>\r\n                      <div className=\"fw-semibold\">{a.title}</div>\r\n                      <div className=\"text-muted small\">{new Date(a.createdAt).toLocaleString()}</div>\r\n                    </div>\r\n                    <div className=\"text-end\">\r\n                      <div className=\"fw-semibold\">{typeof a.details.totalScore !== 'undefined' ? `${a.details.totalScore} / ${a.details.totalPossible}` : \"\"}</div>\r\n                    </div>\r\n                  </div>\r\n                </Link>\r\n              ) : (\r\n                <div key={a.id} className=\"list-group-item\">\r\n                  <div className=\"d-flex justify-content-between align-items-start\">\r\n                    <div>\r\n                      <div className=\"fw-semibold\">{a.title}</div>\r\n                      <div className=\"text-muted small\">{new Date(a.createdAt).toLocaleString()}</div>\r\n                    </div>\r\n                    <div className=\"text-end\">\r\n                      {a.details && typeof a.details.totalScore !== 'undefined' ? (\r\n                        <div className=\"fw-semibold\">{a.details.totalScore} / {a.details.totalPossible}</div>\r\n                      ) : (\r\n                        <div className=\"text-muted\">Деталі заборонено</div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )\r\n            ))}\r\n          </div>\r\n        )}\r\n        <div className=\"d-flex justify-content-between align-items-center mt-3\">\r\n          <button className=\"btn btn-outline-secondary\" disabled={page <= 1} onClick={() => setPage((p) => Math.max(1, p - 1))}>Назад</button>\r\n          <div>Сторінка {page} / {totalPages}</div>\r\n          <button className=\"btn btn-outline-secondary\" disabled={page >= totalPages} onClick={() => setPage((p) => Math.min(totalPages, p + 1))}>Далі</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}