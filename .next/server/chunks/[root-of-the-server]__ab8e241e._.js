module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},76214,e=>{"use strict";var t=e.i(26046),r=e.i(19901);let i=process.env.MONGODB_URL||process.env.MONGODB_URI;if(!i)throw Error("❌ Вкажи змінну MONGODB_URL або MONGODB_URI у .env.local");let s=e.g.mongoose;async function a(){return s.conn||(s.promise||(s.promise=t.default.connect(i,{serverSelectionTimeoutMS:1e4,connectTimeoutMS:1e4,socketTimeoutMS:45e3}).then(e=>e).catch(async e=>{console.error("MongoDB connection error (original):",e);let t=`Не вдалося підключитися до MongoDB. Перевірте MONGODB_URL у d:\\magistrature\\Dockerwork\\kursova\\.env.local, переконайтесь, що кластер працює, та що ваш IP добавлений в Network Access (whitelist) в Atlas. Оригінальна помилка: ${e?.message??String(e)}`;try{if("string"==typeof i&&i.startsWith("mongodb+srv://"))try{let e=new URL(i).hostname;t+=` SRV host: ${e}.`;try{let i=await r.default.resolveSrv(`_mongodb._tcp.${e}`);t+=` DNS SRV records: ${JSON.stringify(i)}.`}catch(e){t+=` DNS SRV lookup failed: ${e?.message??String(e)}.`}try{let i=await r.default.lookup(e);t+=` DNS lookup: ${JSON.stringify(i)}.`}catch(e){t+=` DNS lookup failed: ${e?.message??String(e)}.`}}catch(e){t+=` Failed to parse URL for additional diagnostics: ${e?.message??String(e)}.`}else try{let e=new URL(i).hostname;try{let i=await r.default.lookup(e);t+=` DNS lookup: ${JSON.stringify(i)}.`}catch(e){t+=` DNS lookup failed: ${e?.message??String(e)}.`}}catch{}}catch(e){t+=` (diagnostics failed: ${e?.message??String(e)})`}throw Error(t)})),s.conn=await s.promise),s.conn}s||(s=e.g.mongoose={conn:null,promise:null}),e.s(["connectToDB",()=>a])},26046,(e,t,r)=>{t.exports=e.x("mongoose",()=>require("mongoose"))},19901,(e,t,r)=>{t.exports=e.x("dns/promises",()=>require("dns/promises"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},9569,e=>{"use strict";var t=e.i(26046);let r=new t.default.Schema({email:{type:String,required:!0,unique:!0},username:{type:String,required:!0},password:{type:String,required:!0}}),i=t.default.models.User||t.default.model("User",r);e.s(["default",0,i])},19262,e=>{"use strict";var t=e.i(26046);let r=new t.default.Schema({id:{type:Number,required:!0},points:{type:Number,required:!1,default:1},type:{type:String,required:!0},text:{type:String,required:!0},imageUrl:{type:String,required:!1}},{discriminatorKey:"type",_id:!1}),i=new t.default.Schema({options:[{id:{type:Number,required:!0},text:{type:String,required:!0},correct:{type:Boolean,required:!0}}]},{_id:!1}),s=new t.default.Schema({options:[{id:{type:Number,required:!0},text:{type:String,required:!0},correct:{type:Boolean,required:!0}}]},{_id:!1}),a=new t.default.Schema({options:[{id:{type:Number,required:!0},text:{type:String,required:!0},order:{type:Number,required:!0}}]},{_id:!1}),n=new t.default.Schema({pairs:[{id:{type:Number,required:!0},left:{type:String,required:!0},right:{type:String,required:!0}}]},{_id:!1}),o=new t.default.Schema({answers:[{type:String}]},{_id:!1}),l=new t.default.Schema({title:{type:String,required:!0},description:{type:String,required:!1},authorId:{type:t.default.Schema.Types.ObjectId,required:!0,ref:"User"},visibility:{type:String,enum:["private","public"],default:"private"},storeResponses:{type:Boolean,default:!1},ownResultView:{type:String,enum:["full","score_only","nothing"],default:"full"},timed:{type:Boolean,default:!1},timeLimitMinutes:{type:Number,required:!1},dateWindowEnabled:{type:Boolean,default:!1},openFrom:{type:Date,required:!1},openTo:{type:Date,required:!1},questions:[r]});l.path("questions").discriminator("single_choice",i),l.path("questions").discriminator("multi_choice",s),l.path("questions").discriminator("sequence",a),l.path("questions").discriminator("matching",n),l.path("questions").discriminator("open",o);let d=t.default.models.Test||t.default.model("Test",l);e.s(["default",0,d])},15977,e=>{"use strict";var t=e.i(26046);let r=new t.default.Schema({userId:{type:t.default.Schema.Types.ObjectId,required:!1,ref:"User"},testId:{type:t.default.Schema.Types.ObjectId,required:!0,ref:"Test"},answers:{type:t.default.Schema.Types.Mixed,required:!1},totalScore:{type:Number,required:!0},totalPossible:{type:Number,required:!0},perQuestion:{type:[t.default.Schema.Types.Mixed],required:!0},createdAt:{type:Date,default:()=>new Date}},{timestamps:!1}),i=t.default.models.Attempt||t.default.model("Attempt",r);e.s(["default",0,i])},67124,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),s=e.i(59756),a=e.i(61916),n=e.i(14444),o=e.i(37092),l=e.i(69741),d=e.i(16795),u=e.i(87718),p=e.i(95169),c=e.i(47587),m=e.i(66012),f=e.i(70101),g=e.i(26937),y=e.i(10372),h=e.i(93695);e.i(52474);var S=e.i(220),w=e.i(89171),x=e.i(76214),v=e.i(19262),R=e.i(15977),b=e.i(68105);async function N(e,t){try{let r=await t.params,i=r?.id;if(!i)return w.NextResponse.json({error:"Missing id"},{status:400});let s=await e.json(),a=s?.answers||{},n=JSON.parse(JSON.stringify(a||{}));console.log("/api/public-tests/[id]/submit received answers:",n),await (0,x.connectToDB)();let o=await v.default.findById(String(i)).lean();if(!o)return w.NextResponse.json({error:"Not found"},{status:404});if("public"!==o.visibility)return w.NextResponse.json({error:"Not public"},{status:403});let l=null;if(o.storeResponses){if(!(l=await (0,b.getUserFromCookieServer)()))return w.NextResponse.json({error:"Authentication required to take this test"},{status:401})}else try{l=await (0,b.getUserFromCookieServer)()}catch{}let d=0,u=0,p=[];for(let e of o.questions||[]){let t=e.id,r="number"==typeof e.points?e.points:1;d+=r;let i=n[t]??n[String(t)],s=0;if("single_choice"===e.type){let t=(e.options||[]).find(e=>!0===e.correct);t&&void 0!==i&&String(i)===String(t.id)&&(s=r)}else if("multi_choice"===e.type){let t=(e.options||[]).filter(e=>!0===e.correct).map(e=>String(e.id)),a=Array.isArray(i)?i.map(e=>String(e)):[],n=new Set(a),o=new Set(t),l=t.length>0&&t.every(e=>n.has(e)),d=a.every(e=>o.has(e));l&&d&&(s=r)}else if("sequence"===e.type){let t=e.options||[];t.length>0&&t.every(e=>{let t=Number(e.order),r=i&&Object.prototype.hasOwnProperty.call(i,e.id)?Number(i[e.id]):void 0;return void 0!==r&&r===t})&&(s=r)}else if("matching"===e.type){let t=e.pairs||[],a=t.length||0,n=0;for(let e of t){let t=String(e.id),r=i||{};Object.prototype.hasOwnProperty.call(r,t)&&String(r[t]??"")===t&&n++}a>0&&(s=n/a*r)}else if("open"===e.type){let t=(e.answers||[]).map(e=>String(e||"").trim().toLowerCase()),a="string"==typeof i?String(i).trim().toLowerCase():"";a&&t.includes(a)&&(s=r)}s=Math.round((s+Number.EPSILON)*1e3)/1e3,p.push({id:t,type:e.type,points:r,score:s}),u+=s}if(u=Math.round((u+Number.EPSILON)*1e3)/1e3,!l&&!o.storeResponses){let e=o.ownResultView||"full",t={ok:!0};return"full"===e?(t.totalScore=u,t.totalPossible=d,t.perQuestion=p):"score_only"===e&&(t.totalScore=u,t.totalPossible=d),w.NextResponse.json(t,{status:200})}let c=null;try{if(l)try{let e=await R.default.find({userId:l._id,testId:o._id}).sort({createdAt:-1}).limit(5).lean(),t=JSON.stringify(n||{}),r=Date.now();for(let i of e)try{let e=JSON.stringify(i.answers||{}),s=r-new Date(i.createdAt).getTime();if(e===t&&s>=0&&s<=6e4)return console.log("Duplicate submit detected, returning existing attempt:",String(i._id)),w.NextResponse.json({ok:!0,totalScore:i.totalScore,totalPossible:i.totalPossible,perQuestion:i.perQuestion,attemptId:String(i._id),savedAnswers:i.answers},{status:200})}catch{}}catch(e){console.warn("Duplicate check failed:",e)}c=await R.default.create({userId:l?l._id:null,testId:o._id,answers:n,totalScore:u,totalPossible:d,perQuestion:p,createdAt:new Date}),console.log("/api/public-tests/[id]/submit created attempt id:",String(c._id))}catch(e){return console.error("Failed to save attempt:",e),w.NextResponse.json({error:"Failed to save attempt"},{status:500})}return w.NextResponse.json({ok:!0,totalScore:u,totalPossible:d,perQuestion:p,attemptId:String(c._id),savedAnswers:c.answers},{status:200})}catch(e){return console.error("/api/public-tests/[id]/submit POST error:",e),w.NextResponse.json({error:e?.message||String(e)},{status:500})}}e.s(["POST",()=>N],61622);var q=e.i(61622);let E=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/public-tests/[id]/submit/route",pathname:"/api/public-tests/[id]/submit",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/public-tests/[id]/submit/route.ts",nextConfigOutput:"",userland:q}),{workAsyncStorage:O,workUnitAsyncStorage:_,serverHooks:k}=E;function A(){return(0,i.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:_})}async function T(e,t,i){E.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/public-tests/[id]/submit/route";w=w.replace(/\/index$/,"")||"/";let x=await E.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:b,parsedUrl:N,isDraftMode:q,prerenderManifest:O,routerServerContext:_,isOnDemandRevalidate:k,revalidateOnlyGenerated:A,resolvedPathname:T,clientReferenceManifest:C,serverActionsManifest:D}=x,P=(0,l.normalizeAppPath)(w),I=!!(O.dynamicRoutes[P]||O.routes[T]),j=async()=>((null==_?void 0:_.render404)?await _.render404(e,t,N,!1):t.end("This page could not be found"),null);if(I&&!q){let e=!!O.routes[T],t=O.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await j();throw new h.NoFallbackError}}let M=null;!I||E.isDev||q||(M="/index"===(M=T)?"/":M);let U=!0===E.isDev||!I,B=I&&!U;D&&C&&(0,n.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:C,serverActionsManifest:D,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:D})});let $=e.method||"GET",H=(0,a.getTracer)(),L=H.getActiveScopeSpan(),F={params:R,prerenderManifest:O,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i)=>E.onRequestError(e,t,i,_)},sharedContext:{buildId:v}},K=new d.NodeNextRequest(e),G=new d.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let n=async e=>E.handle(V,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${$} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${w}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var a,l;let d=async({previousCacheEntry:r})=>{try{if(!o&&k&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(s);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let d=F.renderOpts.collectedTags;if(!I)return await (0,m.sendResponse)(K,G,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(a.headers);d&&(t[y.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,i=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:S.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:k})},_),t}},u=await E.handleResponse({req:e,nextConfig:b,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:O,isRoutePPREnabled:!1,isOnDemandRevalidate:k,revalidateOnlyGenerated:A,responseGenerator:d,waitUntil:i.waitUntil,isMinimalMode:o});if(!I)return null;if((null==u||null==(a=u.value)?void 0:a.kind)!==S.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",k?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),q&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,f.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&I||p.delete(y.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(K,G,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};L?await l(L):await H.withPropagatedContext(e.headers,()=>H.trace(p.BaseServerSpan.handleRequest,{spanName:`${$} ${w}`,kind:a.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:k})}),I)throw t;return await (0,m.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>A,"routeModule",()=>E,"serverHooks",()=>k,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>_],67124)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ab8e241e._.js.map