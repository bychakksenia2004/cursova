{"version":3,"sources":["../../../../app/editor/attempts/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function AttemptsPage() {\r\n  const params = useParams();\r\n  const id = params?.id;\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [attempts, setAttempts] = useState<any[]>([]);\r\n  const [query, setQuery] = useState(\"\");\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [page, setPage] = useState<number>(1);\r\n  const [totalPages, setTotalPages] = useState<number>(1);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      if (!id) return;\r\n      setLoading(true);\r\n      try {\r\n        let url = `/api/attempts/${id}`;\r\n        const params: string[] = [];\r\n        if (query) params.push(`user=${encodeURIComponent(query)}`);\r\n        params.push(`page=${page}`);\r\n        params.push(`limit=10`);\r\n        if (params.length) url += `?${params.join(\"&\")}`;\r\n        const res = await fetch(url, { credentials: \"include\" });\r\n        if (!res.ok) {\r\n          const txt = await res.text().catch(() => undefined);\r\n          setError(txt || `HTTP ${res.status}`);\r\n          return;\r\n        }\r\n        const data = await res.json();\r\n        if (mounted && data?.ok) {\r\n          setAttempts(data.attempts || []);\r\n          setTotalPages(data.totalPages || 1);\r\n        }\r\n      } catch (err) {\r\n        console.warn(err);\r\n        setError(\"Не вдалося завантажити проходження\");\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, [id, query, page]);\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n      <h2 className=\"mb-3\">Проходження тесту</h2>\r\n      <div className=\"menu-box w-100\">\r\n        <div className=\"d-flex gap-2 mb-3\">\r\n          <input className=\"form-control\" placeholder=\"Пошук за ім'ям користувача\" value={query} onChange={(e) => { setQuery(e.target.value); setPage(1); }} />\r\n          <Link href=\"/editor\" className=\"btn btn-outline-secondary\">Назад</Link>\r\n        </div>\r\n        {loading ? (\r\n          <div className=\"text-muted\">Завантаження...</div>\r\n        ) : error ? (\r\n          <div className=\"text-danger\">{error}</div>\r\n        ) : attempts.length === 0 ? (\r\n          <div className=\"text-muted\">Поки немає проходжень.</div>\r\n        ) : (\r\n          <div className=\"list-group\">\r\n            {attempts.map((a) => (\r\n              <Link key={a.id} href={`/history/${a.id}`} className=\"list-group-item list-group-item-action text-decoration-none d-flex justify-content-between align-items-center\">\r\n                <div>\r\n                  <div className=\"fw-semibold\">{a.username || \"Анонім\"}</div>\r\n                  <div className=\"text-muted small\">{new Date(a.createdAt).toLocaleString()}</div>\r\n                </div>\r\n                <div className=\"text-end\">\r\n                  <div className=\"fw-semibold\">{a.totalScore} / {a.totalPossible}</div>\r\n                </div>\r\n              </Link>\r\n            ))}\r\n          </div>\r\n        )}\r\n        <div className=\"d-flex justify-content-between align-items-center mt-3\">\r\n          <button className=\"btn btn-outline-secondary\" disabled={page <= 1} onClick={() => setPage((p) => Math.max(1, p - 1))}>Назад</button>\r\n          <div>Сторінка {page} / {totalPages}</div>\r\n          <button className=\"btn btn-outline-secondary\" disabled={page >= totalPages} onClick={() => setPage((p) => Math.min(totalPages, p + 1))}>Далі</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}