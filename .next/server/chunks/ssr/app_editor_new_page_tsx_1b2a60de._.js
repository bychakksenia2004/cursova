module.exports=[59260,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246);function f({qid:a,invalidField:c,text:d="",answers:e=[],onChange:f}){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("textarea",{className:`form-control ${c&&c.qid===(a||0)&&"text"===c.field?"is-invalid":""}`,rows:2,value:d,"data-qid":a,"data-field":"text",onChange:a=>f&&f({text:a.target.value,answers:e})}),c&&c.qid===(a||0)&&"text"===c.field&&(0,b.jsx)("div",{className:"invalid-feedback d-block app-error",children:c.message})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,b.jsx)("label",{className:"form-label mb-0",children:"Очікувана відповідь"}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:function(){let a=[...e,""];f&&f({text:d,answers:a})},children:"Додати відповідь"})]}),e.map((g,h)=>(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,b.jsx)("input",{className:`form-control ${c&&c.qid===(a||0)&&"answer"===c.field&&c.idx===h?"is-invalid":""}`,"data-qid":a,"data-field":"answer","data-idx":h,value:g,onChange:a=>{var b;let c;return b=a.target.value,c=e.map((a,c)=>c===h?b:a),void(f&&f({text:d,answers:c}))}}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>{let a;return a=e.filter((a,b)=>b!==h),void(f&&f({text:d,answers:a}))},children:"Видалити"}),c&&c.qid===(a||0)&&"answer"===c.field&&c.idx===h&&(0,b.jsx)("div",{className:"invalid-feedback d-block app-error",children:c.message})]},h))]})]})}function g({q:a,qid:c,invalidField:d,ensureOptions:e,addOptionToQuestion:f,updateOptionText:g,removeOption:h,toggleOptionCorrect:i}){return(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2",children:[(0,b.jsx)("strong",{className:"mb-0",children:"Варіанти відповіді"}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{e(a.id),f(a.id)},children:"Додати варіант"})]}),(a.data&&a.data.options||[]).map((e,f)=>(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,b.jsx)("div",{style:{marginTop:6},children:(0,b.jsx)("input",{type:"radio",name:`correct-${a.id}`,checked:!!e.correct,onChange:()=>i(a.id,e.id)})}),(0,b.jsx)("input",{className:`form-control ${d&&d.qid===(c||a.id)&&"option"===d.field&&(void 0===d.idx||d.idx===f)?"is-invalid":""}`,"data-qid":c||a.id,"data-field":"option","data-idx":f,value:e.text,onChange:b=>g(a.id,e.id,b.target.value)}),d&&d.qid===(c||a.id)&&"option"===d.field&&(void 0===d.idx||d.idx===f)&&(0,b.jsx)("div",{className:"invalid-feedback d-block app-error",children:d.message}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>h(a.id,e.id),children:"Видалити"})]},e.id))]})}function h({q:a,qid:c,invalidField:d,ensureOptions:e,addOptionToQuestion:f,updateOptionText:g,removeOption:h,toggleOptionCorrect:i}){return(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2",children:[(0,b.jsx)("strong",{className:"mb-0",children:"Варіанти відповіді"}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{e(a.id),f(a.id)},children:"Додати варіант"})]}),(a.data&&a.data.options||[]).map((e,f)=>(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,b.jsx)("div",{style:{marginTop:6},children:(0,b.jsx)("input",{type:"checkbox",checked:!!e.correct,onChange:()=>i(a.id,e.id)})}),(0,b.jsx)("input",{className:`form-control ${d&&d.qid===(c||a.id)&&"option"===d.field&&(void 0===d.idx||d.idx===f)?"is-invalid":""}`,"data-qid":c||a.id,"data-field":"option","data-idx":f,value:e.text,onChange:b=>g(a.id,e.id,b.target.value)}),d&&d.qid===(c||a.id)&&"option"===d.field&&(void 0===d.idx||d.idx===f)&&(0,b.jsx)("div",{className:"invalid-feedback d-block app-error",children:d.message}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>h(a.id,e.id),children:"Видалити"})]},e.id))]})}function i({q:a,qid:c,invalidField:d,addSequenceItem:e,updateSequenceItemText:f,updateSequenceItemOrder:g,removeSequenceItem:h}){return(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2",children:[(0,b.jsx)("strong",{className:"mb-0",children:"Елементи"}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>e(a.id),children:"Додати елемент"})]}),(a.data&&a.data.options||[]).slice().sort((a,b)=>(Number(a.order)||0)-(Number(b.order)||0)).map((e,g)=>(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,b.jsx)("div",{className:"form-control",style:{width:90,display:"flex",alignItems:"center",justifyContent:"center"},children:Number(e.order)||g+1}),(0,b.jsx)("input",{className:`form-control ${d&&d.qid===(c||a.id)&&"sequence"===d.field&&d.idx===g?"is-invalid":""}`,"data-qid":a.id,"data-field":"sequence","data-idx":g,value:e.text,onChange:b=>f(a.id,e.id,b.target.value)}),d&&d.qid===(c||a.id)&&"sequence"===d.field&&d.idx===g&&(0,b.jsx)("div",{className:"invalid-feedback d-block app-error",children:d.message}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>h(a.id,e.id),children:"Видалити"})]},e.id))]})}function j({q:a,qid:c,invalidField:d,addPairToQuestion:e,updatePairText:f,removePairFromQuestion:g}){return(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2",children:[(0,b.jsx)("strong",{className:"mb-0",children:"Пари відповідностей"}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>e(a.id),children:"Додати пару"})]}),(a.data&&a.data.pairs||[]).map((e,h)=>(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,b.jsx)("input",{className:`form-control ${d&&d.qid===(c||a.id)&&"pair"===d.field&&d.idx===h?"is-invalid":""}`,"data-qid":a.id,"data-field":"pair","data-idx":h,value:e.left,onChange:b=>f(a.id,e.id,"left",b.target.value),placeholder:"Ліва"}),(0,b.jsx)("span",{className:"align-self-center",children:"→"}),(0,b.jsx)("input",{className:`form-control ${d&&d.qid===(c||a.id)&&"pair"===d.field&&d.idx===h?"is-invalid":""}`,"data-qid":a.id,"data-field":"pair","data-idx":h,value:e.right,onChange:b=>f(a.id,e.id,"right",b.target.value),placeholder:"Права"}),d&&d.qid===(c||a.id)&&"pair"===d.field&&d.idx===h&&(0,b.jsx)("div",{className:"invalid-feedback d-block app-error",children:d.message}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>g(a.id,e.id),children:"Видалити"})]},e.id))]})}function k(){let a=(0,d.useRouter)(),k=(0,d.useSearchParams)();function l(a){_(b=>b.map(b=>b.id!==a?b:(b.data||(b.data={}),Array.isArray(b.data.options)||(b.data.options=[]),{...b})))}function m(a){let b={id:Date.now(),text:"",correct:!1};_(c=>c.map(c=>c.id===a?{...c,data:{...c.data||{},options:[...c.data&&c.data.options||[],b]}}:c))}function n(a,b,c){_(d=>d.map(d=>{if(d.id!==a)return d;let e=d.data&&d.data.options||[];return{...d,data:{...d.data||{},options:e.map(a=>a.id===b?{...a,text:c}:a)}}}))}function o(a,b){_(c=>c.map(c=>{if(c.id!==a)return c;let d=c.data&&c.data.options||[];return{...c,data:{...c.data||{},options:d.filter(a=>a.id!==b)}}}))}function p(a,b){_(c=>c.map(c=>{if(c.id!==a)return c;let d=c.data&&c.data.options||[];return"single"===c.type?{...c,data:{...c.data||{},options:d.map(a=>({...a,correct:a.id===b}))}}:{...c,data:{...c.data||{},options:d.map(a=>a.id===b?{...a,correct:!a.correct}:a)}}}))}function q(a){_(b=>b.map(b=>{if(b.id!==a)return b;let c=b.data&&b.data.options||[],d=c.reduce((a,b)=>Math.max(a,Number(b.order||0)),0),e={id:Date.now(),text:"",order:d+1};return{...b,data:{...b.data||{},options:[...c,e]}}}))}function r(a,b,c){_(d=>d.map(d=>{if(d.id!==a)return d;let e=d.data&&d.data.options||[];return{...d,data:{...d.data||{},options:e.map(a=>a.id===b?{...a,text:c}:a)}}}))}function s(a,b,c){_(d=>d.map(d=>{if(d.id!==a)return d;let e=d.data&&d.data.options||[];return{...d,data:{...d.data||{},options:e.map(a=>a.id===b?{...a,order:c}:a)}}}))}function t(a,b){_(c=>c.map(c=>{if(c.id!==a)return c;let d=c.data&&c.data.options||[];return{...c,data:{...c.data||{},options:d.filter(a=>a.id!==b)}}}))}function u(a){let b={id:Date.now(),left:"",right:""};_(c=>c.map(c=>c.id===a?{...c,data:{...c.data||{},pairs:[...c.data&&c.data.pairs||[],b]}}:c))}function v(a,b,c,d){_(e=>e.map(e=>{if(e.id!==a)return e;let f=e.data&&e.data.pairs||[];return{...e,data:{...e.data||{},pairs:f.map(a=>a.id===b?{...a,[c]:d}:a)}}}))}function w(a,b){_(c=>c.map(c=>{if(c.id!==a)return c;let d=c.data&&c.data.pairs||[];return{...c,data:{...c.data||{},pairs:d.filter(a=>a.id!==b)}}}))}let[x,y]=(0,c.useState)("single");function z(a,b){_(c=>c.map(c=>c.id===a?{...c,text:b}:c))}async function A(a){try{let b=new FormData;b.append("file",a),b.append("upload_preset","photobase");let c=await fetch("https://api.cloudinary.com/v1_1/dbwse9h4t/image/upload",{method:"POST",body:b});if(!c.ok)return console.error("Upload failed",await c.text()),null;let d=await c.json();return d.secure_url||d.url||null}catch(a){return console.error(a),null}}function B(a,b){_(c=>c.map(c=>c.id===a?{...c,imageUrl:b||void 0}:c))}let[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)("public"),[I,J]=(0,c.useState)(!0),[K,L]=(0,c.useState)("full"),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)(""),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)([]),[aa,ab]=(0,c.useState)([]),[ac,ad]=(0,c.useState)(null),[ae,af]=(0,c.useState)(null),[ag,ah]=(0,c.useState)(null),[ai,aj]=(0,c.useState)(!1);function ak(a,b){let c={...a};return c.id||(c.id=Date.now()+b+1),c.type||(c.type=c.type||"single"),void 0===c.text&&(c.text=""),c.data=c.data||{},"single"===c.type||"multi"===c.type?c.data.options=Array.isArray(c.data.options)?c.data.options.map((a,c)=>({id:a?.id||Date.now()+b+c+2,text:void 0===a?.text?"":a.text,correct:!!a?.correct})):[]:"sequence"===c.type?c.data.options=Array.isArray(c.data.options)?c.data.options.map((a,c)=>({id:a?.id||Date.now()+b+c+2,text:void 0===a?.text?"":a.text,order:void 0===a?.order?c+1:a.order})):[]:"matching"===c.type?c.data.pairs=Array.isArray(c.data.pairs)?c.data.pairs.map((a,c)=>({id:a?.id||Date.now()+b+c+2,left:void 0===a?.left?"":a.left,right:void 0===a?.right?"":a.right})):[]:"open"===c.type&&(c.data.answers=Array.isArray(c.data.answers)?c.data.answers.map(a=>void 0===a?"":a):[""]),c.points="number"==typeof c.points?c.points:c.data&&"number"==typeof c.data.points?c.data.points:1,c}function al(){try{return}catch(a){console.warn("Failed to load draft:",a)}}(0,c.useEffect)(()=>{try{document.title=ag?"TestHub | Редагування тесту":"TestHub | Новий тест"}catch{}},[ag]),(0,c.useEffect)(()=>{al();try{let a=k.get("edit");a&&(ah(a),async function(){try{let b=await fetch(`/api/tests/${a}`,{credentials:"include"});if(!b.ok){403===b.status&&aj(!0);return}let c=await b.json();if(c?.ok&&c.test){let a=c.test;D(a.title||""),F(a.description||""),H(a.visibility||"public"),J(!!a.storeResponses),L(a.ownResultView||"full"),N(!!a.timed),P("number"==typeof a.timeLimitMinutes?a.timeLimitMinutes:a.timeLimitMinutes??""),R(!!a.dateWindowEnabled),T(a.openFrom?String(new Date(a.openFrom).toISOString().slice(0,16)):""),V(a.openTo?String(new Date(a.openTo).toISOString().slice(0,16)):"");let b=Array.isArray(a.questions)?a.questions.map(a=>{let b=(a=>{switch(a){case"single_choice":return"single";case"multi_choice":return"multi";case"sequence":return"sequence";case"matching":return"matching";case"open":return"open";default:return a}})(a.type),c={};return"single"===b||"multi"===b||"sequence"===b?c.options=a.options||[]:"matching"===b?c.pairs=a.pairs||[]:"open"===b&&(c.answers=a.answers||[]),{id:a.id||Date.now(),type:b,text:a.text||"",data:c,points:"number"==typeof a.points?a.points:1,imageUrl:a.imageUrl||a.image&&(a.image.secure_url||a.image.url)||void 0}}):[];_(b);try{let a=b.map(a=>a.imageUrl).filter(Boolean);ab(a)}catch{}}}catch(a){console.warn("Failed to load test for edit:",a)}}())}catch{}},[]);let am=(0,d.usePathname)();async function an(b){if(b.preventDefault(),Z(null),function(){if(!C||!String(C).trim()){let a="Вкажіть назву тесту";Z(a),ad({qid:-1,field:"title",message:a});let b=document.querySelector('[data-field="title"]');if(b){b.scrollIntoView({behavior:"smooth",block:"center"});try{b.focus()}catch{}}return!1}if(!$||0===$.length)return Z("Додайте принаймні одне питання"),!1;if(M){let a="number"==typeof O?O:O?Number(O):NaN;if(!Number.isFinite(a)||a<=0)return Z("Вкажіть коректну тривалість тесту у хвилинах"),!1}if(Q){if(!S||!U)return Z("Вкажіть дати початку та кінця відкритості тесту"),!1;let a=new Date(S),b=new Date(U);if(isNaN(a.getTime())||isNaN(b.getTime())||a.getTime()>b.getTime())return Z("Некоректні дати: початок має бути раніше або рівним кінцю"),!1}let a=null,b=null;for(let c=0;c<$.length;c++){let d=$[c],e=c+1;if(!d.text||!String(d.text).trim()){let c=`Питання ${e}: введіть текст питання`;Z(c),b={qid:d.id,field:"text",message:c},a=`[data-qid="${d.id}"][data-field="text"]`;break}if("single"===d.type||"multi"===d.type){let c=d.data&&d.data.options||[];if(!c||0===c.length){let c=`Питання ${e}: додайте варіанти відповіді`;Z(c),b={qid:d.id,field:"option",message:c},a=`[data-qid="${d.id}"][data-field="option"]`;break}for(let f=0;f<c.length;f++){let g=c[f];if(!g.text||!String(g.text).trim()){let c=`Питання ${e}, варіант ${f+1}: введіть текст варіанту`;Z(c),b={qid:d.id,field:"option",idx:f,message:c},a=`[data-qid="${d.id}"][data-field="option"][data-idx="${f}"]`;break}}if(a)break;if(!c.some(a=>!!a.correct)){let c=`Питання ${e}: позначте принаймні один правильний варіант`;Z(c),b={qid:d.id,field:"option",message:c},a=`[data-qid="${d.id}"][data-field="option"]`;break}}else if("sequence"===d.type){let c=d.data&&d.data.options||[];if(!c||0===c.length){let c=`Питання ${e}: додайте елементи послідовності`;Z(c),b={qid:d.id,field:"sequence",message:c},a=`[data-qid="${d.id}"][data-field="sequence"]`;break}for(let f=0;f<c.length;f++)if(!c[f].text||!String(c[f].text).trim()){let c=`Питання ${e}, елемент ${f+1}: введіть текст`;Z(c),b={qid:d.id,field:"sequence",idx:f,message:c},a=`[data-qid="${d.id}"][data-field="sequence"][data-idx="${f}"]`;break}if(a)break}else if("matching"===d.type){let c=d.data&&d.data.pairs||[];if(!c||0===c.length){let c=`Питання ${e}: додайте пари відповідностей`;Z(c),b={qid:d.id,field:"pair",message:c},a=`[data-qid="${d.id}"][data-field="pair"]`;break}for(let f=0;f<c.length;f++){let g=c[f];if(!g.left||!String(g.left).trim()||!g.right||!String(g.right).trim()){let c=`Питання ${e}, пара ${f+1}: заповніть обидва поля пари`;Z(c),b={qid:d.id,field:"pair",idx:f,message:c},a=`[data-qid="${d.id}"][data-field="pair"][data-idx="${f}"]`;break}}if(a)break}else if("open"===d.type){let c=d.data&&d.data.answers||[];if(!c||0===c.length){let c=`Питання ${e}: додайте принаймні одну очікувану відповідь або заповніть питання`;Z(c),b={qid:d.id,field:"answer",message:c},a=`[data-qid="${d.id}"][data-field="answer"]`;break}for(let f=0;f<c.length;f++)if(!c[f]||!String(c[f]).trim()){let c=`Питання ${e}, очікувана відповідь ${f+1}: введіть текст`;Z(c),b={qid:d.id,field:"answer",idx:f,message:c},a=`[data-qid="${d.id}"][data-field="answer"][data-idx="${f}"]`;break}if(a)break}}if(b){ad(b);let c=document.querySelector(a);if(c){c.scrollIntoView({behavior:"smooth",block:"center"});try{c.focus()}catch{}}return!1}return ad(null),Z(null),!0}()){X(!0);try{let b;if(ag&&ai){Z("Ви не маєте прав редагувати цей тест."),X(!1);return}if(ag&&Array.isArray(aa)&&aa.length>0){let a=$.map(a=>a.imageUrl).filter(Boolean),b=aa.filter(b=>!a.includes(b));if(b.length>0){let a=[];for(let c of b)try{let b=await fetch("/api/cloudinary/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:c})});if(!b.ok){let d=await b.text().catch(()=>void 0);a.push(`${c} -> ${d||b.status}`)}}catch(b){a.push(`${c} -> ${String(b)}`)}if(a.length>0){X(!1),alert("Не вдалося видалити старі зображення:\n"+a.join("\n"));return}}}let c=$.map(a=>{let b={id:a.id,type:a.type,text:a.text||"",points:"number"==typeof a.points?a.points:1};return"single"===a.type||"multi"===a.type||"sequence"===a.type?(b.data=b.data||{},b.data.options=Array.isArray(a.data?.options)?a.data.options.map(a=>({id:a.id,text:a.text,correct:!!a.correct,order:a.order})):[]):"matching"===a.type?(b.data=b.data||{},b.data.pairs=Array.isArray(a.data?.pairs)?a.data.pairs.map(a=>({id:a.id,left:a.left,right:a.right})):[]):"open"===a.type&&(b.data=b.data||{},b.data.answers=Array.isArray(a.data?.answers)?a.data.answers.map(a=>String(a||"")):[]),a.imageUrl&&(b.imageUrl=a.imageUrl),b}),d={title:C,description:E,visibility:G,storeResponses:I,timed:M,timeLimitMinutes:"number"==typeof O?O:O?Number(O):void 0,dateWindowEnabled:Q,openFrom:S||void 0,openTo:U||void 0,ownResultView:K,questions:c};if(!(b=ag?await fetch(`/api/tests/${ag}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)}):await fetch("/api/tests",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)})).ok){let a=await b.text();throw Error(a||`HTTP ${b.status}`)}a.push("/editor")}catch(a){Z(a?.message||(ag?"Помилка при оновленні тесту":"Помилка при створенні тесту")),X(!1)}}}return(0,c.useEffect)(()=>{try{"/editor/new"===am&&(k.get("edit")||al())}catch{}},[am]),(0,c.useEffect)(()=>{try{return}catch{}},[C,E,G,I,K,$]),ai?(0,b.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,b.jsx)("h2",{className:"mb-4 text-center",children:"Редагування заборонено"}),(0,b.jsxs)("div",{className:"menu-box p-4",children:[(0,b.jsx)("div",{className:"alert alert-danger",children:"Ви не маєте прав редагувати цей тест."}),(0,b.jsx)("div",{className:"d-flex gap-2",children:(0,b.jsx)(e.default,{href:"/editor",className:"btn btn-outline-secondary",children:"Назад"})})]})]}):(0,b.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,b.jsx)("h2",{className:"mb-4 text-center",children:ag?"Редагування тесту":"Новий тест"}),(0,b.jsxs)("form",{className:"menu-box p-4",onSubmit:an,children:[(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{className:"form-label",children:"Назва"}),(0,b.jsx)("input",{className:`form-control ${ac&&"title"===ac.field?"is-invalid":""}`,value:C,"data-field":"title",onChange:a=>D(a.target.value)}),ac&&"title"===ac.field&&(0,b.jsx)("div",{className:"invalid-feedback d-block app-error",children:ac.message})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{className:"form-label",children:"Опис"}),(0,b.jsx)("textarea",{className:"form-control",rows:5,value:E,onChange:a=>F(a.target.value)})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{className:"form-label d-block",children:"Видимість"}),(0,b.jsxs)("div",{className:"btn-group",role:"group",children:[(0,b.jsx)("input",{type:"radio",className:"btn-check",name:"visibility",id:"public",autoComplete:"off",checked:"public"===G,onChange:()=>H("public")}),(0,b.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"public",children:"Публічний"}),(0,b.jsx)("input",{type:"radio",className:"btn-check",name:"visibility",id:"private",autoComplete:"off",checked:"private"===G,onChange:()=>H("private")}),(0,b.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"private",children:"Приватний"})]})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{className:"form-label d-block",children:"Зберігати відповіді та результати користувачів"}),(0,b.jsxs)("div",{className:"btn-group",role:"group",children:[(0,b.jsx)("input",{type:"radio",className:"btn-check",name:"storeResponses",id:"storeYes",autoComplete:"off",checked:!0===I,onChange:()=>J(!0)}),(0,b.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"storeYes",children:"Так"}),(0,b.jsx)("input",{type:"radio",className:"btn-check",name:"storeResponses",id:"storeNo",autoComplete:"off",checked:!1===I,onChange:()=>{J(!1),"nothing"===K&&L("full")}}),(0,b.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"storeNo",children:"Ні"})]}),(0,b.jsx)("div",{className:"form-text mt-1",children:"Якщо так — зберігатимуться індивідуальні відповіді та результати (ви зможете бачити список користувачів, які пройшли тест)."})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{className:"form-label d-block",children:"Що бачить користувач після проходження"}),(0,b.jsxs)("div",{className:"btn-group",role:"group",children:[(0,b.jsx)("input",{type:"radio",className:"btn-check",name:"ownResultView",id:"ownFull",autoComplete:"off",checked:"full"===K,onChange:()=>L("full")}),(0,b.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"ownFull",children:"Повні результати (питання + відповіді + бали)"}),(0,b.jsx)("input",{type:"radio",className:"btn-check",name:"ownResultView",id:"ownScore",autoComplete:"off",checked:"score_only"===K,onChange:()=>L("score_only")}),(0,b.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"ownScore",children:"Тільки бали"}),(0,b.jsx)("input",{type:"radio",className:"btn-check",name:"ownResultView",id:"ownNothing",autoComplete:"off",checked:"nothing"===K,disabled:!1===I,onChange:()=>{I&&L("nothing")}}),I?(0,b.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"ownNothing",children:"Нічого не показувати"}):null]}),(0,b.jsx)("div",{className:"form-text mt-1",children:"Ця опція визначає, що бачить сам користувач після завершення тесту."})]}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsx)("label",{className:"form-label d-block",children:"Налаштування часу"}),(0,b.jsxs)("div",{className:"form-check form-switch mb-2",children:[(0,b.jsx)("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"timedSwitch",checked:M,onChange:a=>N(a.target.checked)}),(0,b.jsx)("label",{className:"form-check-label",htmlFor:"timedSwitch",children:"Обмежений час проходження"})]}),M&&(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2 mb-2",children:[(0,b.jsx)("div",{style:{width:220},children:(0,b.jsx)("input",{type:"number",min:1,className:"form-control",value:O,onChange:a=>P(""===a.target.value?"":Number(a.target.value)),placeholder:"Тривалість (хвилин)"})}),(0,b.jsx)("div",{className:"form-text",children:"Вкажіть тривалість тесту в хвилинах."})]}),(0,b.jsx)("hr",{}),(0,b.jsxs)("div",{className:"form-check form-switch mb-2",children:[(0,b.jsx)("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"dateWindowSwitch",checked:Q,onChange:a=>R(a.target.checked)}),(0,b.jsx)("label",{className:"form-check-label",htmlFor:"dateWindowSwitch",children:"Обмежити доступ датами"})]}),Q&&(0,b.jsxs)("div",{className:"d-flex flex-column gap-2",children:[(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,b.jsx)("label",{className:"form-label mb-0",style:{width:120},children:"Від"}),(0,b.jsx)("input",{type:"datetime-local",className:"form-control",value:S,onChange:a=>T(a.target.value)})]}),(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,b.jsx)("label",{className:"form-label mb-0",style:{width:120},children:"До"}),(0,b.jsx)("input",{type:"datetime-local",className:"form-control",value:U,onChange:a=>V(a.target.value)})]}),(0,b.jsx)("div",{className:"form-text",children:"Коли увімкнено — тест буде доступний лише в проміжку часу."})]})]}),(0,b.jsxs)("div",{className:"mb-3 questions-section",children:[(0,b.jsx)("h3",{className:"mb-2 text-center",children:"Питання"}),0===$.length&&(0,b.jsx)("div",{className:"muted mb-2",children:"Поки немає питань. Додайте перше питання."}),$.map(a=>(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[(0,b.jsx)("label",{className:"form-label mb-0",children:"Питання"}),(0,b.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,b.jsxs)("select",{className:"form-select form-select-sm",style:{width:200},value:a.type,onChange:b=>{var c,d;return c=a.id,d=b.target.value,void _(a=>a.map((a,b)=>{if(a.id!==c)return a;let e={...a,type:d};e.data=e.data||{};let f=Date.now()+b;return"single"!==d&&"multi"!==d||Array.isArray(e.data.options)||(e.data.options=[{id:f+1,text:"",correct:!1},{id:f+2,text:"",correct:!1}]),"sequence"!==d||Array.isArray(e.data.options)||(e.data.options=[{id:f+1,text:"",order:1},{id:f+2,text:"",order:2}]),"matching"!==d||Array.isArray(e.data.pairs)||(e.data.pairs=[{id:f+1,left:"",right:""},{id:f+2,left:"",right:""}]),"open"!==d||Array.isArray(e.data.answers)||(e.data.answers=[""]),ak(e,b)}))},children:[(0,b.jsx)("option",{value:"single",children:"Одиночний вибір"}),(0,b.jsx)("option",{value:"multi",children:"Множинний вибір"}),(0,b.jsx)("option",{value:"sequence",children:"Порядок"}),(0,b.jsx)("option",{value:"open",children:"Відкрита відповідь"}),(0,b.jsx)("option",{value:"matching",children:"Відповідності"})]}),(0,b.jsx)("input",{type:"number",min:0,step:.5,className:"form-control form-control-sm",style:{width:90},value:"number"==typeof a.points?a.points:1,onChange:b=>{var c,d;return c=a.id,d=Number(b.target.value||0),void _(a=>a.map(a=>a.id===c?{...a,points:d}:a))},title:"Бали за питання"}),(0,b.jsx)("span",{className:"badge bg-secondary text-capitalize",children:a.type})]})]}),"open"!==a.type&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("textarea",{className:`form-control ${ac&&ac.qid===a.id&&"text"===ac.field?"is-invalid":""}`,rows:3,value:a.text,"data-qid":a.id,"data-field":"text",onChange:b=>z(a.id,b.target.value)}),ac&&ac.qid===a.id&&"text"===ac.field&&(0,b.jsx)("div",{className:"invalid-feedback d-block app-error",children:ac.message}),(0,b.jsx)("div",{className:"mt-2 d-flex align-items-center gap-2",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"form-label mb-1",children:"Зображення (опціонально)"}),(0,b.jsxs)("div",{className:"d-flex gap-2 align-items-center",children:[(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:async b=>{let c=b.target.files?.[0];if(c)try{if(a.imageUrl)try{await fetch("/api/cloudinary/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:a.imageUrl})})}catch(a){console.warn("Failed to delete previous image:",a)}let b=await A(c);b&&B(a.id,b)}catch(a){console.error(a),alert("Не вдалося завантажити зображення")}}}),a.imageUrl?(0,b.jsxs)("div",{style:{maxWidth:140},children:[(0,b.jsx)("img",{src:a.imageUrl,alt:"preview",style:{width:"100%",borderRadius:8}}),(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:async()=>{try{if(a.imageUrl){let b=await fetch("/api/cloudinary/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:a.imageUrl})});if(!b.ok){let a=await b.text().catch(()=>void 0);alert("Не вдалося видалити зображення на сервері: "+(a||b.status));return}}}catch(a){console.warn("Failed to delete image on server:",a),alert("Не вдалося видалити зображення на сервері");return}B(a.id,null)},children:"Видалити"})})]}):null]})]})})]}),"open"===a.type&&(0,b.jsx)(f,{qid:a.id,invalidField:ac,text:a.text,answers:a.data&&a.data.answers||[],onChange:b=>{var c,d;z(a.id,b.text),c=a.id,d=b.answers,_(a=>a.map(a=>a.id===c?{...a,data:{...a.data||{},answers:d}}:a))}}),"single"===a.type&&(0,b.jsx)(g,{q:a,qid:a.id,invalidField:ac,ensureOptions:l,addOptionToQuestion:m,updateOptionText:n,removeOption:o,toggleOptionCorrect:p}),"multi"===a.type&&(0,b.jsx)(h,{q:a,qid:a.id,invalidField:ac,ensureOptions:l,addOptionToQuestion:m,updateOptionText:n,removeOption:o,toggleOptionCorrect:p}),"sequence"===a.type&&(0,b.jsx)(i,{q:a,qid:a.id,invalidField:ac,addSequenceItem:q,updateSequenceItemText:r,updateSequenceItemOrder:s,removeSequenceItem:t}),"matching"===a.type&&(0,b.jsx)(j,{q:a,qid:a.id,invalidField:ac,addPairToQuestion:u,updatePairText:v,removePairFromQuestion:w}),(0,b.jsx)("div",{className:"mt-2 d-flex gap-2",children:(0,b.jsx)("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{var b;return b=a.id,void _(a=>a.filter(a=>a.id!==b))},children:"Видалити питання"})})]},a.id)),(0,b.jsxs)("div",{className:"mb-2 d-flex justify-content-center align-items-center gap-2 mt-3",children:[(0,b.jsxs)("select",{className:"form-select w-auto",value:x,onChange:a=>y(a.target.value),children:[(0,b.jsx)("option",{value:"single",children:"Одиночний вибір"}),(0,b.jsx)("option",{value:"multi",children:"Множинний вибір"}),(0,b.jsx)("option",{value:"sequence",children:"Порядок (послідовність)"}),(0,b.jsx)("option",{value:"open",children:"Відкрита відповідь"}),(0,b.jsx)("option",{value:"matching",children:"Відповідності"})]}),(0,b.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>{let a,b,c;return a=Date.now(),b={},"single"===x||"multi"===x?b.options=[{id:a+1,text:"",correct:!1},{id:a+2,text:"",correct:!1}]:"sequence"===x?b.options=[{id:a+1,text:"",order:1},{id:a+2,text:"",order:2}]:"matching"===x?b.pairs=[{id:a+1,left:"",right:""},{id:a+2,left:"",right:""}]:"open"===x&&(b.answers=[""]),c={id:a,type:x,text:"",data:b},void _(a=>[...a,ak(c,a.length)])},children:"Додати питання"})]})]}),Y&&(0,b.jsx)("div",{className:"app-error mb-3",children:Y}),(0,b.jsxs)("div",{className:"d-flex gap-2 actions-center",children:[(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:function(){try{return}catch{}D(""),F(""),H("public"),J(!0),N(!1),P(""),R(!1),T(""),V(""),L("full"),_([]),af(null),ad(null),Z(null)},children:"Очистити всі поля"}),(0,b.jsx)("button",{className:"btn btn-primary",type:"submit",disabled:W,children:W?ag?"Оновлюю...":"Зберігаю...":ag?"Оновити тест":"Створити тест"}),(0,b.jsx)(e.default,{href:"/editor",className:"btn btn-outline-secondary",children:"Назад"})]})]})]})}a.s(["default",()=>k],59260)}];

//# sourceMappingURL=app_editor_new_page_tsx_1b2a60de._.js.map