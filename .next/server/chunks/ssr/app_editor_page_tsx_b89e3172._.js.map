{"version":3,"sources":["../../../../app/editor/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function Editor() {\r\n  // Note: draft auto-save/restore remains in the editor/new page via localStorage.\r\n  const [tests, setTests] = useState<Array<{ _id: string; title: string; description?: string | null; storeResponses?: boolean }>>([]);\r\n  const [query, setQuery] = useState<string>(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [deletingId, setDeletingId] = useState<string | null>(null);\r\n  const [copiedId, setCopiedId] = useState<string | null>(null);\r\n  const [page, setPage] = useState<number>(1);\r\n  const [totalPages, setTotalPages] = useState<number>(1);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      try {\r\n        const res = await fetch(`/api/tests?page=${page}&limit=10`, { credentials: \"include\" });\r\n        if (!res.ok) return;\r\n        const data = await res.json();\r\n        if (mounted && data?.ok && Array.isArray(data.tests)) {\r\n          setTests(data.tests.map((t: any) => ({ _id: t._id || t.id || t._id, title: t.title, description: t.description, storeResponses: !!t.storeResponses })));\r\n          setTotalPages(data.totalPages || 1);\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"Failed to load tests:\", err);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      document.title = \"TestHub | Редактор тестів\";\r\n    } catch {}\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center justify-content-center min-vh-100\">\r\n      <h2 className=\"mb-4 text-center\">Редактор тестів</h2>\r\n      <div className=\"menu-box d-flex flex-column gap-2\">\r\n        <Link href=\"/editor/new\" className=\"btn btn-primary w-100\">Додати новий тест</Link>\r\n        <div className=\"mt-2\">\r\n          <input className=\"form-control\" placeholder=\"Пошук за назвою тесту...\" value={query} onChange={(e) => { setQuery(e.target.value); setPage(1); }} />\r\n        </div>\r\n        <div className=\"mt-3\">\r\n          <h3 className=\"h6\">Мої тести</h3>\r\n          {loading ? (\r\n            <div className=\"text-muted\">Завантаження...</div>\r\n          ) : tests.length === 0 ? (\r\n            <div className=\"text-muted\">У вас ще немає створених тестів.</div>\r\n          ) : (\r\n            <div className=\"list-group transparent-list\">\r\n              {tests.filter((t) => t.title.toLowerCase().includes(query.toLowerCase())).map((t) => (\r\n                <div key={t._id} className=\"list-group-item d-flex justify-content-between align-items-start\">\r\n                  <div>\r\n                    <div className=\"fw-semibold\">{t.title}</div>\r\n                    {t.description ? <div className=\"text-muted small\">{t.description}</div> : null}\r\n                  </div>\r\n                  <div>\r\n                    <Link href={`/editor/new?edit=${t._id}`} className=\"btn btn-sm btn-outline-primary\">Редагувати</Link>\r\n                    {t.storeResponses ? (\r\n                      <Link href={`/editor/attempts/${t._id}`} className=\"btn btn-sm btn-outline-secondary ms-2\">Проходження</Link>\r\n                    ) : null}\r\n                    <button\r\n                      className=\"btn btn-sm btn-outline-danger ms-2\"\r\n                      onClick={async () => {\r\n                        try {\r\n                          const ok = confirm(\"Видалити тест? Цю дію не можна відмінити.\");\r\n                          if (!ok) return;\r\n                          setDeletingId(t._id);\r\n                          const res = await fetch(`/api/tests/${t._id}`, { method: \"DELETE\", credentials: \"include\" });\r\n                          if (!res.ok) {\r\n                            const txt = await res.text();\r\n                            throw new Error(txt || `HTTP ${res.status}`);\r\n                          }\r\n                          setTests((s) => s.filter((x) => x._id !== t._id));\r\n                        } catch (err) {\r\n                          console.warn(\"Failed to delete test:\", err);\r\n                          alert(\"Не вдалося видалити тест\");\r\n                        } finally {\r\n                          setDeletingId(null);\r\n                        }\r\n                      }}\r\n                      disabled={deletingId === t._id}\r\n                    >\r\n                      {deletingId === t._id ? \"Видаляю...\" : \"Видалити\"}\r\n                    </button>\r\n                    <button\r\n                      className=\"btn btn-sm btn-outline-success ms-2\"\r\n                        onClick={async () => {\r\n                          try {\r\n                            // copy only the test id (code)\r\n                            const code = t._id;\r\n                            if (navigator.clipboard && navigator.clipboard.writeText) {\r\n                              await navigator.clipboard.writeText(code);\r\n                            } else {\r\n                              // fallback for older browsers\r\n                              const tmp = document.createElement(\"input\");\r\n                              document.body.appendChild(tmp);\r\n                              tmp.value = code;\r\n                              tmp.select();\r\n                              document.execCommand(\"copy\");\r\n                              document.body.removeChild(tmp);\r\n                            }\r\n                            setCopiedId(t._id);\r\n                            setTimeout(() => setCopiedId(null), 2500);\r\n                          } catch (err) {\r\n                            console.warn(\"Failed to copy id:\", err);\r\n                            alert(\"Не вдалося скопіювати код тесту\");\r\n                          }\r\n                        }}\r\n                    >\r\n                      {copiedId === t._id ? \"Скопійовано!\" : \"Поділитись\"}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          <div className=\"d-flex justify-content-between align-items-center mt-3\">\r\n            <button className=\"btn btn-outline-secondary\" disabled={page <= 1} onClick={() => setPage((p) => Math.max(1, p - 1))}>Назад</button>\r\n            <div>Сторінка {page} / {totalPages}</div>\r\n            <button className=\"btn btn-outline-secondary\" disabled={page >= totalPages} onClick={() => setPage((p) => Math.min(totalPages, p + 1))}>Далі</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}