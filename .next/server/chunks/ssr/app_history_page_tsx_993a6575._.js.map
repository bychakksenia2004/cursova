{"version":3,"sources":["../../../../app/history/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function HistoryPage() {\r\n  const [loading, setLoading] = useState(true);\r\n  const [attempts, setAttempts] = useState<any[]>([]);\r\n  const [query, setQuery] = useState(\"\");\r\n  const [fromDate, setFromDate] = useState(\"\");\r\n  const [toDate, setToDate] = useState(\"\");\r\n  const [author, setAuthor] = useState(\"\");\r\n  const [page, setPage] = useState<number>(1);\r\n  const [totalPages, setTotalPages] = useState<number>(1);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      setLoading(true);\r\n      try {\r\n        let url = `/api/attempts/me`;\r\n        const params: string[] = [];\r\n        if (query) params.push(`test=${encodeURIComponent(query)}`);\r\n        if (author) params.push(`author=${encodeURIComponent(author)}`);\r\n        if (fromDate) params.push(`from=${encodeURIComponent(fromDate)}`);\r\n        if (toDate) params.push(`to=${encodeURIComponent(toDate)}`);\r\n        params.push(`page=${page}`);\r\n        params.push(`limit=10`);\r\n        if (params.length) url += `?${params.join(\"&\")}`;\r\n        const res = await fetch(url, { credentials: \"include\" });\r\n        if (!res.ok) {\r\n          const txt = await res.text().catch(() => undefined);\r\n          setError(txt || `HTTP ${res.status}`);\r\n          return;\r\n        }\r\n        const data = await res.json();\r\n        if (mounted && data?.ok) {\r\n          setAttempts(data.attempts || []);\r\n          setTotalPages(data.totalPages || 1);\r\n        }\r\n      } catch (err) {\r\n        console.warn(err);\r\n        setError(\"Не вдалося завантажити історію проходжень\");\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, [query, fromDate, toDate, page]);\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n      <h2 className=\"mb-3\">Історія тестувань</h2>\r\n      <div className=\"menu-box w-100\">\r\n        <div className=\"d-flex gap-2 mb-3\">\r\n          <input className=\"form-control\" placeholder=\"Пошук за назвою тесту\" value={query} onChange={(e) => { setQuery(e.target.value); setPage(1); }} />\r\n          <input className=\"form-control\" placeholder=\"Пошук за автором\" value={author} onChange={(e) => { setAuthor(e.target.value); setPage(1); }} />\r\n          <input className=\"form-control\" type=\"date\" value={fromDate} onChange={(e) => { setFromDate(e.target.value); setPage(1); }} placeholder=\"Від\" />\r\n          <input className=\"form-control\" type=\"date\" value={toDate} onChange={(e) => { setToDate(e.target.value); setPage(1); }} placeholder=\"До\" />\r\n          <Link href=\"/\" className=\"btn btn-outline-secondary\">Назад</Link>\r\n        </div>\r\n        {loading ? (\r\n          <div className=\"text-muted\">Завантаження...</div>\r\n        ) : error ? (\r\n          <div className=\"text-danger\">{error}</div>\r\n        ) : attempts.length === 0 ? (\r\n          <div className=\"text-muted\">Ви ще нічого не проходили.</div>\r\n        ) : (\r\n          <div className=\"list-group\">\r\n            {attempts.map((a) => (\r\n              // Only make the item a link if per-question details are available\r\n              a.details && a.details.perQuestion ? (\r\n                <Link key={a.id} href={`/history/${a.id}`} className=\"list-group-item list-group-item-action text-decoration-none\">\r\n                  <div className=\"d-flex justify-content-between align-items-start\">\r\n                    <div>\r\n                      <div className=\"fw-semibold\">{a.title}</div>\r\n                      <div className=\"text-muted small\">{new Date(a.createdAt).toLocaleString()}</div>\r\n                    </div>\r\n                    <div className=\"text-end\">\r\n                      <div className=\"fw-semibold\">{typeof a.details.totalScore !== 'undefined' ? `${a.details.totalScore} / ${a.details.totalPossible}` : \"\"}</div>\r\n                    </div>\r\n                  </div>\r\n                </Link>\r\n              ) : (\r\n                <div key={a.id} className=\"list-group-item\">\r\n                  <div className=\"d-flex justify-content-between align-items-start\">\r\n                    <div>\r\n                      <div className=\"fw-semibold\">{a.title}</div>\r\n                      <div className=\"text-muted small\">{new Date(a.createdAt).toLocaleString()}</div>\r\n                    </div>\r\n                    <div className=\"text-end\">\r\n                      {a.details && typeof a.details.totalScore !== 'undefined' ? (\r\n                        <div className=\"fw-semibold\">{a.details.totalScore} / {a.details.totalPossible}</div>\r\n                      ) : (\r\n                        <div className=\"text-muted\">Деталі заборонено</div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )\r\n            ))}\r\n          </div>\r\n        )}\r\n        <div className=\"d-flex justify-content-between align-items-center mt-3\">\r\n          <button className=\"btn btn-outline-secondary\" disabled={page <= 1} onClick={() => setPage((p) => Math.max(1, p - 1))}>Назад</button>\r\n          <div>Сторінка {page} / {totalPages}</div>\r\n          <button className=\"btn btn-outline-secondary\" disabled={page >= totalPages} onClick={() => setPage((p) => Math.min(totalPages, p + 1))}>Далі</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}