{"version":3,"sources":["../../../../app/login/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function Login() {\r\n  const router = useRouter();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      document.title = \"TestHub | Вхід\";\r\n    } catch {}\r\n  }, []);\r\n\r\n  async function onSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setError(null);\r\n\r\n    if (!email || !password) {\r\n      setError(\"Заповніть усі поля\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/api/login\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        credentials: \"include\", // <- ensure browser accepts Set-Cookie from the response\r\n        body: JSON.stringify({ email, password }),\r\n      });\r\n\r\n      let data: any = null;\r\n      try {\r\n        data = await res.json();\r\n      } catch (_) {\r\n        try {\r\n          const txt = await res.text();\r\n          data = { error: txt || `HTTP ${res.status}` };\r\n        } catch {\r\n          data = { error: `HTTP ${res.status}` };\r\n        }\r\n      }\r\n\r\n      if (data?.warning) {\r\n        // show dev warning from server if any\r\n        console.warn(\"Auth warning:\", data.warning);\r\n      }\r\n\r\n      if (!res.ok) {\r\n        setError(data?.error || data?.message || \"Помилка входу\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // сигнал для клієнтських компонентів, що auth змінився\r\n      try {\r\n        localStorage.setItem(\"auth-refresh\", String(Date.now()));\r\n        // notify same-tab listeners\r\n        try { window.dispatchEvent(new Event(\"auth-refresh\")); } catch {}\r\n      } catch {}\r\n\r\n      try {\r\n        await router.refresh();\r\n      } catch {}\r\n      router.push(\"/\");\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      setError(err?.message || \"Помилка мережі\");\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center justify-content-center min-vh-100\">\r\n      <div className=\"login-container menu-box\">\r\n        <h2 className=\"mb-4 text-center\">Вхід</h2>\r\n\r\n        <form onSubmit={onSubmit}>\r\n          <div className=\"mb-3\">\r\n            <label htmlFor=\"email\" className=\"form-label\">\r\n              Email\r\n            </label>\r\n            <input\r\n              id=\"email\"\r\n              type=\"email\"\r\n              className=\"form-control\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              autoComplete=\"email\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"mb-3\">\r\n            <label htmlFor=\"password\" className=\"form-label\">\r\n              Пароль\r\n            </label>\r\n            <input\r\n              id=\"password\"\r\n              type=\"password\"\r\n              className=\"form-control\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              autoComplete=\"current-password\"\r\n            />\r\n          </div>\r\n\r\n          {error && <div className=\"text-danger mb-3\">{error}</div>}\r\n\r\n          <button\r\n            type=\"submit\"\r\n            className=\"btn btn-primary w-100\"\r\n            disabled={loading}\r\n          >\r\n            {loading ? \"Зачекайте...\" : \"Увійти\"}\r\n          </button>\r\n\r\n          <p className=\"text-center mt-3 mb-0\">\r\n            Немає акаунту?{\" \"}\r\n            <Link\r\n              href=\"/register\"\r\n              className=\"text-decoration-underline\"\r\n            >\r\n              Зареєструйтесь!\r\n            </Link>\r\n          </p>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}