{"version":3,"sources":["../../../../app/page.tsx"],"sourcesContent":["\"use client\";\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\nexport default function Home() {\n  const [user, setUser] = useState<{ username: string } | null>(null);\n  const [loading, setLoading] = useState(true);\n  const router = useRouter();\n  const [hasDraft, setHasDraft] = useState(false);\n\n  async function loadUser() {\n    try {\n      const res = await fetch(\"/api/me\", { credentials: \"include\" });\n      if (!res.ok) {\n        setUser(null);\n      } else {\n        const data = await res.json();\n        setUser(data?.user ?? null);\n      }\n    } catch (err) {\n      console.error(\"Home /api/me error:\", err);\n      setUser(null);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    loadUser();\n\n    // Also listen for explicit refresh trigger (we can set localStorage key after login)\n    const onStorage = (e: StorageEvent) => {\n      if (e.key === \"auth-refresh\") {\n        loadUser();\n      }\n    };\n    window.addEventListener?.(\"storage\", onStorage);\n    const onAuth = () => loadUser();\n    window.addEventListener?.(\"auth-refresh\", onAuth);\n    return () => {\n      window.removeEventListener?.(\"storage\", onStorage);\n      window.removeEventListener?.(\"auth-refresh\", onAuth);\n    };\n  }, []);\n\n  // check for saved draft\n  useEffect(() => {\n    try {\n      const raw = typeof window !== \"undefined\" ? window.localStorage.getItem(\"test_draft_v1\") : null;\n      setHasDraft(!!raw);\n    } catch {\n      setHasDraft(false);\n    }\n    const onStorage = (e: StorageEvent) => {\n      if (e.key === \"test_draft_v1\") {\n        try { setHasDraft(!!e.newValue); } catch { setHasDraft(false); }\n      }\n    };\n    window.addEventListener?.(\"storage\", onStorage);\n    return () => { window.removeEventListener?.(\"storage\", onStorage); };\n  }, []);\n\n  useEffect(() => {\n    try {\n      document.title = \"TestHub | Головна сторінка\";\n    } catch {}\n  }, []);\n\n  const isAuth = !!user;\n  const username = user?.username ?? null;\n\n  async function handleLogout() {\n    try {\n      const res = await fetch(\"/api/logout\", { method: \"POST\", credentials: \"include\" });\n      // update clients locally\n      setUser(null);\n      try { localStorage.setItem(\"auth-refresh\", String(Date.now())); } catch {}\n      try { window.dispatchEvent(new Event(\"auth-refresh\")); } catch {}\n      try { router.refresh(); } catch {}\n      if (!res.ok) {\n        console.warn(\"Logout failed\", await res.text());\n      }\n    } catch (err) {\n      console.error(\"Logout error:\", err);\n    }\n  }\n\n  return (\n    <div className=\"container d-flex flex-column align-items-center justify-content-center min-vh-100 home-menu\">\n      <div className=\"mb-4 text-center\">\n        <h1 className=\"display-5 fw-semibold\">TestHub</h1>\n      </div>\n\n      <div className=\"card p-4 shadow-sm text-center app-card menu-box\">\n        <Link href=\"/tests\" className=\"btn btn-outline-dark w-100 mb-2\">Список публічних тестів</Link>\n        <Link href=\"/run\" className=\"btn btn-outline-dark w-100 mb-2\">Пройти тест за кодом</Link>\n\n        {isAuth && (\n          <>\n            <Link href=\"/history\" className=\"btn btn-outline-dark w-100 mb-2\">Історія тестувань</Link>\n            <Link href=\"/editor\" className=\"btn btn-outline-dark w-100 mb-2\">Мої тести</Link>\n          </>\n        )}\n\n        {!isAuth && (\n          <p className=\"text-muted mt-3 mb-0\">Увійди, щоб отримати більше можливостей</p>\n        )}\n      </div>\n\n      <div className=\"d-flex gap-2 mt-3\">\n        {!isAuth ? (\n          <>\n            <Link href=\"/login\" className=\"btn btn-primary\">Увійти</Link>\n            <Link href=\"/register\" className=\"btn btn-outline-primary\">Зареєструватись</Link>\n          </>\n        ) : (\n          <>\n            {/* logout button under the panel */}\n            <button onClick={handleLogout} className=\"btn btn-danger\">Вийти</button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}