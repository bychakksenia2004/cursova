{"version":3,"sources":["../../../../app/register/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function Register() {\r\n  const router = useRouter();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [username, setUsername] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [confirm, setConfirm] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      document.title = \"TestHub | Реєстрація\";\r\n    } catch {}\r\n  }, []);\r\n\r\n  async function onSubmit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setError(null);\r\n\r\n    if (!email || !username || !password || !confirm) {\r\n      setError(\"Заповніть усі поля\");\r\n      return;\r\n    }\r\n    if (password !== confirm) {\r\n      setError(\"Паролі не співпадають\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(\"/api/register\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        credentials: \"include\", // <- ensure browser accepts Set-Cookie from the response\r\n        body: JSON.stringify({ email, username, password })\r\n      });\r\n\r\n      // намагаємось безпечно розпарсити тіло відповіді\r\n      let data: any = null;\r\n      try {\r\n        data = await res.json();\r\n      } catch (_) {\r\n        // якщо тіло не JSON — ітерпретуємо як текст\r\n        try {\r\n          const txt = await res.text();\r\n          data = { error: txt || `HTTP ${res.status}` };\r\n        } catch {\r\n          data = { error: `HTTP ${res.status}` };\r\n        }\r\n      }\r\n\r\n      if (data?.warning) {\r\n        console.warn(\"Register warning:\", data.warning);\r\n      }\r\n      \r\n      if (!res.ok) {\r\n        setError(data?.error || data?.message || \"Помилка реєстрації\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // повідомити клієнтські компоненти про зміну auth\r\n      try {\r\n        localStorage.setItem(\"auth-refresh\", String(Date.now()));\r\n        // notify same-tab listeners\r\n        try { window.dispatchEvent(new Event(\"auth-refresh\")); } catch {}\r\n      } catch {}\r\n\r\n      try {\r\n        await router.refresh();\r\n      } catch {}\r\n      router.push(\"/\");\r\n    } catch (err: any) {\r\n      console.error(err);\r\n      setError(err?.message || \"Помилка мережі\");\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"container d-flex flex-column align-items-center justify-content-center min-vh-100\">\r\n      <div className=\"register-container menu-box\">\r\n\r\n        <h2 className=\"mb-4 text-center\">Реєстрація</h2>\r\n\r\n        <form onSubmit={onSubmit}>\r\n          <div className=\"mb-3\">\r\n            <label htmlFor=\"email\" className=\"form-label\">Email</label>\r\n            <input\r\n              id=\"email\"\r\n              type=\"email\"\r\n              className=\"form-control\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              autoComplete=\"email\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"mb-3\">\r\n            <label htmlFor=\"username\" className=\"form-label\">Ім'я користувача</label>\r\n            <input\r\n              id=\"username\"\r\n              type=\"text\"\r\n              className=\"form-control\"\r\n              value={username}\r\n              onChange={(e) => setUsername(e.target.value)}\r\n              autoComplete=\"username\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"mb-3\">\r\n            <label htmlFor=\"password\" className=\"form-label\">Пароль</label>\r\n            <input\r\n              id=\"password\"\r\n              type=\"password\"\r\n              className=\"form-control\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              autoComplete=\"new-password\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"mb-3\">\r\n            <label htmlFor=\"confirm\" className=\"form-label\">Підтвердження пароля</label>\r\n            <input\r\n              id=\"confirm\"\r\n              type=\"password\"\r\n              className=\"form-control\"\r\n              value={confirm}\r\n              onChange={(e) => setConfirm(e.target.value)}\r\n              autoComplete=\"new-password\"\r\n            />\r\n          </div>\r\n\r\n          {error && <div className=\"text-danger mb-3\">{error}</div>}\r\n\r\n          <button type=\"submit\" className=\"btn btn-primary w-100\" disabled={loading}>\r\n            {loading ? \"Зачекайте...\" : \"Зареєструватись\"}\r\n          </button>\r\n\r\n          <p className=\"text-center mt-3 mb-0\">\r\n            Вже маєш акаунт? <Link href=\"/login\" className=\"text-decoration-underline\">Увійти</Link>\r\n          </p>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}