module.exports=[16910,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246);function f(){let a=(0,d.useParams)(),f=a?.id,h=(0,d.useRouter)(),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)({}),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(null);return((0,c.useEffect)(()=>{let a=!0;return async function(){if(f)try{let c=await fetch(`/api/public-tests/${f}`);if(!c.ok){console.warn(await c.text()),a&&n(!1);return}let d=await c.json();if(a){function b(a){let b=Array.isArray(a)?[...a]:[];for(let a=b.length-1;a>0;a--){let c=Math.floor(Math.random()*(a+1)),d=b[a];b[a]=b[c],b[c]=d}return b}let a=d.test,c=new Date,e=!!a.dateWindowEnabled,f=a.openFrom?new Date(a.openFrom):null,g=a.openTo?new Date(a.openTo):null,h=Array.isArray(a.questions)?a.questions.map(a=>{let c={...a},d=a.options||a.data?.options||[],e=a.pairs||a.data?.pairs||[];if(("single_choice"===a.type||"single"===a.type||"multi_choice"===a.type||"multi"===a.type||"sequence"===a.type)&&(c._displayOptions=b(d.map(a=>({...a})))),"matching"===a.type){let a=e.map((a,b)=>({pairId:a.id??a._id??`p-${b}`,text:a.left})),d=e.map((a,b)=>({pairId:a.id??a._id??`p-${b}`,text:a.right}));c._displayLeft=b(a),c._displayRight=b(d)}return c}):[];j({...a,questions:h,__inWindow:!e||(!f||c>=f)&&(!g||c<=g)}),a._viewer&&l(a._viewer)}}catch(a){console.warn(a)}finally{a&&n(!1)}}(),()=>{a=!1}},[f]),(0,c.useEffect)(()=>{},[i]),(0,c.useEffect)(()=>{if(o)return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a);function a(a){"Escape"===a.key&&p(null)}},[o]),m)?(0,b.jsx)("div",{className:"container min-vh-100",children:"Завантаження..."}):i?!1===i.__inWindow?(0,b.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,b.jsx)("h2",{className:"mb-3",children:i.title}),(0,b.jsxs)("div",{className:"menu-box w-100",children:[(0,b.jsx)("div",{className:"alert alert-warning",children:"Тест наразі недоступний за часовим вікном."}),(0,b.jsx)("div",{className:"mb-3",children:(0,b.jsx)(e.default,{href:"/tests",className:"btn btn-outline-secondary",children:"Назад до списку"})})]})]}):(i.storeResponses||i.requiresLogin)&&!k?(0,b.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,b.jsx)("h2",{className:"mb-3",children:i.title}),(0,b.jsxs)("div",{className:"menu-box w-100",children:[(0,b.jsxs)("div",{className:"alert alert-warning",children:["Цей тест вимагає реєстрації для проходження. Будь ласка, ",(0,b.jsx)("a",{href:"/login",children:"увійдіть"})," або ",(0,b.jsx)("a",{href:"/register",children:"зареєструйтесь"}),"."]}),(0,b.jsx)("div",{className:"mb-3",children:(0,b.jsx)(e.default,{href:"/tests",className:"btn btn-outline-secondary",children:"Назад до списку"})})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,b.jsx)("h2",{className:"mb-3",children:i.title}),(0,b.jsxs)("div",{className:"w-100 mb-2 d-flex justify-content-between align-items-center",children:[(0,b.jsx)("div",{children:s?(0,b.jsxs)("div",{className:"badge bg-danger",children:["Час: ",function(a){if(null===a)return"";let b=Math.floor(a/60);return`${String(b).padStart(2,"0")}:${String(a%60).padStart(2,"0")}`}(y)]}):null}),i.timed?(0,b.jsxs)("div",{className:"text-muted",children:["Час на тест: ",i.timeLimitMinutes," хв"]}):null]}),(0,b.jsxs)("div",{className:"menu-box w-100 questions-section",children:[Array.isArray(i.questions)&&i.questions.map((a,c)=>(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsxs)("div",{className:"fw-semibold",children:[c+1,". ",a.text]}),(0,b.jsxs)("div",{className:"mt-2",children:[a.imageUrl?(0,b.jsx)("div",{className:"mb-3",children:(0,b.jsx)("img",{src:a.imageUrl,alt:`Question ${c+1} image`,style:{cursor:"pointer",objectFit:"contain",maxWidth:"33%",maxHeight:"33vh",width:"auto",height:"auto",borderRadius:8},onClick:()=>p(a.imageUrl)})}):null,"single_choice"===a.type||"single"===a.type?(0,b.jsx)("div",{children:(a._displayOptions||a.options||a.data?.options||[]).map(c=>(0,b.jsxs)("label",{className:"d-block mb-1",children:[(0,b.jsx)("input",{type:"radio",name:`q-${a.id}`,checked:q[a.id]===c.id,onChange:()=>{var b;return b=c.id,void r(c=>({...c,[a.id]:b}))}})," ",c.text]},c.id))}):"multi_choice"===a.type||"multi"===a.type?(0,b.jsx)("div",{children:(a._displayOptions||a.options||a.data?.options||[]).map(c=>(0,b.jsxs)("label",{className:"d-block mb-1",children:[(0,b.jsx)("input",{type:"checkbox",checked:(q[a.id]||[]).includes(c.id),onChange:()=>{var b;return b=c.id,void r(c=>{let d=c[a.id]||[],e=d.includes(b)?d.filter(a=>a!==b):[...d,b];return{...c,[a.id]:e}})}})," ",c.text]},c.id))}):"sequence"===a.type?(0,b.jsx)("div",{children:(0,b.jsx)("div",{className:"list-group",children:(a._displayOptions||a.options||a.data?.options||[]).map((c,d)=>(0,b.jsxs)("div",{className:"list-group-item bg-transparent border-0 d-flex align-items-center gap-3",children:[(0,b.jsx)("div",{className:"flex-fill",children:c.text}),(0,b.jsx)("div",{className:"w-50",children:(0,b.jsx)("input",{className:"form-control bg-white",type:"number",min:1,max:(a._displayOptions||a.options||a.data?.options||[]).length,value:q[a.id]&&q[a.id][c.id]||"",onChange:b=>{var d,e;return d=c.id,e=""===b.target.value?"":Number(b.target.value),void r(b=>{let c="object"==typeof b[a.id]&&null!==b[a.id]?{...b[a.id]}:{};return""===e||null===e?delete c[d]:c[d]=Number(e),{...b,[a.id]:c}})},placeholder:"№ в послідовності"})})]},c.id))})}):"matching"===a.type?(0,b.jsx)("div",{className:"list-group",children:(a._displayLeft||[]).map(c=>(0,b.jsxs)("div",{className:"list-group-item bg-transparent border-0 d-flex align-items-center gap-3",children:[(0,b.jsx)("div",{className:"flex-fill",children:c.text}),(0,b.jsx)("div",{className:"w-50",children:(0,b.jsxs)("select",{className:"form-select",value:q[a.id]&&(q[a.id][c.pairId]??""),onChange:b=>{var d,e;return d=c.pairId,e=b.target.value,void r(b=>{let c="object"==typeof b[a.id]&&null!==b[a.id]?{...b[a.id]}:{};return c[d]=e,{...b,[a.id]:c}})},children:[(0,b.jsx)("option",{value:"",children:"-- Виберіть відповідність --"}),(a._displayRight||[]).map(a=>(0,b.jsx)("option",{value:a.pairId,children:a.text},a.pairId))]})})]},c.pairId))}):"open"===a.type?(0,b.jsx)("div",{children:(0,b.jsx)("textarea",{className:"form-control",rows:3,value:q[a.id]||"",onChange:b=>{var c;return c=b.target.value,void r(b=>({...b,[a.id]:c}))}})}):null]})]},a.id)),(0,b.jsxs)("div",{className:"d-flex gap-2",children:[(0,b.jsx)("button",{className:"btn btn-primary",onClick:function(){u||(v(!0),(async()=>{let a=!1;try{let b=await fetch(`/api/public-tests/${f}/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:q})});if(!b.ok){let a=await b.text();console.warn("Submit error:",a),alert("Помилка надсилання відповіді"),h.push("/tests");return}let c=await b.json();if(c&&c.ok){if(c.attemptId){a=!0,h.push("/");return}x(c);return}alert("Невідома відповідь від сервера.")}catch(a){console.warn(a),alert("Помилка надсилання відповіді")}finally{if(v(!1),!a)try{h.push("/tests")}catch{h.push("/tests")}}})())},disabled:u,children:u?"Надсилаю...":"Завершити та надіслати"}),(0,b.jsx)(e.default,{href:"/tests",className:"btn btn-outline-secondary",children:"Відмінити"})]})]})]}),(0,b.jsx)(g,{url:o,onClose:()=>p(null)}),w?(0,b.jsx)("div",{onClick:()=>x(null),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:(0,b.jsxs)("div",{className:"menu-box p-4",style:{maxWidth:800,width:"95%"},onClick:a=>a.stopPropagation(),children:[(0,b.jsx)("h4",{children:"Результат"}),void 0!==w.totalScore?(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("strong",{children:"Бали:"})," ",w.totalScore," / ",w.totalPossible]}):null,Array.isArray(w.perQuestion)?(0,b.jsxs)("div",{children:[(0,b.jsx)("h5",{children:"Деталі питань"}),(0,b.jsx)("div",{className:"list-group",children:w.perQuestion.map((a,c)=>(0,b.jsx)("div",{className:"list-group-item",children:(0,b.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,b.jsxs)("div",{children:[c+1,". ",a.type]}),(0,b.jsxs)("div",{children:[a.score," / ",a.points]})]})},a.id||c))})]}):w.totalScore?null:(0,b.jsx)("div",{className:"text-muted",children:"Результати не доступні."}),(0,b.jsx)("div",{className:"mt-3 d-flex justify-content-end",children:(0,b.jsx)("button",{className:"btn btn-primary",onClick:()=>x(null),children:"Закрити"})})]})}):null]}):(0,b.jsx)("div",{className:"container min-vh-100",children:"Тест не знайдено або недоступний."})}function g({url:a,onClose:c}){return a?(0,b.jsx)("div",{onClick:c,style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:20},children:(0,b.jsx)("img",{src:a,alt:"preview",style:{maxWidth:"90vw",maxHeight:"90vh",borderRadius:8}})}):null}a.s(["default",()=>f])}];

//# sourceMappingURL=app_tests_%5Bid%5D_take_page_tsx_ccd2fea3._.js.map