{"version":3,"sources":["../../../../app/tests/%5Bid%5D/take/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useParams } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\n\r\ntype Q = any;\r\n\r\nexport default function TakePageClient() {\r\n  const params = useParams();\r\n  const id = params?.id;\r\n  const router = useRouter();\r\n  const [test, setTest] = useState<any | null>(null);\r\n  const [viewer, setViewer] = useState<any | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [lightboxUrl, setLightboxUrl] = useState<string | null>(null);\r\n  const [answers, setAnswers] = useState<Record<string, any>>({});\r\n  const [started, setStarted] = useState<boolean>(false);\r\n  const [submitting, setSubmitting] = useState<boolean>(false);\r\n  const [resultPreview, setResultPreview] = useState<any | null>(null);\r\n  const [remainingSeconds, setRemainingSeconds] = useState<number | null>(null);\r\n  const timerRef = (typeof window !== \"undefined\") ? { current: null as any } : { current: null as any };\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    async function load() {\r\n      if (!id) return;\r\n      try {\r\n        const res = await fetch(`/api/public-tests/${id}`);\r\n        if (!res.ok) {\r\n          console.warn(await res.text());\r\n          if (mounted) setLoading(false);\r\n          return;\r\n        }\r\n        const data = await res.json();\r\n        if (mounted) {\r\n          // create shuffled display order for options/pairs per question\r\n          function shuffleArray<T>(arr: T[]) {\r\n            const a = Array.isArray(arr) ? [...arr] : [];\r\n            for (let i = a.length - 1; i > 0; i--) {\r\n              const j = Math.floor(Math.random() * (i + 1));\r\n              const tmp = a[i];\r\n              a[i] = a[j];\r\n              a[j] = tmp;\r\n            }\r\n            return a;\r\n          }\r\n          const t = data.test;\r\n          // determine availability window on client\r\n          const now = new Date();\r\n          const windowEnabled = !!t.dateWindowEnabled;\r\n          const openFrom = t.openFrom ? new Date(t.openFrom) : null;\r\n          const openTo = t.openTo ? new Date(t.openTo) : null;\r\n          const inWindow = !windowEnabled || ((openFrom ? now >= openFrom : true) && (openTo ? now <= openTo : true));\r\n\r\n          const mapped = Array.isArray(t.questions) ? t.questions.map((q: any) => {\r\n            const copy: any = { ...q };\r\n            const opts = q.options || q.data?.options || [];\r\n            const pairs = q.pairs || q.data?.pairs || [];\r\n            if (q.type === \"single_choice\" || q.type === \"single\" || q.type === \"multi_choice\" || q.type === \"multi\" || q.type === \"sequence\") {\r\n              copy._displayOptions = shuffleArray(opts.map((o: any) => ({ ...o })));\r\n            }\r\n            if (q.type === \"matching\") {\r\n              // For matching, shuffle left and right sides independently so taker must match.\r\n              // Use a robust pairId (p.id || p._id || index) to work with varying DB shapes.\r\n              const lefts = pairs.map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.left }));\r\n              const rights = pairs.map((p: any, i: number) => ({ pairId: p.id ?? p._id ?? `p-${i}`, text: p.right }));\r\n              copy._displayLeft = shuffleArray(lefts);\r\n              copy._displayRight = shuffleArray(rights);\r\n            }\r\n            return copy;\r\n          }) : [];\r\n          setTest({ ...t, questions: mapped, __inWindow: inWindow });\r\n          // if server provided viewer info, set it\r\n          if (t._viewer) setViewer(t._viewer);\r\n        }\r\n      } catch (err) {\r\n        console.warn(err);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { mounted = false; };\r\n  }, [id]);\r\n\r\n  useEffect(() => {\r\n    if (!test) return;\r\n    try {\r\n      const key = `test_start_${id}`;\r\n      if (typeof window !== \"undefined\" && localStorage.getItem(key)) {\r\n        localStorage.removeItem(key);\r\n        onStart();\r\n      }\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }, [test]);\r\n\r\n  useEffect(() => {\r\n    if (!lightboxUrl) return;\r\n    function onKey(e: KeyboardEvent) {\r\n      if (e.key === \"Escape\") setLightboxUrl(null);\r\n    }\r\n    window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, [lightboxUrl]);\r\n\r\n  function onSingle(q: Q, optionId: number) {\r\n    setAnswers((s) => ({ ...s, [q.id]: optionId }));\r\n  }\r\n\r\n  function onMulti(q: Q, optionId: number) {\r\n    setAnswers((s) => {\r\n      const cur: number[] = s[q.id] || [];\r\n      const next = cur.includes(optionId) ? cur.filter((x) => x !== optionId) : [...cur, optionId];\r\n      return { ...s, [q.id]: next };\r\n    });\r\n  }\r\n\r\n  function onOpen(q: Q, text: string) {\r\n    setAnswers((s) => ({ ...s, [q.id]: text }));\r\n  }\r\n\r\n  function onSequenceChange(q: Q, itemId: string | number, pos: number | \"\") {\r\n    setAnswers((s) => {\r\n      const cur = typeof s[q.id] === \"object\" && s[q.id] !== null ? { ...s[q.id] } : {};\r\n      if (pos === \"\" || pos === null) {\r\n        delete cur[itemId];\r\n      } else {\r\n        cur[itemId] = Number(pos);\r\n      }\r\n      return { ...s, [q.id]: cur };\r\n    });\r\n  }\r\n\r\n  function onMatchSelect(q: Q, leftPairId: string | number, rightPairId: string | number) {\r\n    setAnswers((s) => {\r\n      const cur = typeof s[q.id] === \"object\" && s[q.id] !== null ? { ...s[q.id] } : {};\r\n      cur[leftPairId] = rightPairId;\r\n      return { ...s, [q.id]: cur };\r\n    });\r\n  }\r\n\r\n  function onStart() {\r\n    // placeholder: scroll to questions\r\n    const el = document.querySelector(\".questions-section\");\r\n    if (el) el.scrollIntoView({ behavior: \"smooth\" });\r\n    // start timer if test is timed\r\n    if (test?.timed && !started) {\r\n      const secs = Number(test.timeLimitMinutes) ? Math.max(1, Math.floor(Number(test.timeLimitMinutes) * 60)) : 0;\r\n      setRemainingSeconds(secs);\r\n      setStarted(true);\r\n      if (timerRef.current) clearInterval(timerRef.current);\r\n      timerRef.current = setInterval(() => {\r\n        setRemainingSeconds((s) => {\r\n          if (s === null) return s;\r\n          if (s <= 1) {\r\n            // time's up\r\n            clearInterval(timerRef.current);\r\n            submitLocal();\r\n            return 0;\r\n          }\r\n          return s - 1;\r\n        });\r\n      }, 1000);\r\n    }\r\n  }\r\n\r\n  function submitLocal() {\r\n    try { if (timerRef.current) clearInterval(timerRef.current); } catch {}\r\n    if (submitting) return; // prevent duplicate submits\r\n    setSubmitting(true);\r\n    (async () => {\r\n      let didRedirect = false;\r\n      try {\r\n        const res = await fetch(`/api/public-tests/${id}/submit`, {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ answers }),\r\n        });\r\n        if (!res.ok) {\r\n          const txt = await res.text();\r\n          console.warn(\"Submit error:\", txt);\r\n          alert(\"Помилка надсилання відповіді\");\r\n          router.push(\"/tests\");\r\n          return;\r\n        }\r\n        const data = await res.json();\r\n        if (data && data.ok) {\r\n          // If server returned an attemptId, it was saved — behave as before.\r\n          if (data.attemptId) {\r\n            try { if (typeof window !== \"undefined\") alert(\"Відповіді збережено\"); } catch {}\r\n            didRedirect = true;\r\n            router.push(\"/\");\r\n            return;\r\n          }\r\n          // Anonymous taker and server did not persist: show immediate results according to returned payload\r\n          setResultPreview(data);\r\n          return;\r\n        } else {\r\n          alert(\"Невідома відповідь від сервера.\");\r\n        }\r\n      } catch (err) {\r\n        console.warn(err);\r\n        alert(\"Помилка надсилання відповіді\");\r\n      } finally {\r\n        // if we didn't already redirect to the saved attempt, go back to tests\r\n        setSubmitting(false);\r\n        if (!didRedirect) {\r\n          try {\r\n            if (typeof window !== \"undefined\" && window.location.pathname && window.location.pathname.startsWith(\"/history\")) {\r\n              // already on a history page — do nothing\r\n            } else {\r\n              router.push(\"/tests\");\r\n            }\r\n          } catch {\r\n            router.push(\"/tests\");\r\n          }\r\n        }\r\n      }\r\n    })();\r\n  }\r\n\r\n  if (loading) return <div className=\"container min-vh-100\">Завантаження...</div>;\r\n  if (!test) return <div className=\"container min-vh-100\">Тест не знайдено або недоступний.</div>;\r\n  // if test is outside allowed window, show message\r\n  if (test.__inWindow === false) {\r\n    return (\r\n      <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n        <h2 className=\"mb-3\">{test.title}</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-warning\">Тест наразі недоступний за часовим вікном.</div>\r\n          <div className=\"mb-3\">\r\n            <Link href=\"/tests\" className=\"btn btn-outline-secondary\">Назад до списку</Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  function formatTime(secs: number | null) {\r\n    if (secs === null) return \"\";\r\n    const m = Math.floor(secs / 60);\r\n    const s = secs % 60;\r\n    return `${String(m).padStart(2, \"0\")}:${String(s).padStart(2, \"0\")}`;\r\n  }\r\n\r\n  const requiresLogin = !!test.storeResponses || !!test.requiresLogin;\r\n  const isAuthenticated = !!viewer;\r\n\r\n  if (requiresLogin && !isAuthenticated) {\r\n    return (\r\n      <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n        <h2 className=\"mb-3\">{test.title}</h2>\r\n        <div className=\"menu-box w-100\">\r\n          <div className=\"alert alert-warning\">Цей тест вимагає реєстрації для проходження. Будь ласка, <a href=\"/login\">увійдіть</a> або <a href=\"/register\">зареєструйтесь</a>.</div>\r\n          <div className=\"mb-3\">\r\n            <Link href=\"/tests\" className=\"btn btn-outline-secondary\">Назад до списку</Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <div className=\"container d-flex flex-column align-items-center min-vh-100\">\r\n      <h2 className=\"mb-3\">{test.title}</h2>\r\n      <div className=\"w-100 mb-2 d-flex justify-content-between align-items-center\">\r\n        <div>\r\n          {started ? (\r\n            <div className=\"badge bg-danger\">Час: {formatTime(remainingSeconds)}</div>\r\n          ) : null}\r\n        </div>\r\n        {test.timed ? <div className=\"text-muted\">Час на тест: {test.timeLimitMinutes} хв</div> : null}\r\n      </div>\r\n\r\n      <div className=\"menu-box w-100 questions-section\">\r\n        {Array.isArray(test.questions) && test.questions.map((q: any, idx: number) => (\r\n          <div key={q.id} className=\"mb-4\">\r\n            <div className=\"fw-semibold\">{idx + 1}. {q.text}</div>\r\n              <div className=\"mt-2\">\r\n                {q.imageUrl ? (\r\n                  <div className=\"mb-3\">\r\n                    <img\r\n                      src={q.imageUrl}\r\n                      alt={`Question ${idx + 1} image`}\r\n                      style={{\r\n                        cursor: \"pointer\",\r\n                        objectFit: \"contain\",\r\n                        maxWidth: \"33%\",\r\n                        maxHeight: \"33vh\",\r\n                        width: \"auto\",\r\n                        height: \"auto\",\r\n                        borderRadius: 8,\r\n                      }}\r\n                      onClick={() => setLightboxUrl(q.imageUrl)}\r\n                    />\r\n                  </div>\r\n                ) : null}\r\n              {q.type === \"single_choice\" || q.type === \"single\" ? (\r\n                <div>\r\n                  {(q._displayOptions || q.options || q.data?.options || []).map((opt: any) => (\r\n                    <label key={opt.id} className=\"d-block mb-1\">\r\n                      <input type=\"radio\" name={`q-${q.id}`} checked={answers[q.id] === opt.id} onChange={() => onSingle(q, opt.id)} /> {opt.text}\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"multi_choice\" || q.type === \"multi\" ? (\r\n                <div>\r\n                  {(q._displayOptions || q.options || q.data?.options || []).map((opt: any) => (\r\n                    <label key={opt.id} className=\"d-block mb-1\">\r\n                      <input type=\"checkbox\" checked={(answers[q.id] || []).includes(opt.id)} onChange={() => onMulti(q, opt.id)} /> {opt.text}\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              ) : q.type === \"sequence\" ? (\r\n                <div>\r\n                  <div className=\"list-group\">\r\n                      {((q._displayOptions || q.options || q.data?.options || []) as any[]).map((it: any, i: number) => (\r\n                      <div key={it.id} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                        <div className=\"flex-fill\">{it.text}</div>\r\n                        <div className=\"w-50\">\r\n                          <input\r\n                            className=\"form-control bg-white\"\r\n                            type=\"number\"\r\n                            min={1}\r\n                            max={(q._displayOptions || q.options || q.data?.options || []).length}\r\n                            value={(answers[q.id] && answers[q.id][it.id]) || \"\"}\r\n                            onChange={(e) => onSequenceChange(q, it.id, e.target.value === \"\" ? \"\" : Number(e.target.value))}\r\n                            placeholder=\"№ в послідовності\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              ) : q.type === \"matching\" ? (\r\n                    <div className=\"list-group\">\r\n                      {(q._displayLeft || []).map((l: any) => (\r\n                        <div key={l.pairId} className=\"list-group-item bg-transparent border-0 d-flex align-items-center gap-3\">\r\n                          <div className=\"flex-fill\">{l.text}</div>\r\n                          <div className=\"w-50\">\r\n                            <select\r\n                              className=\"form-select\"\r\n                              value={(answers[q.id] && (answers[q.id][l.pairId] ?? \"\"))}\r\n                              onChange={(e) => onMatchSelect(q, l.pairId, e.target.value)}\r\n                            >\r\n                              <option value=\"\">-- Виберіть відповідність --</option>\r\n                              {(q._displayRight || []).map((r: any) => (\r\n                                <option key={r.pairId} value={r.pairId}>{r.text}</option>\r\n                              ))}\r\n                            </select>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n              ) : q.type === \"open\" ? (\r\n                <div>\r\n                  <textarea className=\"form-control\" rows={3} value={answers[q.id] || \"\"} onChange={(e) => onOpen(q, e.target.value)} />\r\n                </div>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n        <div className=\"d-flex gap-2\">\r\n          <button className=\"btn btn-primary\" onClick={submitLocal} disabled={submitting}>{submitting ? \"Надсилаю...\" : \"Завершити та надіслати\"}</button>\r\n          <Link href=\"/tests\" className=\"btn btn-outline-secondary\">Відмінити</Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <Lightbox url={lightboxUrl} onClose={() => setLightboxUrl(null)} />\r\n    {resultPreview ? (\r\n      <div\r\n        onClick={() => setResultPreview(null)}\r\n        style={{ position: \"fixed\", inset: 0, background: \"rgba(0,0,0,0.6)\", display: \"flex\", alignItems: \"center\", justifyContent: \"center\", zIndex: 10000 }}\r\n      >\r\n        <div className=\"menu-box p-4\" style={{ maxWidth: 800, width: \"95%\" }} onClick={(e) => e.stopPropagation()}>\r\n          <h4>Результат</h4>\r\n          {typeof resultPreview.totalScore !== 'undefined' ? (\r\n            <div className=\"mb-2\"><strong>Бали:</strong> {resultPreview.totalScore} / {resultPreview.totalPossible}</div>\r\n          ) : null}\r\n          {Array.isArray(resultPreview.perQuestion) ? (\r\n            <div>\r\n              <h5>Деталі питань</h5>\r\n              <div className=\"list-group\">\r\n                {resultPreview.perQuestion.map((p: any, i: number) => (\r\n                  <div key={p.id || i} className=\"list-group-item\">\r\n                    <div className=\"d-flex justify-content-between\">\r\n                      <div>{i + 1}. {p.type}</div>\r\n                      <div>{p.score} / {p.points}</div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            !resultPreview.totalScore ? <div className=\"text-muted\">Результати не доступні.</div> : null\r\n          )}\r\n          <div className=\"mt-3 d-flex justify-content-end\">\r\n            <button className=\"btn btn-primary\" onClick={() => setResultPreview(null)}>Закрити</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    ) : null}\r\n    </>\r\n  );\r\n}\r\n\r\n// Lightbox overlay rendered at root of module so it's inside same component render\r\nfunction Lightbox({ url, onClose }: { url: string | null; onClose: () => void }) {\r\n  if (!url) return null;\r\n  return (\r\n    <div\r\n      onClick={onClose}\r\n      style={{\r\n        position: \"fixed\",\r\n        inset: 0,\r\n        background: \"rgba(0,0,0,0.75)\",\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        zIndex: 9999,\r\n        padding: 20,\r\n      }}\r\n    >\r\n      <img src={url} alt=\"preview\" style={{ maxWidth: \"90vw\", maxHeight: \"90vh\", borderRadius: 8 }} />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"wDACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAIe,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAK,GAAQ,GACb,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAa,MACvC,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAa,MAC3C,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAwB,MACxD,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAsB,CAAC,GACvD,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAU,GAC1C,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAU,GAChD,CAAC,EAAe,EAAiB,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAqB,MACzD,CAAC,EAAkB,EAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,YA4MxE,CAzMA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAAI,GAAU,EA2Dd,OA1DA,AAyDA,eAzDe,EACb,GAAK,CAAD,CACJ,EADS,CACL,CACF,IAAM,EAAM,MAAM,MAAM,CAAC,kBAAkB,EAAE,EAAA,CAAI,EACjD,GAAI,CAAC,EAAI,EAAE,CAAE,CACX,QAAQ,IAAI,CAAC,MAAM,EAAI,IAAI,IACvB,GAAS,GAAW,GACxB,MACF,CACA,IAAM,EAAO,MAAM,EAAI,IAAI,GAC3B,GAAI,EAAS,CAEX,SAAS,EAAgB,CAAQ,EAC/B,IAAM,EAAI,MAAM,OAAO,CAAC,GAAO,IAAI,EAAI,CAAG,EAAE,CAC5C,IAAK,IAAI,EAAI,EAAE,MAAM,CAAG,EAAG,EAAI,EAAG,IAAK,CACrC,IAAM,EAAI,KAAK,KAAK,CAAC,KAAK,MAAM,IAAM,CAAD,EAAK,CAAC,EACrC,EAAM,CAAC,CAAC,EAAE,CAChB,CAAC,CAAC,EAAE,CAAG,CAAC,CAAC,EAAE,CACX,CAAC,CAAC,EAAE,CAAG,CACT,CACA,OAAO,CACT,CACA,IAAM,EAAI,EAAK,IAAI,CAEb,EAAM,IAAI,KACV,EAAgB,CAAC,CAAC,EAAE,iBAAiB,CACrC,EAAW,EAAE,QAAQ,CAAG,IAAI,KAAK,EAAE,QAAQ,EAAI,KAC/C,EAAS,EAAE,MAAM,CAAG,IAAI,KAAK,EAAE,MAAM,EAAI,KAGzC,EAAS,MAAM,OAAO,CAAC,EAAE,SAAS,EAAI,EAAE,SAAS,CAAC,GAAG,CAAC,AAAC,IAC3D,IAAM,EAAY,CAAE,GAAG,CAAE,AAAD,EAClB,EAAO,EAAE,OAAO,EAAI,EAAE,IAAI,EAAE,SAAW,EAAE,CACzC,EAAQ,EAAE,KAAK,EAAI,EAAE,IAAI,EAAE,OAAS,EAAE,CAI5C,IAHe,kBAAX,EAAE,IAAI,EAAwB,AAAW,aAAT,IAAI,EAA4B,iBAAX,EAAE,IAAI,EAAuB,AAAW,YAAT,IAAI,EAA2B,aAAX,EAAE,IAAI,AAAK,GAAY,CACjI,EAAK,eAAe,CAAG,EAAa,EAAK,GAAG,CAAC,AAAC,IAAW,AAAC,CAAE,GAAG,CAAC,CAAC,CAAC,EAAA,EAErD,aAAX,EAAE,IAAI,CAAiB,CAGzB,IAAM,EAAQ,EAAM,GAAG,CAAC,CAAC,EAAQ,IAAc,CAAC,CAAE,OAAQ,EAAE,EAAE,EAAI,EAAE,GAAG,EAAI,CAAC,EAAE,EAAE,EAAA,CAAG,CAAE,KAAM,EAAE,IAAI,CAAC,CAAC,EAC7F,EAAS,EAAM,GAAG,CAAC,CAAC,EAAQ,IAAc,CAAC,CAAE,OAAQ,EAAE,EAAE,EAAI,EAAE,GAAG,EAAI,CAAC,EAAE,EAAE,EAAA,CAAG,CAAE,KAAM,EAAE,KAAK,CAAC,CAAC,EACrG,EAAK,YAAY,CAAG,EAAa,GACjC,EAAK,aAAa,CAAG,EAAa,EACpC,CACA,OAAO,CACT,GAAK,EAAE,CACP,EAAQ,CAAE,GAAG,CAAC,CAAE,UAAW,EAAQ,WAnBlB,CAAC,AAmB6B,GAnBX,EAAC,GAAW,GAAO,CAAW,CAAI,IAAM,CAAD,EAAU,EAAnB,CAA0B,CAAS,CAAI,AAmBjD,GAEpD,EAAE,EArB+F,KAqBxF,EAAE,EAAU,EAAE,OAAO,CACpC,CACF,CAAE,MAAO,EAAK,CACZ,QAAQ,IAAI,CAAC,EACf,QAAU,CACJ,GAAS,GAAW,EAC1B,CACF,IAEO,KAAQ,EAAU,EAAO,CAClC,EAAG,CAAC,EAAG,EAEP,CAAA,EAAA,EAAA,SAAS,AAAT,EAAU,KAWV,EAAG,CAAC,EAAK,EAET,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,GAAK,CAAD,CAKJ,OADA,IAJkB,GAIX,gBAAgB,CAAC,UAAW,GAC5B,IAAM,OAAO,mBAAmB,CAAC,UAAW,GAJnD,SAAS,EAAM,CAAgB,EACf,WAAV,EAAE,GAAG,EAAe,EAAe,KACzC,CAGF,EAAG,CAAC,EAAY,EAsHZ,GAAgB,CAAA,EAAA,EAAA,CAAP,EAAO,EAAC,MAAA,CAAI,UAAU,gCAAuB,oBACrD,GAEmB,GAFb,CAEP,EAAK,CAAsB,SAAZ,CAEf,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uEACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAQ,EAAK,KAAK,GAChC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2BACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+BAAsB,+CACrC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,SAAS,UAAU,qCAA4B,4BAiBpE,AAAI,CAHkB,AAAE,CAAD,CAAM,cAAc,AAGtB,CAAC,CAH2B,EAAK,AAAP,CAAC,YAAM,AAAa,CAG5B,EAFd,CAAC,EAItB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uEACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAQ,EAAK,KAAK,GAChC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2BACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gCAAsB,4DAAyD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,KAAK,kBAAS,aAAY,QAAK,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,KAAK,qBAAY,mBAAkB,OACtK,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,SAAS,UAAU,qCAA4B,4BAQlE,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACA,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uEACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gBAAQ,EAAK,KAAK,GAChC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yEACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UACE,EACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4BAAkB,QA/B3C,AA+BiD,SA/BxC,AAAW,CAAmB,EACrC,GAAI,AAAS,SAAM,MAAO,GAC1B,IAAM,EAAI,KAAK,KAAK,CAAC,EAAO,IAE5B,MAAO,CAAA,EAAG,OAAO,GAAG,QAAQ,CAAC,EAAG,KAAK,CAAC,EAAE,OAD9B,AACqC,EAD9B,IACiC,QAAQ,CAAC,EAAG,KAAA,CAAM,AACtE,EA0B4D,MAChD,OAEL,EAAK,KAAK,CAAG,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uBAAa,gBAAc,EAAK,gBAAgB,CAAC,SAAY,QAG5F,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6CACZ,MAAM,OAAO,CAAC,EAAK,SAAS,GAAK,EAAK,SAAS,CAAC,GAAG,CAAC,CAAC,EAAQ,IAC5D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAe,UAAU,iBACxB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBAAe,EAAM,EAAE,KAAG,EAAE,IAAI,IAC7C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACZ,EAAE,QAAQ,CACT,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,IAAK,EAAE,QAAQ,CACf,IAAK,CAAC,SAAS,EAAE,EAAM,EAAE,MAAM,CAAC,CAChC,MAAO,CACL,OAAQ,UACR,UAAW,UACX,SAAU,MACV,UAAW,OACX,MAAO,OACP,OAAQ,OACR,aAAc,CAChB,EACA,QAAS,IAAM,EAAe,EAAE,QAAQ,MAG1C,KACM,kBAAX,EAAE,IAAI,EAAmC,WAAX,EAAE,IAAI,CACnC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UACE,CAAC,EAAE,eAAe,EAAI,EAAE,OAAO,EAAI,EAAE,IAAI,EAAE,SAAW,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAC9D,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAmB,UAAU,yBAC5B,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,QAAQ,KAAM,CAAC,EAAE,EAAE,EAAE,EAAE,CAAA,CAAE,CAAE,QAAS,CAAO,CAAC,EAAE,EAAE,CAAC,GAAK,EAAI,EAAE,CAAE,SAAU,IAAM,cArMtF,EAqMkG,EAAI,EAAE,EArMxF,IACtC,EAAW,AAAC,IAAM,AAAC,CAAE,GAAG,CAAC,CAAE,CAAC,AAoMyF,EApMvF,EAAE,CAAC,CAAE,EAAS,CAAC,KAoMsF,IAAE,EAAI,IAAI,GADjH,EAAI,EAAE,KAKT,iBAAX,EAAE,IAAI,EAAkC,UAAX,EAAE,IAAI,CACrC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UACE,CAAC,EAAE,eAAe,EAAI,EAAE,OAAO,EAAI,EAAE,IAAI,EAAE,SAAW,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAC9D,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAmB,UAAU,yBAC5B,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,WAAW,QAAU,AAAD,EAAQ,CAAC,EAAE,EAAE,CAAC,EAAI,EAAA,AAAE,EAAE,QAAQ,CAAC,EAAI,EAAE,EAAG,SAAU,IAAM,cAzMrF,EAyMgG,EAAI,EAAE,EAzMtF,IACrC,EAAW,AAAC,IACV,IAAM,EAAgB,CAAC,CAAC,EAAE,EAAE,CAAC,EAAI,EAAE,CAC7B,EAAO,EAAI,QAAQ,CAAC,GAAY,EAAI,MAAM,CAAC,AAAC,GAAM,IAAM,GAAY,IAAI,EAAK,EAAS,CAC5F,MAAO,CAAE,GAAG,CAAC,CAAE,CAqMiG,AArMhG,EAAE,EAAE,CAAC,CAAE,CAAK,CAC9B,MAoMgI,IAAE,EAAI,IAAI,GAD9G,EAAI,EAAE,KAKpB,AAAW,eAAT,IAAI,CACR,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBACT,CAAC,EAAE,eAAe,EAAI,EAAE,OAAO,EAAI,EAAE,IAAI,EAAE,SAAW,EAAA,AAAE,EAAY,GAAG,CAAC,CAAC,EAAS,IACpF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAgB,UAAU,oFACzB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBAAa,EAAG,IAAI,GACnC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,UAAU,wBACV,KAAK,SACL,IAAK,EACL,IAAK,CAAC,EAAE,eAAe,EAAI,EAAE,OAAO,EAAI,EAAE,IAAI,EAAE,SAAW,EAAA,AAAE,EAAE,MAAM,CACrE,MAAQ,CAAO,CAAC,EAAE,EAAE,CAAC,EAAI,CAAO,CAAC,EAAE,EAAE,CAAC,CAAC,EAAG,EAAE,CAAC,EAAK,GAClD,SAAU,AAAC,IAAM,eA9MX,EA8M+B,EAAG,EA9MX,AA8Ma,CA9MX,EA8MgC,CA9MhB,IA8MH,EAAE,MAAM,CAAC,KAAK,CAAU,GAAK,OAAO,EAAE,MAAM,CAAC,KAAK,OA7MtH,EAAW,AAAC,IACV,IAAM,EAAyB,UAAnB,OAAO,CAAC,CAAC,EAAE,EAAE,CAAC,EAA6B,OAAZ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAY,CAAE,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,AAAC,EAAI,CAAC,EAMhF,MALY,KAAR,GAAsB,MAAM,CAAd,EAChB,OAAO,CAAG,CAAC,EAAO,CAElB,CAAG,CAAC,EAAO,CAAG,OAAO,GAEhB,CAAE,GAAG,CAAC,CAAE,CAAC,AAsMwC,EAtMtC,EAAE,CAAC,CAAE,CAAI,CAC7B,IAsMwB,YAAY,0BAVR,EAAG,EAAE,OAiBR,aAAX,EAAE,IAAI,CACJ,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBACZ,CAAC,EAAE,YAAY,EAAI,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAC3B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAmB,UAAU,oFAC5B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBAAa,EAAE,IAAI,GAClC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,UAAU,cACV,MAAQ,CAAO,CAAC,EAAE,EAAE,CAAC,GAAK,CAAD,AAAQ,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,MAAM,CAAC,EAAI,EAAA,CAAE,CACvD,SAAU,AAAC,IAAM,eAnNhB,EAmNiC,EAAE,MAnNR,AAmNc,CAnNZ,EAmNc,EAAE,MAAM,CAnNM,AAmNL,KAAK,MAlNpF,EAAW,AAAC,IACV,IAAM,EAAyB,AAAnB,iBAAO,CAAC,CAAC,EAAE,EAAE,CAAC,EAA6B,OAAZ,CAAC,CAAC,EAAE,EAAE,CAAC,CAAY,CAAE,GAAG,CAAC,CAAC,AAiNd,EAjNgB,EAAE,CAAE,AAAD,EAAK,CAAC,EAEhF,OADA,CAAG,CAAC,EAAW,CAAG,EACX,CAAE,GAAG,CAAC,CAAE,CAAC,EAAE,EAAE,CAAC,CAAE,CAAI,CAC7B,cAgN0B,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,YAAG,iCAChB,AAAC,GAAE,aAAa,EAAI,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAC5B,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAsB,MAAO,EAAE,MAAM,UAAG,EAAE,IAAI,EAAlC,EAAE,MAAM,UAVnB,EAAE,MAAM,KAiBb,SAAX,EAAE,IAAI,CACR,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UACC,CAAA,EAAA,EAAA,GAAA,EAAC,WAAA,CAAS,UAAU,eAAe,KAAM,EAAG,MAAO,CAAO,CAAC,EAAE,EAAE,CAAC,EAAI,GAAI,SAAU,AAAC,IAAM,aAhPnF,EAgP6F,EAhPjF,AAgPmF,MAAM,CAAC,KAAK,MA/O/H,EAAW,AAAC,IAAM,AAAC,CAAE,GAAG,CAAC,CAAE,CAAC,AA+OkF,EA/OhF,EAAE,CAAC,CAAE,EAAK,CAAC,OAiP3B,UAlFE,EAAE,EAAE,GAuFhB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,yBACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,kBAAkB,QAvM5C,CAuMqD,QAvM5C,EAEH,IACJ,GAAc,GACd,AAAC,EAFe,QAAQ,CAGtB,IAAI,GAAc,EAClB,GAAI,CACF,IAAM,EAAM,MAAM,EAL8B,IAKxB,CAAC,kBAAkB,EAAE,EAAG,OAAO,CAAC,CAAE,CACxD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,SAAS,CAAC,SAAE,CAAQ,EACjC,GACA,GAAI,CAAC,EAAI,EAAE,CAAE,CACX,IAAM,EAAM,MAAM,EAAI,IAAI,GAC1B,QAAQ,IAAI,CAAC,gBAAiB,GAC9B,MAAM,gCACN,EAAO,IAAI,CAAC,UACZ,MACF,CACA,IAAM,EAAO,MAAM,EAAI,IAAI,GAC3B,GAAI,GAAQ,EAAK,EAAE,CAAE,CAEnB,GAAI,EAAK,SAAS,CAAE,CAElB,GAAc,EACd,EAAO,IAAI,CAAC,KACZ,MACF,CAEA,EAAiB,GACjB,MACF,CACE,MAAM,AADD,kCAGT,CAAE,MAAO,EAAK,CACZ,QAAQ,IAAI,CAAC,GACb,MAAM,+BACR,QAAU,CAGR,GADA,GAAc,GACV,CAAC,EACH,GAAI,CAIA,EAAO,IAAI,CALC,AAKA,SAEhB,CAAE,KAAM,CACN,EAAO,IAAI,CAAC,SACd,CAEJ,CACF,CAAC,IACH,EAkJkE,SAAU,WAAa,EAAa,cAAgB,2BAC9G,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,SAAS,UAAU,qCAA4B,uBAIhE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAS,IAAK,EAAa,QAAS,IAAM,EAAe,QACzD,EACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,QAAS,IAAM,EAAiB,MAChC,MAAO,CAAE,SAAU,QAAS,MAAO,EAAG,WAAY,kBAAmB,QAAS,OAAQ,WAAY,SAAU,eAAgB,SAAU,OAAQ,GAAM,WAEpJ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,eAAe,MAAO,CAAE,SAAU,IAAK,MAAO,KAAM,EAAG,QAAS,AAAC,GAAM,EAAE,eAAe,aACrG,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,cACH,KAAoC,IAA7B,EAAc,UAAU,CAC9B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBAAO,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,UAAc,IAAE,EAAc,UAAU,CAAC,MAAI,EAAc,aAAa,IACpG,KACH,MAAM,OAAO,CAAC,EAAc,WAAW,EACtC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,kBACJ,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBACZ,EAAc,WAAW,CAAC,GAAG,CAAC,CAAC,EAAQ,IACtC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAoB,UAAU,2BAC7B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WAAK,EAAI,EAAE,KAAG,EAAE,IAAI,IACrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WAAK,EAAE,KAAK,CAAC,MAAI,EAAE,MAAM,QAHpB,EAAE,EAAE,EAAI,SAUxB,AAAC,EAAc,UAAU,CAA+D,KAA5D,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBAAa,4BAE1D,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2CACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,kBAAkB,QAAS,IAAM,EAAiB,eAAO,mBAI/E,QArLY,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gCAAuB,qCAwL1D,CAGA,SAAS,EAAS,KAAE,CAAG,SAAE,CAAO,CAA+C,SAC7E,AAAK,EAEH,CAAA,CAFE,CAAM,AAER,EAAA,GAAA,EAAC,MAAA,CACC,QAAS,EACT,MAAO,CACL,SAAU,QACV,MAAO,EACP,WAAY,mBACZ,QAAS,OACT,WAAY,SACZ,eAAgB,SAChB,OAAQ,KACR,QAAS,EACX,WAEA,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,IAAK,EAAK,IAAI,UAAU,MAAO,CAAE,SAAU,OAAQ,UAAW,OAAQ,aAAc,CAAE,MAf9E,IAkBnB"}