(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72860,e=>{"use strict";var t=e.i(43476),i=e.i(71645),s=e.i(18566),n=e.i(22016);function l(){let e=(0,s.useParams)(),l=e?.id,r=(0,s.useRouter)(),[d,c]=(0,i.useState)(null),[o,u]=(0,i.useState)(null),[m,h]=(0,i.useState)(!0),[p,x]=(0,i.useState)(null),[v,j]=(0,i.useState)({}),[f,g]=(0,i.useState)(!1),[y,b]=(0,i.useState)(!1),[N,w]=(0,i.useState)(null),[S,_]=(0,i.useState)(null),k={current:null};function I(){try{k.current&&clearInterval(k.current)}catch{}y||(b(!0),(async()=>{let e=!1;try{let t=await fetch(`/api/public-tests/${l}/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:v})});if(!t.ok){let e=await t.text();console.warn("Submit error:",e),alert("Помилка надсилання відповіді"),r.push("/tests");return}let i=await t.json();if(i&&i.ok){if(i.attemptId){try{alert("Відповіді збережено")}catch{}e=!0,r.push("/");return}w(i);return}alert("Невідома відповідь від сервера.")}catch(e){console.warn(e),alert("Помилка надсилання відповіді")}finally{if(b(!1),!e)try{window.location.pathname&&window.location.pathname.startsWith("/history")||r.push("/tests")}catch{r.push("/tests")}}})())}return((0,i.useEffect)(()=>{let e=!0;return async function(){if(l)try{let i=await fetch(`/api/public-tests/${l}`);if(!i.ok){console.warn(await i.text()),e&&h(!1);return}let s=await i.json();if(e){function t(e){let t=Array.isArray(e)?[...e]:[];for(let e=t.length-1;e>0;e--){let i=Math.floor(Math.random()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}return t}let e=s.test,i=new Date,n=!!e.dateWindowEnabled,l=e.openFrom?new Date(e.openFrom):null,a=e.openTo?new Date(e.openTo):null,r=Array.isArray(e.questions)?e.questions.map(e=>{let i={...e},s=e.options||e.data?.options||[],n=e.pairs||e.data?.pairs||[];if(("single_choice"===e.type||"single"===e.type||"multi_choice"===e.type||"multi"===e.type||"sequence"===e.type)&&(i._displayOptions=t(s.map(e=>({...e})))),"matching"===e.type){let e=n.map((e,t)=>({pairId:e.id??e._id??`p-${t}`,text:e.left})),s=n.map((e,t)=>({pairId:e.id??e._id??`p-${t}`,text:e.right}));i._displayLeft=t(e),i._displayRight=t(s)}return i}):[];c({...e,questions:r,__inWindow:!n||(!l||i>=l)&&(!a||i<=a)}),e._viewer&&u(e._viewer)}}catch(e){console.warn(e)}finally{e&&h(!1)}}(),()=>{e=!1}},[l]),(0,i.useEffect)(()=>{if(d)try{let e,t=`test_start_${l}`;localStorage.getItem(t)&&(localStorage.removeItem(t),(e=document.querySelector(".questions-section"))&&e.scrollIntoView({behavior:"smooth"}),d?.timed&&!f&&(_(Number(d.timeLimitMinutes)?Math.max(1,Math.floor(60*Number(d.timeLimitMinutes))):0),g(!0),k.current&&clearInterval(k.current),k.current=setInterval(()=>{_(e=>null===e?e:e<=1?(clearInterval(k.current),I(),0):e-1)},1e3)))}catch(e){}},[d]),(0,i.useEffect)(()=>{if(p)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);function e(e){"Escape"===e.key&&x(null)}},[p]),m)?(0,t.jsx)("div",{className:"container min-vh-100",children:"Завантаження..."}):d?!1===d.__inWindow?(0,t.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,t.jsx)("h2",{className:"mb-3",children:d.title}),(0,t.jsxs)("div",{className:"menu-box w-100",children:[(0,t.jsx)("div",{className:"alert alert-warning",children:"Тест наразі недоступний за часовим вікном."}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(n.default,{href:"/tests",className:"btn btn-outline-secondary",children:"Назад до списку"})})]})]}):(d.storeResponses||d.requiresLogin)&&!o?(0,t.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,t.jsx)("h2",{className:"mb-3",children:d.title}),(0,t.jsxs)("div",{className:"menu-box w-100",children:[(0,t.jsxs)("div",{className:"alert alert-warning",children:["Цей тест вимагає реєстрації для проходження. Будь ласка, ",(0,t.jsx)("a",{href:"/login",children:"увійдіть"})," або ",(0,t.jsx)("a",{href:"/register",children:"зареєструйтесь"}),"."]}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(n.default,{href:"/tests",className:"btn btn-outline-secondary",children:"Назад до списку"})})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,t.jsx)("h2",{className:"mb-3",children:d.title}),(0,t.jsxs)("div",{className:"w-100 mb-2 d-flex justify-content-between align-items-center",children:[(0,t.jsx)("div",{children:f?(0,t.jsxs)("div",{className:"badge bg-danger",children:["Час: ",function(e){if(null===e)return"";let t=Math.floor(e/60);return`${String(t).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`}(S)]}):null}),d.timed?(0,t.jsxs)("div",{className:"text-muted",children:["Час на тест: ",d.timeLimitMinutes," хв"]}):null]}),(0,t.jsxs)("div",{className:"menu-box w-100 questions-section",children:[Array.isArray(d.questions)&&d.questions.map((e,i)=>(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"fw-semibold",children:[i+1,". ",e.text]}),(0,t.jsxs)("div",{className:"mt-2",children:[e.imageUrl?(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("img",{src:e.imageUrl,alt:`Question ${i+1} image`,style:{cursor:"pointer",objectFit:"contain",maxWidth:"33%",maxHeight:"33vh",width:"auto",height:"auto",borderRadius:8},onClick:()=>x(e.imageUrl)})}):null,"single_choice"===e.type||"single"===e.type?(0,t.jsx)("div",{children:(e._displayOptions||e.options||e.data?.options||[]).map(i=>(0,t.jsxs)("label",{className:"d-block mb-1",children:[(0,t.jsx)("input",{type:"radio",name:`q-${e.id}`,checked:v[e.id]===i.id,onChange:()=>{var t;return t=i.id,void j(i=>({...i,[e.id]:t}))}})," ",i.text]},i.id))}):"multi_choice"===e.type||"multi"===e.type?(0,t.jsx)("div",{children:(e._displayOptions||e.options||e.data?.options||[]).map(i=>(0,t.jsxs)("label",{className:"d-block mb-1",children:[(0,t.jsx)("input",{type:"checkbox",checked:(v[e.id]||[]).includes(i.id),onChange:()=>{var t;return t=i.id,void j(i=>{let s=i[e.id]||[],n=s.includes(t)?s.filter(e=>e!==t):[...s,t];return{...i,[e.id]:n}})}})," ",i.text]},i.id))}):"sequence"===e.type?(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"list-group",children:(e._displayOptions||e.options||e.data?.options||[]).map((i,s)=>(0,t.jsxs)("div",{className:"list-group-item bg-transparent border-0 d-flex align-items-center gap-3",children:[(0,t.jsx)("div",{className:"flex-fill",children:i.text}),(0,t.jsx)("div",{className:"w-50",children:(0,t.jsx)("input",{className:"form-control bg-white",type:"number",min:1,max:(e._displayOptions||e.options||e.data?.options||[]).length,value:v[e.id]&&v[e.id][i.id]||"",onChange:t=>{var s,n;return s=i.id,n=""===t.target.value?"":Number(t.target.value),void j(t=>{let i="object"==typeof t[e.id]&&null!==t[e.id]?{...t[e.id]}:{};return""===n||null===n?delete i[s]:i[s]=Number(n),{...t,[e.id]:i}})},placeholder:"№ в послідовності"})})]},i.id))})}):"matching"===e.type?(0,t.jsx)("div",{className:"list-group",children:(e._displayLeft||[]).map(i=>(0,t.jsxs)("div",{className:"list-group-item bg-transparent border-0 d-flex align-items-center gap-3",children:[(0,t.jsx)("div",{className:"flex-fill",children:i.text}),(0,t.jsx)("div",{className:"w-50",children:(0,t.jsxs)("select",{className:"form-select",value:v[e.id]&&(v[e.id][i.pairId]??""),onChange:t=>{var s,n;return s=i.pairId,n=t.target.value,void j(t=>{let i="object"==typeof t[e.id]&&null!==t[e.id]?{...t[e.id]}:{};return i[s]=n,{...t,[e.id]:i}})},children:[(0,t.jsx)("option",{value:"",children:"-- Виберіть відповідність --"}),(e._displayRight||[]).map(e=>(0,t.jsx)("option",{value:e.pairId,children:e.text},e.pairId))]})})]},i.pairId))}):"open"===e.type?(0,t.jsx)("div",{children:(0,t.jsx)("textarea",{className:"form-control",rows:3,value:v[e.id]||"",onChange:t=>{var i;return i=t.target.value,void j(t=>({...t,[e.id]:i}))}})}):null]})]},e.id)),(0,t.jsxs)("div",{className:"d-flex gap-2",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:I,disabled:y,children:y?"Надсилаю...":"Завершити та надіслати"}),(0,t.jsx)(n.default,{href:"/tests",className:"btn btn-outline-secondary",children:"Відмінити"})]})]})]}),(0,t.jsx)(a,{url:p,onClose:()=>x(null)}),N?(0,t.jsx)("div",{onClick:()=>w(null),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:(0,t.jsxs)("div",{className:"menu-box p-4",style:{maxWidth:800,width:"95%"},onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("h4",{children:"Результат"}),void 0!==N.totalScore?(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("strong",{children:"Бали:"})," ",N.totalScore," / ",N.totalPossible]}):null,Array.isArray(N.perQuestion)?(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{children:"Деталі питань"}),(0,t.jsx)("div",{className:"list-group",children:N.perQuestion.map((e,i)=>(0,t.jsx)("div",{className:"list-group-item",children:(0,t.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,t.jsxs)("div",{children:[i+1,". ",e.type]}),(0,t.jsxs)("div",{children:[e.score," / ",e.points]})]})},e.id||i))})]}):N.totalScore?null:(0,t.jsx)("div",{className:"text-muted",children:"Результати не доступні."}),(0,t.jsx)("div",{className:"mt-3 d-flex justify-content-end",children:(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>w(null),children:"Закрити"})})]})}):null]}):(0,t.jsx)("div",{className:"container min-vh-100",children:"Тест не знайдено або недоступний."})}function a({url:e,onClose:i}){return e?(0,t.jsx)("div",{onClick:i,style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:20},children:(0,t.jsx)("img",{src:e,alt:"preview",style:{maxWidth:"90vw",maxHeight:"90vh",borderRadius:8}})}):null}e.s(["default",()=>l])}]);