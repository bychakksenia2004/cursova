(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,51996,e=>{"use strict";e.i(47167);var t=e.i(43476),a=e.i(71645),i=e.i(18566),n=e.i(22016);function s({qid:e,invalidField:a,text:i="",answers:n=[],onChange:s}){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("textarea",{className:`form-control ${a&&a.qid===(e||0)&&"text"===a.field?"is-invalid":""}`,rows:2,value:i,"data-qid":e,"data-field":"text",onChange:e=>s&&s({text:e.target.value,answers:n})}),a&&a.qid===(e||0)&&"text"===a.field&&(0,t.jsx)("div",{className:"invalid-feedback d-block app-error",children:a.message})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[(0,t.jsx)("label",{className:"form-label mb-0",children:"Очікувана відповідь"}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:function(){let e=[...n,""];s&&s({text:i,answers:e})},children:"Додати відповідь"})]}),n.map((l,r)=>(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,t.jsx)("input",{className:`form-control ${a&&a.qid===(e||0)&&"answer"===a.field&&a.idx===r?"is-invalid":""}`,"data-qid":e,"data-field":"answer","data-idx":r,value:l,onChange:e=>{var t;let a;return t=e.target.value,a=n.map((e,a)=>a===r?t:e),void(s&&s({text:i,answers:a}))}}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>{let e;return e=n.filter((e,t)=>t!==r),void(s&&s({text:i,answers:e}))},children:"Видалити"}),a&&a.qid===(e||0)&&"answer"===a.field&&a.idx===r&&(0,t.jsx)("div",{className:"invalid-feedback d-block app-error",children:a.message})]},r))]})]})}function l({q:e,qid:a,invalidField:i,ensureOptions:n,addOptionToQuestion:s,updateOptionText:l,removeOption:r,toggleOptionCorrect:d}){return(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2",children:[(0,t.jsx)("strong",{className:"mb-0",children:"Варіанти відповіді"}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{n(e.id),s(e.id)},children:"Додати варіант"})]}),(e.data&&e.data.options||[]).map((n,s)=>(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,t.jsx)("div",{style:{marginTop:6},children:(0,t.jsx)("input",{type:"radio",name:`correct-${e.id}`,checked:!!n.correct,onChange:()=>d(e.id,n.id)})}),(0,t.jsx)("input",{className:`form-control ${i&&i.qid===(a||e.id)&&"option"===i.field&&(void 0===i.idx||i.idx===s)?"is-invalid":""}`,"data-qid":a||e.id,"data-field":"option","data-idx":s,value:n.text,onChange:t=>l(e.id,n.id,t.target.value)}),i&&i.qid===(a||e.id)&&"option"===i.field&&(void 0===i.idx||i.idx===s)&&(0,t.jsx)("div",{className:"invalid-feedback d-block app-error",children:i.message}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>r(e.id,n.id),children:"Видалити"})]},n.id))]})}function r({q:e,qid:a,invalidField:i,ensureOptions:n,addOptionToQuestion:s,updateOptionText:l,removeOption:r,toggleOptionCorrect:d}){return(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2",children:[(0,t.jsx)("strong",{className:"mb-0",children:"Варіанти відповіді"}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>{n(e.id),s(e.id)},children:"Додати варіант"})]}),(e.data&&e.data.options||[]).map((n,s)=>(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,t.jsx)("div",{style:{marginTop:6},children:(0,t.jsx)("input",{type:"checkbox",checked:!!n.correct,onChange:()=>d(e.id,n.id)})}),(0,t.jsx)("input",{className:`form-control ${i&&i.qid===(a||e.id)&&"option"===i.field&&(void 0===i.idx||i.idx===s)?"is-invalid":""}`,"data-qid":a||e.id,"data-field":"option","data-idx":s,value:n.text,onChange:t=>l(e.id,n.id,t.target.value)}),i&&i.qid===(a||e.id)&&"option"===i.field&&(void 0===i.idx||i.idx===s)&&(0,t.jsx)("div",{className:"invalid-feedback d-block app-error",children:i.message}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>r(e.id,n.id),children:"Видалити"})]},n.id))]})}function d({q:e,qid:a,invalidField:i,addSequenceItem:n,updateSequenceItemText:s,updateSequenceItemOrder:l,removeSequenceItem:r}){return(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2",children:[(0,t.jsx)("strong",{className:"mb-0",children:"Елементи"}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>n(e.id),children:"Додати елемент"})]}),(e.data&&e.data.options||[]).slice().sort((e,t)=>(Number(e.order)||0)-(Number(t.order)||0)).map((n,l)=>(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,t.jsx)("div",{className:"form-control",style:{width:90,display:"flex",alignItems:"center",justifyContent:"center"},children:Number(n.order)||l+1}),(0,t.jsx)("input",{className:`form-control ${i&&i.qid===(a||e.id)&&"sequence"===i.field&&i.idx===l?"is-invalid":""}`,"data-qid":e.id,"data-field":"sequence","data-idx":l,value:n.text,onChange:t=>s(e.id,n.id,t.target.value)}),i&&i.qid===(a||e.id)&&"sequence"===i.field&&i.idx===l&&(0,t.jsx)("div",{className:"invalid-feedback d-block app-error",children:i.message}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>r(e.id,n.id),children:"Видалити"})]},n.id))]})}function o({q:e,qid:a,invalidField:i,addPairToQuestion:n,updatePairText:s,removePairFromQuestion:l}){return(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-center mb-2",children:[(0,t.jsx)("strong",{className:"mb-0",children:"Пари відповідностей"}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:()=>n(e.id),children:"Додати пару"})]}),(e.data&&e.data.pairs||[]).map((n,r)=>(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-start mb-2",children:[(0,t.jsx)("input",{className:`form-control ${i&&i.qid===(a||e.id)&&"pair"===i.field&&i.idx===r?"is-invalid":""}`,"data-qid":e.id,"data-field":"pair","data-idx":r,value:n.left,onChange:t=>s(e.id,n.id,"left",t.target.value),placeholder:"Ліва"}),(0,t.jsx)("span",{className:"align-self-center",children:"→"}),(0,t.jsx)("input",{className:`form-control ${i&&i.qid===(a||e.id)&&"pair"===i.field&&i.idx===r?"is-invalid":""}`,"data-qid":e.id,"data-field":"pair","data-idx":r,value:n.right,onChange:t=>s(e.id,n.id,"right",t.target.value),placeholder:"Права"}),i&&i.qid===(a||e.id)&&"pair"===i.field&&i.idx===r&&(0,t.jsx)("div",{className:"invalid-feedback d-block app-error",children:i.message}),(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>l(e.id,n.id),children:"Видалити"})]},n.id))]})}function c(){let e=(0,i.useRouter)(),c=(0,i.useSearchParams)();function m(e){Z(t=>t.map(t=>t.id!==e?t:(t.data||(t.data={}),Array.isArray(t.data.options)||(t.data.options=[]),{...t})))}function p(e){let t={id:Date.now(),text:"",correct:!1};Z(a=>a.map(a=>a.id===e?{...a,data:{...a.data||{},options:[...a.data&&a.data.options||[],t]}}:a))}function u(e,t,a){Z(i=>i.map(i=>{if(i.id!==e)return i;let n=i.data&&i.data.options||[];return{...i,data:{...i.data||{},options:n.map(e=>e.id===t?{...e,text:a}:e)}}}))}function h(e,t){Z(a=>a.map(a=>{if(a.id!==e)return a;let i=a.data&&a.data.options||[];return{...a,data:{...a.data||{},options:i.filter(e=>e.id!==t)}}}))}function f(e,t){Z(a=>a.map(a=>{if(a.id!==e)return a;let i=a.data&&a.data.options||[];return"single"===a.type?{...a,data:{...a.data||{},options:i.map(e=>({...e,correct:e.id===t}))}}:{...a,data:{...a.data||{},options:i.map(e=>e.id===t?{...e,correct:!e.correct}:e)}}}))}function x(e){Z(t=>t.map(t=>{if(t.id!==e)return t;let a=t.data&&t.data.options||[],i=a.reduce((e,t)=>Math.max(e,Number(t.order||0)),0),n={id:Date.now(),text:"",order:i+1};return{...t,data:{...t.data||{},options:[...a,n]}}}))}function b(e,t,a){Z(i=>i.map(i=>{if(i.id!==e)return i;let n=i.data&&i.data.options||[];return{...i,data:{...i.data||{},options:n.map(e=>e.id===t?{...e,text:a}:e)}}}))}function g(e,t,a){Z(i=>i.map(i=>{if(i.id!==e)return i;let n=i.data&&i.data.options||[];return{...i,data:{...i.data||{},options:n.map(e=>e.id===t?{...e,order:a}:e)}}}))}function y(e,t){Z(a=>a.map(a=>{if(a.id!==e)return a;let i=a.data&&a.data.options||[];return{...a,data:{...a.data||{},options:i.filter(e=>e.id!==t)}}}))}function v(e){let t={id:Date.now(),left:"",right:""};Z(a=>a.map(a=>a.id===e?{...a,data:{...a.data||{},pairs:[...a.data&&a.data.pairs||[],t]}}:a))}function j(e,t,a,i){Z(n=>n.map(n=>{if(n.id!==e)return n;let s=n.data&&n.data.pairs||[];return{...n,data:{...n.data||{},pairs:s.map(e=>e.id===t?{...e,[a]:i}:e)}}}))}function N(e,t){Z(a=>a.map(a=>{if(a.id!==e)return a;let i=a.data&&a.data.pairs||[];return{...a,data:{...a.data||{},pairs:i.filter(e=>e.id!==t)}}}))}let[w,k]=(0,a.useState)("single");function q(e,t){Z(a=>a.map(a=>a.id===e?{...a,text:t}:a))}async function S(e){try{let t=new FormData;t.append("file",e),t.append("upload_preset","photobase");let a=await fetch("https://api.cloudinary.com/v1_1/dbwse9h4t/image/upload",{method:"POST",body:t});if(!a.ok)return console.error("Upload failed",await a.text()),null;let i=await a.json();return i.secure_url||i.url||null}catch(e){return console.error(e),null}}function C(e,t){Z(a=>a.map(a=>a.id===e?{...a,imageUrl:t||void 0}:a))}let[$,O]=(0,a.useState)(""),[T,A]=(0,a.useState)(""),[F,P]=(0,a.useState)("public"),[U,D]=(0,a.useState)(!0),[R,I]=(0,a.useState)("full"),[_,M]=(0,a.useState)(!1),[L,V]=(0,a.useState)(""),[J,E]=(0,a.useState)(!1),[B,Q]=(0,a.useState)(""),[W,H]=(0,a.useState)(""),[K,Y]=(0,a.useState)(!1),[z,G]=(0,a.useState)(null),[X,Z]=(0,a.useState)([]),[ee,et]=(0,a.useState)([]),[ea,ei]=(0,a.useState)(null),en="test_draft_v1",[es,el]=(0,a.useState)(null),[er,ed]=(0,a.useState)(null),[eo,ec]=(0,a.useState)(!1);function em(e,t){let a={...e};return a.id||(a.id=Date.now()+t+1),a.type||(a.type=a.type||"single"),void 0===a.text&&(a.text=""),a.data=a.data||{},"single"===a.type||"multi"===a.type?a.data.options=Array.isArray(a.data.options)?a.data.options.map((e,a)=>({id:e?.id||Date.now()+t+a+2,text:void 0===e?.text?"":e.text,correct:!!e?.correct})):[]:"sequence"===a.type?a.data.options=Array.isArray(a.data.options)?a.data.options.map((e,a)=>({id:e?.id||Date.now()+t+a+2,text:void 0===e?.text?"":e.text,order:void 0===e?.order?a+1:e.order})):[]:"matching"===a.type?a.data.pairs=Array.isArray(a.data.pairs)?a.data.pairs.map((e,a)=>({id:e?.id||Date.now()+t+a+2,left:void 0===e?.left?"":e.left,right:void 0===e?.right?"":e.right})):[]:"open"===a.type&&(a.data.answers=Array.isArray(a.data.answers)?a.data.answers.map(e=>void 0===e?"":e):[""]),a.points="number"==typeof a.points?a.points:a.data&&"number"==typeof a.data.points?a.data.points:1,a}function ep(){try{let e=window.localStorage.getItem(en);if(!e)return;let t=JSON.parse(e);try{console.debug("[NewTestPage] loaded draft:",t)}catch{}t&&Object.prototype.hasOwnProperty.call(t,"title")&&O(t.title??""),t&&Object.prototype.hasOwnProperty.call(t,"description")&&A(t.description??""),t&&Object.prototype.hasOwnProperty.call(t,"visibility")&&P(t.visibility??"public"),t&&Object.prototype.hasOwnProperty.call(t,"storeResponses")&&"boolean"==typeof t.storeResponses&&D(t.storeResponses),t&&Object.prototype.hasOwnProperty.call(t,"ownResultView")&&I(t.ownResultView??"full"),t&&Object.prototype.hasOwnProperty.call(t,"timed")&&M(!!t.timed),t&&Object.prototype.hasOwnProperty.call(t,"timeLimitMinutes")&&V("number"==typeof t.timeLimitMinutes?t.timeLimitMinutes:t.timeLimitMinutes??""),Array.isArray(t?.questions)&&Z(t.questions.map((e,t)=>em(e,t))),t&&Object.prototype.hasOwnProperty.call(t,"lastSaved")&&el(t.lastSaved??null)}catch(e){console.warn("Failed to load draft:",e)}}(0,a.useEffect)(()=>{try{document.title=er?"TestHub | Редагування тесту":"TestHub | Новий тест"}catch{}},[er]),(0,a.useEffect)(()=>{ep();try{let e=c.get("edit");e&&(ed(e),async function(){try{let t=await fetch(`/api/tests/${e}`,{credentials:"include"});if(!t.ok){403===t.status&&ec(!0);return}let a=await t.json();if(a?.ok&&a.test){let e=a.test;O(e.title||""),A(e.description||""),P(e.visibility||"public"),D(!!e.storeResponses),I(e.ownResultView||"full"),M(!!e.timed),V("number"==typeof e.timeLimitMinutes?e.timeLimitMinutes:e.timeLimitMinutes??""),E(!!e.dateWindowEnabled),Q(e.openFrom?String(new Date(e.openFrom).toISOString().slice(0,16)):""),H(e.openTo?String(new Date(e.openTo).toISOString().slice(0,16)):"");let t=Array.isArray(e.questions)?e.questions.map(e=>{let t=(e=>{switch(e){case"single_choice":return"single";case"multi_choice":return"multi";case"sequence":return"sequence";case"matching":return"matching";case"open":return"open";default:return e}})(e.type),a={};return"single"===t||"multi"===t||"sequence"===t?a.options=e.options||[]:"matching"===t?a.pairs=e.pairs||[]:"open"===t&&(a.answers=e.answers||[]),{id:e.id||Date.now(),type:t,text:e.text||"",data:a,points:"number"==typeof e.points?e.points:1,imageUrl:e.imageUrl||e.image&&(e.image.secure_url||e.image.url)||void 0}}):[];Z(t);try{let e=t.map(e=>e.imageUrl).filter(Boolean);et(e)}catch{}}}catch(e){console.warn("Failed to load test for edit:",e)}}())}catch{}},[]);let eu=(0,i.usePathname)();async function eh(t){if(t.preventDefault(),G(null),function(){if(!$||!String($).trim()){let e="Вкажіть назву тесту";G(e),ei({qid:-1,field:"title",message:e});let t=document.querySelector('[data-field="title"]');if(t){t.scrollIntoView({behavior:"smooth",block:"center"});try{t.focus()}catch{}}return!1}if(!X||0===X.length)return G("Додайте принаймні одне питання"),!1;if(_){let e="number"==typeof L?L:L?Number(L):NaN;if(!Number.isFinite(e)||e<=0)return G("Вкажіть коректну тривалість тесту у хвилинах"),!1}if(J){if(!B||!W)return G("Вкажіть дати початку та кінця відкритості тесту"),!1;let e=new Date(B),t=new Date(W);if(isNaN(e.getTime())||isNaN(t.getTime())||e.getTime()>t.getTime())return G("Некоректні дати: початок має бути раніше або рівним кінцю"),!1}let e=null,t=null;for(let a=0;a<X.length;a++){let i=X[a],n=a+1;if(!i.text||!String(i.text).trim()){let a=`Питання ${n}: введіть текст питання`;G(a),t={qid:i.id,field:"text",message:a},e=`[data-qid="${i.id}"][data-field="text"]`;break}if("single"===i.type||"multi"===i.type){let a=i.data&&i.data.options||[];if(!a||0===a.length){let a=`Питання ${n}: додайте варіанти відповіді`;G(a),t={qid:i.id,field:"option",message:a},e=`[data-qid="${i.id}"][data-field="option"]`;break}for(let s=0;s<a.length;s++){let l=a[s];if(!l.text||!String(l.text).trim()){let a=`Питання ${n}, варіант ${s+1}: введіть текст варіанту`;G(a),t={qid:i.id,field:"option",idx:s,message:a},e=`[data-qid="${i.id}"][data-field="option"][data-idx="${s}"]`;break}}if(e)break;if(!a.some(e=>!!e.correct)){let a=`Питання ${n}: позначте принаймні один правильний варіант`;G(a),t={qid:i.id,field:"option",message:a},e=`[data-qid="${i.id}"][data-field="option"]`;break}}else if("sequence"===i.type){let a=i.data&&i.data.options||[];if(!a||0===a.length){let a=`Питання ${n}: додайте елементи послідовності`;G(a),t={qid:i.id,field:"sequence",message:a},e=`[data-qid="${i.id}"][data-field="sequence"]`;break}for(let s=0;s<a.length;s++)if(!a[s].text||!String(a[s].text).trim()){let a=`Питання ${n}, елемент ${s+1}: введіть текст`;G(a),t={qid:i.id,field:"sequence",idx:s,message:a},e=`[data-qid="${i.id}"][data-field="sequence"][data-idx="${s}"]`;break}if(e)break}else if("matching"===i.type){let a=i.data&&i.data.pairs||[];if(!a||0===a.length){let a=`Питання ${n}: додайте пари відповідностей`;G(a),t={qid:i.id,field:"pair",message:a},e=`[data-qid="${i.id}"][data-field="pair"]`;break}for(let s=0;s<a.length;s++){let l=a[s];if(!l.left||!String(l.left).trim()||!l.right||!String(l.right).trim()){let a=`Питання ${n}, пара ${s+1}: заповніть обидва поля пари`;G(a),t={qid:i.id,field:"pair",idx:s,message:a},e=`[data-qid="${i.id}"][data-field="pair"][data-idx="${s}"]`;break}}if(e)break}else if("open"===i.type){let a=i.data&&i.data.answers||[];if(!a||0===a.length){let a=`Питання ${n}: додайте принаймні одну очікувану відповідь або заповніть питання`;G(a),t={qid:i.id,field:"answer",message:a},e=`[data-qid="${i.id}"][data-field="answer"]`;break}for(let s=0;s<a.length;s++)if(!a[s]||!String(a[s]).trim()){let a=`Питання ${n}, очікувана відповідь ${s+1}: введіть текст`;G(a),t={qid:i.id,field:"answer",idx:s,message:a},e=`[data-qid="${i.id}"][data-field="answer"][data-idx="${s}"]`;break}if(e)break}}if(t){ei(t);let a=document.querySelector(e);if(a){a.scrollIntoView({behavior:"smooth",block:"center"});try{a.focus()}catch{}}return!1}return ei(null),G(null),!0}()){Y(!0);try{let t;if(er&&eo){G("Ви не маєте прав редагувати цей тест."),Y(!1);return}if(er&&Array.isArray(ee)&&ee.length>0){let e=X.map(e=>e.imageUrl).filter(Boolean),t=ee.filter(t=>!e.includes(t));if(t.length>0){let e=[];for(let a of t)try{let t=await fetch("/api/cloudinary/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:a})});if(!t.ok){let i=await t.text().catch(()=>void 0);e.push(`${a} -> ${i||t.status}`)}}catch(t){e.push(`${a} -> ${String(t)}`)}if(e.length>0){Y(!1),alert("Не вдалося видалити старі зображення:\n"+e.join("\n"));return}}}let a=X.map(e=>{let t={id:e.id,type:e.type,text:e.text||"",points:"number"==typeof e.points?e.points:1};return"single"===e.type||"multi"===e.type||"sequence"===e.type?(t.data=t.data||{},t.data.options=Array.isArray(e.data?.options)?e.data.options.map(e=>({id:e.id,text:e.text,correct:!!e.correct,order:e.order})):[]):"matching"===e.type?(t.data=t.data||{},t.data.pairs=Array.isArray(e.data?.pairs)?e.data.pairs.map(e=>({id:e.id,left:e.left,right:e.right})):[]):"open"===e.type&&(t.data=t.data||{},t.data.answers=Array.isArray(e.data?.answers)?e.data.answers.map(e=>String(e||"")):[]),e.imageUrl&&(t.imageUrl=e.imageUrl),t}),i={title:$,description:T,visibility:F,storeResponses:U,timed:_,timeLimitMinutes:"number"==typeof L?L:L?Number(L):void 0,dateWindowEnabled:J,openFrom:B||void 0,openTo:W||void 0,ownResultView:R,questions:a};if(!(t=er?await fetch(`/api/tests/${er}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)}):await fetch("/api/tests",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).ok){let e=await t.text();throw Error(e||`HTTP ${t.status}`)}e.push("/editor")}catch(e){G(e?.message||(er?"Помилка при оновленні тесту":"Помилка при створенні тесту")),Y(!1)}}}return(0,a.useEffect)(()=>{try{"/editor/new"===eu&&(c.get("edit")||ep())}catch{}},[eu]),(0,a.useEffect)(()=>{try{let e={title:$,description:T,visibility:F,storeResponses:U,timed:_,timeLimitMinutes:L,dateWindowEnabled:J,openFrom:B,openTo:W,ownResultView:R,questions:X,lastSaved:Date.now()};try{window.localStorage.setItem(en,JSON.stringify(e)),el(e.lastSaved)}catch(e){console.warn("Failed to save draft:",e)}}catch{}},[$,T,F,U,R,X]),eo?(0,t.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,t.jsx)("h2",{className:"mb-4 text-center",children:"Редагування заборонено"}),(0,t.jsxs)("div",{className:"menu-box p-4",children:[(0,t.jsx)("div",{className:"alert alert-danger",children:"Ви не маєте прав редагувати цей тест."}),(0,t.jsx)("div",{className:"d-flex gap-2",children:(0,t.jsx)(n.default,{href:"/editor",className:"btn btn-outline-secondary",children:"Назад"})})]})]}):(0,t.jsxs)("div",{className:"container d-flex flex-column align-items-center min-vh-100",children:[(0,t.jsx)("h2",{className:"mb-4 text-center",children:er?"Редагування тесту":"Новий тест"}),(0,t.jsxs)("form",{className:"menu-box p-4",onSubmit:eh,children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Назва"}),(0,t.jsx)("input",{className:`form-control ${ea&&"title"===ea.field?"is-invalid":""}`,value:$,"data-field":"title",onChange:e=>O(e.target.value)}),ea&&"title"===ea.field&&(0,t.jsx)("div",{className:"invalid-feedback d-block app-error",children:ea.message})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"Опис"}),(0,t.jsx)("textarea",{className:"form-control",rows:5,value:T,onChange:e=>A(e.target.value)})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label d-block",children:"Видимість"}),(0,t.jsxs)("div",{className:"btn-group",role:"group",children:[(0,t.jsx)("input",{type:"radio",className:"btn-check",name:"visibility",id:"public",autoComplete:"off",checked:"public"===F,onChange:()=>P("public")}),(0,t.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"public",children:"Публічний"}),(0,t.jsx)("input",{type:"radio",className:"btn-check",name:"visibility",id:"private",autoComplete:"off",checked:"private"===F,onChange:()=>P("private")}),(0,t.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"private",children:"Приватний"})]})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label d-block",children:"Зберігати відповіді та результати користувачів"}),(0,t.jsxs)("div",{className:"btn-group",role:"group",children:[(0,t.jsx)("input",{type:"radio",className:"btn-check",name:"storeResponses",id:"storeYes",autoComplete:"off",checked:!0===U,onChange:()=>D(!0)}),(0,t.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"storeYes",children:"Так"}),(0,t.jsx)("input",{type:"radio",className:"btn-check",name:"storeResponses",id:"storeNo",autoComplete:"off",checked:!1===U,onChange:()=>{D(!1),"nothing"===R&&I("full")}}),(0,t.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"storeNo",children:"Ні"})]}),(0,t.jsx)("div",{className:"form-text mt-1",children:"Якщо так — зберігатимуться індивідуальні відповіді та результати (ви зможете бачити список користувачів, які пройшли тест)."})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label d-block",children:"Що бачить користувач після проходження"}),(0,t.jsxs)("div",{className:"btn-group",role:"group",children:[(0,t.jsx)("input",{type:"radio",className:"btn-check",name:"ownResultView",id:"ownFull",autoComplete:"off",checked:"full"===R,onChange:()=>I("full")}),(0,t.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"ownFull",children:"Повні результати (питання + відповіді + бали)"}),(0,t.jsx)("input",{type:"radio",className:"btn-check",name:"ownResultView",id:"ownScore",autoComplete:"off",checked:"score_only"===R,onChange:()=>I("score_only")}),(0,t.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"ownScore",children:"Тільки бали"}),(0,t.jsx)("input",{type:"radio",className:"btn-check",name:"ownResultView",id:"ownNothing",autoComplete:"off",checked:"nothing"===R,disabled:!1===U,onChange:()=>{U&&I("nothing")}}),U?(0,t.jsx)("label",{className:"btn btn-outline-primary",htmlFor:"ownNothing",children:"Нічого не показувати"}):null]}),(0,t.jsx)("div",{className:"form-text mt-1",children:"Ця опція визначає, що бачить сам користувач після завершення тесту."})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label d-block",children:"Налаштування часу"}),(0,t.jsxs)("div",{className:"form-check form-switch mb-2",children:[(0,t.jsx)("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"timedSwitch",checked:_,onChange:e=>M(e.target.checked)}),(0,t.jsx)("label",{className:"form-check-label",htmlFor:"timedSwitch",children:"Обмежений час проходження"})]}),_&&(0,t.jsxs)("div",{className:"d-flex align-items-center gap-2 mb-2",children:[(0,t.jsx)("div",{style:{width:220},children:(0,t.jsx)("input",{type:"number",min:1,className:"form-control",value:L,onChange:e=>V(""===e.target.value?"":Number(e.target.value)),placeholder:"Тривалість (хвилин)"})}),(0,t.jsx)("div",{className:"form-text",children:"Вкажіть тривалість тесту в хвилинах."})]}),(0,t.jsx)("hr",{}),(0,t.jsxs)("div",{className:"form-check form-switch mb-2",children:[(0,t.jsx)("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"dateWindowSwitch",checked:J,onChange:e=>E(e.target.checked)}),(0,t.jsx)("label",{className:"form-check-label",htmlFor:"dateWindowSwitch",children:"Обмежити доступ датами"})]}),J&&(0,t.jsxs)("div",{className:"d-flex flex-column gap-2",children:[(0,t.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,t.jsx)("label",{className:"form-label mb-0",style:{width:120},children:"Від"}),(0,t.jsx)("input",{type:"datetime-local",className:"form-control",value:B,onChange:e=>Q(e.target.value)})]}),(0,t.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,t.jsx)("label",{className:"form-label mb-0",style:{width:120},children:"До"}),(0,t.jsx)("input",{type:"datetime-local",className:"form-control",value:W,onChange:e=>H(e.target.value)})]}),(0,t.jsx)("div",{className:"form-text",children:"Коли увімкнено — тест буде доступний лише в проміжку часу."})]})]}),(0,t.jsxs)("div",{className:"mb-3 questions-section",children:[(0,t.jsx)("h3",{className:"mb-2 text-center",children:"Питання"}),0===X.length&&(0,t.jsx)("div",{className:"muted mb-2",children:"Поки немає питань. Додайте перше питання."}),X.map(e=>(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[(0,t.jsx)("label",{className:"form-label mb-0",children:"Питання"}),(0,t.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,t.jsxs)("select",{className:"form-select form-select-sm",style:{width:200},value:e.type,onChange:t=>{var a,i;return a=e.id,i=t.target.value,void Z(e=>e.map((e,t)=>{if(e.id!==a)return e;let n={...e,type:i};n.data=n.data||{};let s=Date.now()+t;return"single"!==i&&"multi"!==i||Array.isArray(n.data.options)||(n.data.options=[{id:s+1,text:"",correct:!1},{id:s+2,text:"",correct:!1}]),"sequence"!==i||Array.isArray(n.data.options)||(n.data.options=[{id:s+1,text:"",order:1},{id:s+2,text:"",order:2}]),"matching"!==i||Array.isArray(n.data.pairs)||(n.data.pairs=[{id:s+1,left:"",right:""},{id:s+2,left:"",right:""}]),"open"!==i||Array.isArray(n.data.answers)||(n.data.answers=[""]),em(n,t)}))},children:[(0,t.jsx)("option",{value:"single",children:"Одиночний вибір"}),(0,t.jsx)("option",{value:"multi",children:"Множинний вибір"}),(0,t.jsx)("option",{value:"sequence",children:"Порядок"}),(0,t.jsx)("option",{value:"open",children:"Відкрита відповідь"}),(0,t.jsx)("option",{value:"matching",children:"Відповідності"})]}),(0,t.jsx)("input",{type:"number",min:0,step:.5,className:"form-control form-control-sm",style:{width:90},value:"number"==typeof e.points?e.points:1,onChange:t=>{var a,i;return a=e.id,i=Number(t.target.value||0),void Z(e=>e.map(e=>e.id===a?{...e,points:i}:e))},title:"Бали за питання"}),(0,t.jsx)("span",{className:"badge bg-secondary text-capitalize",children:e.type})]})]}),"open"!==e.type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("textarea",{className:`form-control ${ea&&ea.qid===e.id&&"text"===ea.field?"is-invalid":""}`,rows:3,value:e.text,"data-qid":e.id,"data-field":"text",onChange:t=>q(e.id,t.target.value)}),ea&&ea.qid===e.id&&"text"===ea.field&&(0,t.jsx)("div",{className:"invalid-feedback d-block app-error",children:ea.message}),(0,t.jsx)("div",{className:"mt-2 d-flex align-items-center gap-2",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label mb-1",children:"Зображення (опціонально)"}),(0,t.jsxs)("div",{className:"d-flex gap-2 align-items-center",children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:async t=>{let a=t.target.files?.[0];if(a)try{if(e.imageUrl)try{await fetch("/api/cloudinary/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e.imageUrl})})}catch(e){console.warn("Failed to delete previous image:",e)}let t=await S(a);t&&C(e.id,t)}catch(e){console.error(e),alert("Не вдалося завантажити зображення")}}}),e.imageUrl?(0,t.jsxs)("div",{style:{maxWidth:140},children:[(0,t.jsx)("img",{src:e.imageUrl,alt:"preview",style:{width:"100%",borderRadius:8}}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:async()=>{try{if(e.imageUrl){let t=await fetch("/api/cloudinary/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e.imageUrl})});if(!t.ok){let e=await t.text().catch(()=>void 0);alert("Не вдалося видалити зображення на сервері: "+(e||t.status));return}}}catch(e){console.warn("Failed to delete image on server:",e),alert("Не вдалося видалити зображення на сервері");return}C(e.id,null)},children:"Видалити"})})]}):null]})]})})]}),"open"===e.type&&(0,t.jsx)(s,{qid:e.id,invalidField:ea,text:e.text,answers:e.data&&e.data.answers||[],onChange:t=>{var a,i;q(e.id,t.text),a=e.id,i=t.answers,Z(e=>e.map(e=>e.id===a?{...e,data:{...e.data||{},answers:i}}:e))}}),"single"===e.type&&(0,t.jsx)(l,{q:e,qid:e.id,invalidField:ea,ensureOptions:m,addOptionToQuestion:p,updateOptionText:u,removeOption:h,toggleOptionCorrect:f}),"multi"===e.type&&(0,t.jsx)(r,{q:e,qid:e.id,invalidField:ea,ensureOptions:m,addOptionToQuestion:p,updateOptionText:u,removeOption:h,toggleOptionCorrect:f}),"sequence"===e.type&&(0,t.jsx)(d,{q:e,qid:e.id,invalidField:ea,addSequenceItem:x,updateSequenceItemText:b,updateSequenceItemOrder:g,removeSequenceItem:y}),"matching"===e.type&&(0,t.jsx)(o,{q:e,qid:e.id,invalidField:ea,addPairToQuestion:v,updatePairText:j,removePairFromQuestion:N}),(0,t.jsx)("div",{className:"mt-2 d-flex gap-2",children:(0,t.jsx)("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>{var t;return t=e.id,void Z(e=>e.filter(e=>e.id!==t))},children:"Видалити питання"})})]},e.id)),(0,t.jsxs)("div",{className:"mb-2 d-flex justify-content-center align-items-center gap-2 mt-3",children:[(0,t.jsxs)("select",{className:"form-select w-auto",value:w,onChange:e=>k(e.target.value),children:[(0,t.jsx)("option",{value:"single",children:"Одиночний вибір"}),(0,t.jsx)("option",{value:"multi",children:"Множинний вибір"}),(0,t.jsx)("option",{value:"sequence",children:"Порядок (послідовність)"}),(0,t.jsx)("option",{value:"open",children:"Відкрита відповідь"}),(0,t.jsx)("option",{value:"matching",children:"Відповідності"})]}),(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>{let e,t,a;return e=Date.now(),t={},"single"===w||"multi"===w?t.options=[{id:e+1,text:"",correct:!1},{id:e+2,text:"",correct:!1}]:"sequence"===w?t.options=[{id:e+1,text:"",order:1},{id:e+2,text:"",order:2}]:"matching"===w?t.pairs=[{id:e+1,left:"",right:""},{id:e+2,left:"",right:""}]:"open"===w&&(t.answers=[""]),a={id:e,type:w,text:"",data:t},void Z(e=>[...e,em(a,e.length)])},children:"Додати питання"})]})]}),z&&(0,t.jsx)("div",{className:"app-error mb-3",children:z}),(0,t.jsxs)("div",{className:"d-flex gap-2 actions-center",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:function(){try{window.localStorage.removeItem(en)}catch{}O(""),A(""),P("public"),D(!0),M(!1),V(""),E(!1),Q(""),H(""),I("full"),Z([]),el(null),ei(null),G(null)},children:"Очистити всі поля"}),(0,t.jsx)("button",{className:"btn btn-primary",type:"submit",disabled:K,children:K?er?"Оновлюю...":"Зберігаю...":er?"Оновити тест":"Створити тест"}),(0,t.jsx)(n.default,{href:"/editor",className:"btn btn-outline-secondary",children:"Назад"})]})]})]})}e.s(["default",()=>c],51996)}]);